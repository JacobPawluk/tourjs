"use strict"
define("bt-web2/adapters/wordpress/attachment",["exports","ember-wordpress/adapters/wordpress"],(function(e,t){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
var n=t.default.extend({})
e.default=n})),define("bt-web2/adapters/wordpress/category",["exports","ember-wordpress/adapters/wordpress"],(function(e,t){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
var n=t.default.extend({})
e.default=n})),define("bt-web2/adapters/wordpress/comment",["exports","ember-wordpress/adapters/wordpress"],(function(e,t){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
var n=t.default.extend({})
e.default=n})),define("bt-web2/adapters/wordpress/page",["exports","ember-wordpress/adapters/wordpress"],(function(e,t){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
var n=t.default.extend({})
e.default=n})),define("bt-web2/adapters/wordpress/post",["exports","ember-wordpress/adapters/wordpress"],(function(e,t){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
var n=t.default.extend({})
e.default=n})),define("bt-web2/adapters/wordpress/tag",["exports","ember-wordpress/adapters/wordpress"],(function(e,t){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
var n=t.default.extend({})
e.default=n})),define("bt-web2/adapters/wordpress/user",["exports","ember-wordpress/adapters/wordpress"],(function(e,t){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
var n=t.default.extend({})
e.default=n})),define("bt-web2/ai/controller",["exports","bt-web2/server-client-common/ServerAISnapshots"],(function(e,t){function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function r(e,t){for(var n=0;n<t.length;n++){var r=t[n]
r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function o(e,t){return!t||"object"!==n(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called")
return e}(e):t}function i(e){return(i=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function a(e,t){return(a=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
var s=function(e){return console.log("handling files ",e),new Promise((function(t,n){var r=new FileReader
r.onload=function(e){var n,r,o,i,a
return regeneratorRuntime.async((function(s){for(;;)switch(s.prev=s.next){case 0:r=null===(n=e.target)||void 0===n?void 0:n.result,o=(new TextDecoder).decode(r),i=o.split("$$").filter((function(e){return!!e.trim()})),a=i.map((function(e){return JSON.parse(e)})),t(a)
case 5:case"end":return s.stop()}}))},r.readAsArrayBuffer(e[0])}))},c=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),o(this,i(t).apply(this,arguments))}var n,s,c
return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function")
e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&a(e,t)}(t,e),n=t,(s=[{key:"startup",value:function(){}}])&&r(n.prototype,s),c&&r(n,c),t}(Ember.Controller.extend({datas:null,running:!1,actions:{onFileChange:function(e){var t,n
return regeneratorRuntime.async((function(r){for(;;)switch(r.prev=r.next){case 0:return console.log("file drop ",e),t=e.target.files,console.log("files = ",t),r.next=5,regeneratorRuntime.awrap(s(t))
case 5:n=r.sent,this.set("datas",n)
case 7:case"end":return r.stop()}}),null,this)},cancel:function(){this.set("running",!1)},train:function(){var e,n,r,o=this
return regeneratorRuntime.async((function(i){for(;;)switch(i.prev=i.next){case 0:return window.tfvis.visor(),["mse"],{name:"show.fitCallbacks",tab:"Training",styles:{height:"1000px"}},void 0,e=window.tf,n=this.get("datas"),r=function(e,t){var n=new Blob([t],{type:"text/plain"}),r=window.URL.createObjectURL(n),o=document.createElement("a")
o.href=r,o.download=e,o.target="_blank",document.body.appendChild(o),o.click(),document.body.removeChild(o)},this.set("running",!0),i.next=11,regeneratorRuntime.awrap((0,t.doNNTrainWithSnapshots)(e,"art",n,r,void 0,(function(){return!o.get("running")})))
case 11:case 12:case"end":return i.stop()}}),null,this)}}}))
e.default=c})),define("bt-web2/ai/route",["exports"],(function(e){function t(e){return(t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function n(e,t){for(var n=0;n<t.length;n++){var r=t[n]
r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function r(e,n){return!n||"object"!==t(n)&&"function"!=typeof n?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called")
return e}(e):n}function o(e){return(o=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function i(e,t){return(i=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function a(e){var t
return regeneratorRuntime.async((function(n){for(;;)switch(n.prev=n.next){case 0:return(t=document.createElement("script")).src=e,n.abrupt("return",new Promise((function(e){t.onload=e,document.head.appendChild(t)})))
case 3:case"end":return n.stop()}}))}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
var s=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),r(this,o(t).apply(this,arguments))}var s,c,u
return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function")
e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&i(e,t)}(t,Ember.Route.extend({})),s=t,(c=[{key:"beforeModel",value:function(){return regeneratorRuntime.async((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,regeneratorRuntime.awrap(a("https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@2.0.0/dist/tf.min.js"))
case 2:return e.next=4,regeneratorRuntime.awrap(a("https://cdn.jsdelivr.net/npm/@tensorflow/tfjs-vis"))
case 4:case"end":return e.stop()}}))}},{key:"model",value:function(){}},{key:"setupController",value:function(e,t){e.startup()}}])&&n(s.prototype,c),u&&n(s,u),t}()
e.default=s})),define("bt-web2/ai/template",["exports"],(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
var t=Ember.HTMLBars.template({id:"1X8kXlqd",block:'{"symbols":[],"statements":[[7,"div",true],[10,"class","ai__container"],[8],[0,"\\n  "],[7,"h3",true],[8],[0,"TourJS AI Training"],[9],[0,"\\n  "],[7,"table",true],[8],[0,"\\n    "],[7,"tr",true],[8],[0,"\\n      "],[7,"td",true],[8],[0,"Upload File"],[9],[0,"\\n      "],[7,"td",true],[8],[7,"input",true],[10,"class","ai__file"],[10,"id","upload"],[11,"onchange",[28,"action",[[23,0,[]],"onFileChange"],null]],[10,"type","file"],[8],[9],[9],[0,"\\n    "],[9],[0,"\\n\\n"],[4,"if",[[24,["datas"]]],null,{"statements":[[0,"      "],[7,"tr",true],[8],[0,"\\n        "],[7,"td",true],[10,"colspan","2"],[8],[7,"button",false],[12,"disabled",[22,"running"]],[12,"class","ai__button"],[3,"action",[[23,0,[]],"train"]],[8],[0,"Train"],[9],[9],[0,"\\n      "],[9],[0,"\\n"]],"parameters":[]},null],[4,"if",[[24,["running"]]],null,{"statements":[[0,"      "],[7,"tr",true],[8],[0,"\\n        "],[7,"td",true],[10,"colspan","2"],[8],[7,"button",false],[12,"class","ai__button"],[3,"action",[[23,0,[]],"cancel"]],[8],[0,"Stop Running"],[9],[9],[0,"\\n      "],[9],[0,"\\n"]],"parameters":[]},null],[0,"  "],[9],[0,"\\n"],[9]],"hasEval":false}',meta:{moduleName:"bt-web2/ai/template.hbs"}})
e.default=t})),define("bt-web2/app",["exports","bt-web2/resolver","ember-load-initializers","bt-web2/config/environment"],(function(e,t,n,r){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
var o,i,a,s=Ember.Application.extend({modulePrefix:r.default.modulePrefix,podModulePrefix:r.default.podModulePrefix,Resolver:t.default})
function c(e){for(var t=(e+"=".repeat((4-e.length%4)%4)).replace(/-/g,"+").replace(/_/g,"/"),n=window.atob(t),r=new Uint8Array(n.length),o=0;o<n.length;++o)r[o]=n.charCodeAt(o)
return r}r.default.environment,window.assert2=function(e,t){e||t&&console.log("Assertions failed: Reason = ",t)},(0,n.default)(s,r.default.modulePrefix),regeneratorRuntime.async((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,regeneratorRuntime.awrap(navigator.serviceWorker.register("sw.js"))
case 2:return e.next=4,regeneratorRuntime.awrap(navigator.serviceWorker.ready)
case 4:return o=e.sent,e.next=7,regeneratorRuntime.awrap(o.pushManager.getSubscription())
case 7:if(!(i=e.sent)){e.next=13
break}return console.log("we're already subscribed"),e.abrupt("return",i)
case 13:a=c("BKF-5tBkRM2NuN3z5UM7ksk1wXxGZzlj2VAepn0nu6BLSMm3b6o7ohKi49LZ4JWNtFGeBbiaDlAF14CuYk2WDpA"),o.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:a})
case 16:case"end":return e.stop()}}))
var u=s
e.default=u})),define("bt-web2/application/controller",["exports","bt-web2/services/devices","bt-web2/pojs/DeviceFactory","bt-web2/pojs/WebBluetoothDevice"],(function(e,t,n,r){var o,i,a
function s(e,t,n,r,o){var i={}
return Object.keys(r).forEach((function(e){i[e]=r[e]})),i.enumerable=!!i.enumerable,i.configurable=!!i.configurable,("value"in i||i.initializer)&&(i.writable=!0),i=n.slice().reverse().reduce((function(n,r){return r(e,t,n)||n}),i),o&&void 0!==i.initializer&&(i.value=i.initializer?i.initializer.call(o):void 0,i.initializer=void 0),void 0===i.initializer&&(Object.defineProperty(e,t,i),i=null),i}function c(e){return(c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function u(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function l(e,t){for(var n=0;n<t.length;n++){var r=t[n]
r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function f(e,t,n){return t&&l(e.prototype,t),n&&l(e,n),e}function p(e,t){return!t||"object"!==c(t)&&"function"!=typeof t?h(e):t}function d(e){return(d=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function h(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called")
return e}function m(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function")
e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&y(e,t)}function y(e,t){return(y=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function v(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}Object.defineProperty(e,"__esModule",{value:!0}),e.default=e.FakeDevice=void 0
var b,g=function(e){function t(){var e
return u(this,t),v(h(e=p(this,d(t).call(this))),"nextPower",void 0),e.nextPower=0,setInterval((function(){e.nextPower?e._notifyNewPower((new Date).getTime(),2*Math.random()+e.nextPower-1):(e._notifyNewPower((new Date).getTime(),50*Math.random()+100),e._notifyNewHrm((new Date).getTime(),5*Math.random()+50))}),250),e}return m(t,e),f(t,[{key:"setNextPower",value:function(e){this.nextPower=e}},{key:"getDeviceId",value:function(){return"Fake"}},{key:"getDeviceTypeDescription",value:function(){return"Fake Device"}},{key:"updateSlope",value:function(e,t){return Promise.resolve(!1)}},{key:"updateErg",value:function(e,t){return Promise.resolve(!1)}},{key:"updateResistance",value:function(e){return Promise.resolve(!1)}},{key:"disconnect",value:function(){return Promise.resolve()}},{key:"getState",value:function(){return r.BTDeviceState.Ok}},{key:"name",value:function(){return"Fake Device"}}]),t}(r.PowerDataDistributor)
e.FakeDevice=g
var _=(o=Ember.computed("myRidersVersion"),i=Ember.computed("frame"),s((a=function(e){function t(){var e,n
u(this,t)
for(var r=arguments.length,o=new Array(r),i=0;i<r;i++)o[i]=arguments[i]
return v(h(n=p(this,(e=d(t)).call.apply(e,[this].concat(o)))),"myRidersVersion",0),n}return m(t,e),f(t,[{key:"_tick",value:function(){var e=this,t=!!this.devices.getLocalUser(),n=this.devices.isLocalUserDeviceValid()
t&&!n?this.set("bluetoothWarning",!0):this.set("bluetoothWarning",!1),this.incrementProperty("frame"),this.incrementProperty("myRidersVersion"),setTimeout((function(){return e._tick()}),2e3)}},{key:"start",value:function(){var e=this;("localhost"===window.location.hostname||window.location.search.includes("?fake"))&&(this.set("showCheater",!1),Ember.run.later("afterRender",(function(){var e=document.querySelector(".application__user-status--cheater")
e&&(e.onmousemove=function(e){var t=e.offsetX
b&&b.setNextPower(t)})}))),window.navigator&&window.navigator.bluetooth&&window.navigator.bluetooth.getAvailability?navigator.bluetooth.getAvailability().then((function(t){console.log("Bluetooth is available? ",t),e.set("canDoBluetooth",t)})):this.set("canDoBluetooth",!1),this._tick()}},{key:"userInfo",get:function(){var e=this.devices.getLocalUser()
if(e&&e.getImage())return'<a href="/results?md5='.concat(e.getBigImageMd5(),'">your results link</a>')
return""}},{key:"localUser",get:function(){if(this.get("bluetoothWarning"))return null
var e=this.devices.getLocalUser()
try{if(this.connection.getRaceState())return null}catch(t){}return window.location.pathname.includes("pacing-challenge-race")?null:e?e.getDisplay(null):null}}]),t}(Ember.Controller.extend({devices:Ember.inject.service("devices"),connection:Ember.inject.service("connection"),bluetoothWarning:!1,canDoBluetooth:!1,frame:0,showCheater:!1,isDebug:"localhost"===window.location.hostname,observeGoodUpdates:Ember.observer("devices.goodUpdates",(function(){var e=document.querySelector(".application__device-write")
e&&(e.classList.add("good"),setTimeout((function(){e.classList.remove("good")}),250))})),actions:{connectDh:function(){var e=this;(0,n.getDeviceFactory)().findDisplay().then((function(t){e.devices.setDisplayDevice(t)}))},connectDevice:function(){var e,r,o=this
if((null===(e=window.location)||void 0===e?void 0:null===(r=e.search)||void 0===r?void 0:r.includes("fake"))||"localhost"===window.location.hostname){var i=b=new g
this.devices.setLocalUserDevice(i,t.DeviceFlags.All)}else(0,n.getDeviceFactory)().findPowermeter().then((function(e){o.devices.setLocalUserDevice(e,t.DeviceFlags.AllButHrm)}))},hideThis:function(){var e=document.querySelector(".application__user-info")
e&&window.scrollTo(0,null==e?void 0:e.scrollHeight)},connectHrm:function(){var e=this
if(window.location.search&&window.location.search.includes("fake")){var r=b=new g
this.devices.setLocalUserDevice(r,t.DeviceFlags.Hrm)}else(0,n.getDeviceFactory)().findHrm().then((function(n){e.devices.setLocalUserDevice(n,t.DeviceFlags.Hrm)}))},ftmsAdjust:function(e){this.devices.ftmsAdjust(e)}}}))).prototype,"userInfo",[o],Object.getOwnPropertyDescriptor(a.prototype,"userInfo"),a.prototype),s(a.prototype,"localUser",[i],Object.getOwnPropertyDescriptor(a.prototype,"localUser"),a.prototype),a)
e.default=_})),define("bt-web2/application/route",["exports","bt-web2/components/user-set-up-widget/component","ember-md5"],(function(e,t,n){function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function o(e,t){for(var n=0;n<t.length;n++){var r=t[n]
r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function i(e,t){return!t||"object"!==r(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called")
return e}(e):t}function a(e){return(a=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function s(e,t){return(s=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
var c=function(e){function r(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r),i(this,a(r).apply(this,arguments))}var c,u,l
return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function")
e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&s(e,t)}(r,Ember.Route.extend({devices:Ember.inject.service("devices")})),c=r,(u=[{key:"beforeModel",value:function(e){var r=this
console.log(e)
var o=localStorage.getItem(t.USERSETUP_KEY_IMAGE)||null,i=localStorage.getItem(t.USERSETUP_KEY_NAME),a=localStorage.getItem(t.USERSETUP_KEY_HANDICAP),s=Promise.resolve("")
return o&&(console.log("loaded image ",null==o?void 0:o.substr(0,100)," with length ",o.length," from localstorage"),s=(0,t.storeFromVirginImage)(o,!1,null)),s.then((function(t){if(console.log("resized image to "+t.length+" bytes"),i&&a)r.devices.addUser({name:i,handicap:parseInt(a),imageBase64:t,bigImageMd5:(0,n.default)(o)})
else if("strava-auth"===e.to.name);else if("ride"!==e.to.name)return r.transitionTo("set-up-user")}))}},{key:"setupController",value:function(e,t){e.set("model",t),e.start()}}])&&o(c.prototype,u),l&&o(c,l),r}()
e.default=c})),define("bt-web2/application/template",["exports"],(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
var t=Ember.HTMLBars.template({id:"qqwrpylg",block:'{"symbols":[],"statements":[[7,"div",true],[10,"class","application__container"],[8],[0,"\\n  "],[1,[22,"outlet"],false],[0,"\\n\\n  "],[7,"div",false],[12,"class","application__device-write"],[3,"action",[[23,0,[]],"connectDevice"]],[8],[9],[0,"\\n  "],[7,"div",true],[11,"class",[29,["application__bluetooth-warning ",[28,"if",[[24,["bluetoothWarning"]],"device-gone"],null]]]],[8],[0,"\\n    "],[7,"div",true],[10,"class","application__bluetooth-warning--text"],[8],[0,"\\n      "],[7,"i",true],[10,"class","fas fa-exclamation-triangle yellow"],[8],[9],[0,"\\n      "],[7,"i",true],[10,"class","fab fa-bluetooth blue"],[8],[9],[0,"\\n      "],[7,"i",true],[10,"class","fas fa-arrow-right green"],[8],[9],[0,"\\n    "],[9],[0,"\\n    "],[7,"div",true],[10,"class","application__bluetooth-warning--buttons"],[8],[0,"\\n      "],[7,"button",false],[12,"class","application__bluetooth-warning--button"],[3,"action",[[23,0,[]],"connectHrm"]],[8],[0,"\\n        "],[7,"i",true],[10,"class","fas fa-heart"],[8],[9],[0,"\\n      "],[9],[0,"\\n      "],[7,"button",false],[12,"class","application__bluetooth-warning--button"],[3,"action",[[23,0,[]],"connectDevice"]],[8],[0,"\\n        "],[7,"i",true],[10,"class","fas fa-bolt"],[8],[9],[0,"\\n      "],[9],[0,"\\n\\n      "],[7,"button",false],[12,"class","application__bluetooth-warning--button"],[3,"action",[[23,0,[]],"connectDh"]],[8],[0,"\\n        "],[7,"i",true],[10,"class","fas fa-desktop"],[8],[9],[0,"\\n      "],[9],[0,"\\n    "],[9],[0,"\\n  "],[9],[0,"\\n  "],[7,"div",true],[11,"class",[29,["application__user-status ",[28,"if",[[24,["localUser"]],"user-valid"],null]," ",[28,"if",[[24,["showCheater"]],"cheater"],null]]]],[8],[0,"\\n"],[4,"if",[[24,["showCheater"]]],null,{"statements":[[0,"      "],[7,"div",true],[10,"class","application__user-status--cheater"],[8],[9],[0,"\\n"]],"parameters":[]},null],[0,"    "],[1,[24,["localUser","name"]],false],[7,"br",true],[8],[9],[0,"\\n    "],[7,"i",true],[10,"class","fas fa-bolt"],[8],[9],[1,[24,["localUser","lastPower"]],false],[0," \\n"],[4,"if",[[24,["localUser","hrm"]]],null,{"statements":[[0,"      "],[7,"i",true],[10,"class","fas fa-heart"],[8],[9],[1,[24,["localUser","hrm"]],false],[0," \\n"]],"parameters":[]},null],[0,"    "],[7,"a",false],[12,"href","#"],[3,"action",[[23,0,[]],"connectDevice"]],[8],[0,"Power/Trainer"],[9],[0," \\n    "],[7,"a",false],[12,"href","#"],[3,"action",[[23,0,[]],"connectHrm"]],[8],[0,"HRM"],[9],[0," \\n    "],[7,"br",true],[8],[9],[0,"\\n\\n\\n    Handicap "],[1,[24,["localUser","handicap"]],false],[0," \\n    "],[4,"link-to",null,[["route"],["set-up-user"]],{"statements":[[0,"Change"]],"parameters":[]},null],[0,"\\n  "],[9],[0,"\\n"],[9]],"hasEval":false}',meta:{moduleName:"bt-web2/application/template.hbs"}})
e.default=t})),define("bt-web2/cldrs/en",["exports"],(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
var t=[{locale:"en-US",parentLocale:"en"},{locale:"en",pluralRuleFunction:function(e,t){var n=String(e).split("."),r=!n[1],o=Number(n[0])==e,i=o&&n[0].slice(-1),a=o&&n[0].slice(-2)
return t?1==i&&11!=a?"one":2==i&&12!=a?"two":3==i&&13!=a?"few":"other":1==e&&r?"one":"other"},fields:{year:{displayName:"year",relative:{0:"this year",1:"next year","-1":"last year"},relativeTime:{future:{one:"in {0} year",other:"in {0} years"},past:{one:"{0} year ago",other:"{0} years ago"}}},"year-short":{displayName:"yr.",relative:{0:"this yr.",1:"next yr.","-1":"last yr."},relativeTime:{future:{one:"in {0} yr.",other:"in {0} yr."},past:{one:"{0} yr. ago",other:"{0} yr. ago"}}},month:{displayName:"month",relative:{0:"this month",1:"next month","-1":"last month"},relativeTime:{future:{one:"in {0} month",other:"in {0} months"},past:{one:"{0} month ago",other:"{0} months ago"}}},"month-short":{displayName:"mo.",relative:{0:"this mo.",1:"next mo.","-1":"last mo."},relativeTime:{future:{one:"in {0} mo.",other:"in {0} mo."},past:{one:"{0} mo. ago",other:"{0} mo. ago"}}},day:{displayName:"day",relative:{0:"today",1:"tomorrow","-1":"yesterday"},relativeTime:{future:{one:"in {0} day",other:"in {0} days"},past:{one:"{0} day ago",other:"{0} days ago"}}},"day-short":{displayName:"day",relative:{0:"today",1:"tomorrow","-1":"yesterday"},relativeTime:{future:{one:"in {0} day",other:"in {0} days"},past:{one:"{0} day ago",other:"{0} days ago"}}},hour:{displayName:"hour",relative:{0:"this hour"},relativeTime:{future:{one:"in {0} hour",other:"in {0} hours"},past:{one:"{0} hour ago",other:"{0} hours ago"}}},"hour-short":{displayName:"hr.",relative:{0:"this hour"},relativeTime:{future:{one:"in {0} hr.",other:"in {0} hr."},past:{one:"{0} hr. ago",other:"{0} hr. ago"}}},minute:{displayName:"minute",relative:{0:"this minute"},relativeTime:{future:{one:"in {0} minute",other:"in {0} minutes"},past:{one:"{0} minute ago",other:"{0} minutes ago"}}},"minute-short":{displayName:"min.",relative:{0:"this minute"},relativeTime:{future:{one:"in {0} min.",other:"in {0} min."},past:{one:"{0} min. ago",other:"{0} min. ago"}}},second:{displayName:"second",relative:{0:"now"},relativeTime:{future:{one:"in {0} second",other:"in {0} seconds"},past:{one:"{0} second ago",other:"{0} seconds ago"}}},"second-short":{displayName:"sec.",relative:{0:"now"},relativeTime:{future:{one:"in {0} sec.",other:"in {0} sec."},past:{one:"{0} sec. ago",other:"{0} sec. ago"}}}},numbers:{decimal:{long:[[1e3,{one:["0 thousand",1],other:["0 thousand",1]}],[1e4,{one:["00 thousand",2],other:["00 thousand",2]}],[1e5,{one:["000 thousand",3],other:["000 thousand",3]}],[1e6,{one:["0 million",1],other:["0 million",1]}],[1e7,{one:["00 million",2],other:["00 million",2]}],[1e8,{one:["000 million",3],other:["000 million",3]}],[1e9,{one:["0 billion",1],other:["0 billion",1]}],[1e10,{one:["00 billion",2],other:["00 billion",2]}],[1e11,{one:["000 billion",3],other:["000 billion",3]}],[1e12,{one:["0 trillion",1],other:["0 trillion",1]}],[1e13,{one:["00 trillion",2],other:["00 trillion",2]}],[1e14,{one:["000 trillion",3],other:["000 trillion",3]}]],short:[[1e3,{one:["0K",1],other:["0K",1]}],[1e4,{one:["00K",2],other:["00K",2]}],[1e5,{one:["000K",3],other:["000K",3]}],[1e6,{one:["0M",1],other:["0M",1]}],[1e7,{one:["00M",2],other:["00M",2]}],[1e8,{one:["000M",3],other:["000M",3]}],[1e9,{one:["0B",1],other:["0B",1]}],[1e10,{one:["00B",2],other:["00B",2]}],[1e11,{one:["000B",3],other:["000B",3]}],[1e12,{one:["0T",1],other:["0T",1]}],[1e13,{one:["00T",2],other:["00T",2]}],[1e14,{one:["000T",3],other:["000T",3]}]]}}}]
e.default=t})),define("bt-web2/components/create-race-widget/component",["exports","bt-web2/server-client-common/RideMap","bt-web2/server-client-common/communication","bt-web2/server-client-common/ServerHttpObjects","bt-web2/set-up-ride/route","bt-web2/services/platform-manager","bt-web2/server-client-common/DecorationFactory"],(function(e,t,n,r,o,i,a){var s,c
function u(e){return(u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function l(e){return function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t]
return n}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function f(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function p(e,t){for(var n=0;n<t.length;n++){var r=t[n]
r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function d(e,t,n){return t&&p(e.prototype,t),n&&p(e,n),e}function h(e,t){return!t||"object"!==u(t)&&"function"!=typeof t?y(e):t}function m(e){return(m=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function y(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called")
return e}function v(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function")
e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&b(e,t)}function b(e,t){return(b=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function g(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}Object.defineProperty(e,"__esModule",{value:!0}),e.default=e.RideMapResampleDistance=void 0
var _=function(e){function t(e,n){var r
return f(this,t),g(y(r=h(this,m(t).call(this))),"_src",void 0),g(y(r),"_myDistance",void 0),r._src=e,r._myDistance=n,r}return v(t,e),d(t,[{key:"getElevationAtDistance",value:function(e){var t=e/this._myDistance*this._src.getLength()
return this._src.getElevationAtDistance(t)}},{key:"getLength",value:function(){return this._myDistance}}]),t}(t.RideMapPartial)
function w(e){for(var t,n=this,r=e.target.files,o=0;t=r[o];o++)if(t.name.endsWith(".gpx")){var a=new FileReader
a.onload=function(e){var t,r,o=null===(t=e.target)||void 0===t?void 0:t.result
if("string"!=typeof o)return console.error("File contents showed up as ",null===(r=e.target)||void 0===r?void 0:r.result),void alert("Couldn't parse.")
var a=(new DOMParser).parseFromString(o,"text/xml").querySelectorAll("trkseg trkpt")
if(a.length<=0)alert("No dist/elev data found")
else{var s=[0],c=[parseFloat(a[0].querySelector("ele").innerHTML)]
if(isFinite(c[0])||!isNaN(c[0])){var u=0
l(a).slice(1).forEach((function(e,t){var n,r=a[t+1-1],o={latitude:parseFloat(r.attributes.lat.value),longitude:parseFloat(r.attributes.lon.value)},i={latitude:parseFloat(e.attributes.lat.value),longitude:parseFloat(e.attributes.lon.value)},l=window.geolib.getDistance(o,i,.1),f=parseFloat((null===(n=e.querySelector("ele"))||void 0===n?void 0:n.innerHTML)||"")
u+=l,(isFinite(u)||!isNaN(u))&&(isFinite(f)||!isNaN(f))?(s.push(u),c.push(f)):alert("Failed to parse data")})),s.length>0&&c.length>0&&s.length===c.length?n.set("uploadMapData",new i.ElevDistanceMap(c,s)):alert("Failed to import map data")}else alert("Failed to parse data")}},a.readAsText(t)}}e.RideMapResampleDistance=_
var S,P,k,O,E,T,j=(s=Ember.computed("meters","rideName","uploadMapData"),c=function(e){function n(){return f(this,n),h(this,m(n).apply(this,arguments))}return v(n,e),d(n,[{key:"didInsertElement",value:function(){var e=this.element.querySelector('input[type="file"]')
e&&e.addEventListener("change",w.bind(this),!1)
var t=new Date
t=new Date(t.getTime()-6e4*t.getTimezoneOffset()),this.set("raceDate",t.toISOString().split("T")[0]),this.set("raceTime",((new Date).getHours()+1)%24+":00")
var n=this.devices.getLocalUser()
if(!n)throw new Error("You're not signed in!")
this.set("raceName","".concat(n.getName(),"'s Race"))}},{key:"race",get:function(){var e=this.get("uploadMapData")
return e?new _(e,this.get("meters")):new t.PureCosineMap(parseInt(""+this.get("meters")))}}]),n}(Ember.Component.extend({meters:2e4,raceName:"My Ride",raceDate:new Date((new Date).getTime()+18e6),raceTime:"12:00",classNames:["create-race-widget__container"],race:null,uploadMapData:null,onRaceCreated:function(e){},devices:Ember.inject.service("devices"),platformManager:Ember.inject.service("platform-manager"),actions:{setUpStrava:function(){var e=this
this.get("platformManager").getStravaMapList().then((function(t){var n=t.map((function(e,t){return t+") "+e.name+" ("+(e.distance/1e3).toFixed(1)+"km)"})),r=prompt("Select a map \n"+n.join("\n"))
if(r){var o=parseInt(r)
if(isFinite(o))return e.get("platformManager").getStravaMapDetails(t[o]).then((function(n){e.set("uploadMapData",n),e.set("meters",n.getLength()),e.set("raceName",t[o].name)}))}}))},randomCourse:function(e){this.set("meters",e)
for(var t=0,r=[t],o=0;o<e;o+=500){var i=t+500*(0,a.randRange)(-.05,.05)
r.push(i),t=i}var s=new n.SimpleElevationMap(r,e)
this.set("race",s),this.set("raceName","Quick ".concat(e,"m race"))},buildFromTcx:function(){},createRace:function(){var e=this,t=this.get("race"),n=this.get("raceDate"),i=this.get("raceTime").split(":")
if(2!==i.length)throw new Error("Invalid/expected time")
var a=parseInt(i[0])
if(!isFinite(a)||a<0||a>=24)throw new Error("Invalid hours")
var s=parseInt(i[1])
if(!isFinite(s)||s<0||s>=60)throw new Error("Invalid minutes")
var c=new Date(n),u=60*c.getTimezoneOffset()*1e3;(c=new Date(c.getTime()+u)).setHours(a),c.setMinutes(s)
var l=this.devices.getLocalUser()
if(!l)throw new Error("You're not signed in!")
var f=new r.ScheduleRacePostRequest(t,c,this.get("raceName"),l.getName())
return(0,o.apiPost)("create-race",f).then((function(){e.onRaceCreated(f)}),(function(e){console.error(e),alert("Failed to create your ride")}))}}})),S=c.prototype,P="race",k=[s],O=Object.getOwnPropertyDescriptor(c.prototype,"race"),E=c.prototype,T={},Object.keys(O).forEach((function(e){T[e]=O[e]})),T.enumerable=!!T.enumerable,T.configurable=!!T.configurable,("value"in T||T.initializer)&&(T.writable=!0),T=k.slice().reverse().reduce((function(e,t){return t(S,P,e)||e}),T),E&&void 0!==T.initializer&&(T.value=T.initializer?T.initializer.call(E):void 0,T.initializer=void 0),void 0===T.initializer&&(Object.defineProperty(S,P,T),T=null),c)
e.default=j})),define("bt-web2/components/create-race-widget/template",["exports"],(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
var t=Ember.HTMLBars.template({id:"0C/zOAX4",block:'{"symbols":[],"statements":[[7,"div",true],[10,"class","create-race-widget__param"],[8],[0,"\\n  "],[7,"div",true],[10,"class","create-race-widget__param--title"],[8],[0,"Length (meters)"],[9],[0,"\\n  "],[1,[28,"input",null,[["class","type","value"],["create-race-widget__text","number",[24,["meters"]]]]],false],[0,"\\n"],[9],[0,"\\n"],[7,"div",true],[10,"class","create-race-widget__param"],[8],[0,"\\n  "],[7,"div",true],[10,"class","create-race-widget__param--title"],[8],[0,"Pick Course"],[9],[0,"\\n"],[4,"if",[[24,["stravaLink"]]],null,{"statements":[],"parameters":[]},{"statements":[[0,"    "],[7,"button",false],[12,"class","create-race-widget__button"],[3,"action",[[23,0,[]],"setUpStrava"]],[8],[0,"Pick From Strava"],[9],[0,"\\n    "],[7,"label",true],[10,"for","gpx-upload"],[8],[0,"\\n      "],[7,"input",true],[10,"id","gpx-upload"],[10,"class","create-race-widget__button file-upload"],[10,"type","file"],[8],[9],[0,"\\n      "],[7,"span",true],[10,"class","create-race-widget__button"],[8],[0,"Upload GPX"],[9],[0,"\\n    "],[9],[0,"\\n    "],[7,"div",true],[10,"class","create-race-widget__quick-label"],[8],[0,"Quick Start"],[9],[0,"\\n    "],[7,"div",true],[10,"class","create-race-widget__quick-container"],[8],[0,"\\n      "],[7,"button",false],[12,"class","create-race-widget__quick-button"],[3,"action",[[23,0,[]],"randomCourse",6000]],[8],[0,"6km"],[9],[0,"\\n      "],[7,"button",false],[12,"class","create-race-widget__quick-button"],[3,"action",[[23,0,[]],"randomCourse",10000]],[8],[0,"10km"],[9],[0,"\\n      "],[7,"button",false],[12,"class","create-race-widget__quick-button"],[3,"action",[[23,0,[]],"randomCourse",15000]],[8],[0,"15km"],[9],[0,"\\n      "],[7,"button",false],[12,"class","create-race-widget__quick-button"],[3,"action",[[23,0,[]],"randomCourse",20000]],[8],[0,"20km"],[9],[0,"\\n    "],[9],[0,"\\n"]],"parameters":[]}],[9],[0,"\\n"],[7,"div",true],[10,"class","create-race-widget__param"],[8],[0,"\\n  "],[7,"div",true],[10,"class","create-race-widget__param--title"],[8],[0,"Name Of Your Ride"],[9],[0,"\\n  "],[1,[28,"input",null,[["class","type","value"],["create-race-widget__text","text",[24,["raceName"]]]]],false],[0,"\\n"],[9],[0,"\\n"],[7,"div",true],[10,"class","create-race-widget__param"],[8],[0,"\\n  "],[7,"div",true],[10,"class","create-race-widget__param--title"],[8],[0,"When are you riding? (date)"],[9],[0,"\\n  "],[1,[28,"input",null,[["class","id","type","value"],["create-race-widget__text","when-date","date",[24,["raceDate"]]]]],false],[0,"\\n  "],[7,"div",true],[10,"class","create-race-widget__param--title"],[8],[0,"When are you riding? (time)"],[9],[0,"\\n  "],[1,[28,"input",null,[["class","id","type","value"],["create-race-widget__text","when-time","time",[24,["raceTime"]]]]],false],[0,"\\n"],[9],[0,"\\n"],[1,[28,"mini-map",null,[["class","race"],["create-race-widget__minimap",[24,["race"]]]]],false],[0,"\\n"],[7,"button",false],[12,"class","create-race-widget__button"],[3,"action",[[23,0,[]],"createRace"]],[8],[0,"Submit Ride"],[9]],"hasEval":false}',meta:{moduleName:"bt-web2/components/create-race-widget/template.hbs"}})
e.default=t})),define("bt-web2/components/display-post-race-spending/component",["exports"],(function(e){function t(e){return(t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function n(e,n){return!n||"object"!==t(n)&&"function"!=typeof n?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called")
return e}(e):n}function r(e){return(r=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function o(e,t){return(o=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
var i=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),n(this,r(t).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function")
e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&o(e,t)}(t,Ember.Component.extend({})),t}()
e.default=i})),define("bt-web2/components/display-post-race-spending/template",["exports"],(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
var t=Ember.HTMLBars.template({id:"0w3uIgBq",block:'{"symbols":["result","index"],"statements":[[7,"h3",true],[10,"class","display-post-race__title"],[8],[1,[22,"title"],false],[9],[0,"\\n"],[7,"p",true],[10,"class","display-post-race__text"],[8],[1,[22,"description"],false],[9],[0,"\\n"],[7,"table",true],[10,"class","display-post-race__table"],[8],[0,"\\n"],[4,"each",[[24,["list"]]],null,{"statements":[[0,"    "],[7,"tr",true],[10,"class","display-post-race__result"],[8],[0,"\\n      "],[7,"td",true],[8],[0,"#"],[1,[28,"add",[[23,2,[]],1],null],false],[9],[0,"\\n      "],[7,"td",true],[8],[1,[23,1,["name"]],false],[9],[0,"\\n      "],[7,"td",true],[8],[0,"\\n"],[4,"if",[[23,1,["spending"]]],null,{"statements":[[4,"if",[[24,["overDistanceKm"]]],null,{"statements":[[0,"            "],[1,[28,"divide",[[23,1,["spending"]],[24,["overDistanceKm"]],1],null],false],[0,"/km\\n"]],"parameters":[]},{"statements":[[0,"            "],[1,[23,1,["spending"]],false],[0,"\\n"]],"parameters":[]}]],"parameters":[]},{"statements":[[0,"          Not Finished\\n"]],"parameters":[]}],[0,"      "],[9],[0,"\\n    "],[9],[0,"\\n"]],"parameters":[1,2]},null],[9]],"hasEval":false}',meta:{moduleName:"bt-web2/components/display-post-race-spending/template.hbs"}})
e.default=t})),define("bt-web2/components/display-post-race/component",["exports","bt-web2/server-client-common/Utils","bt-web2/server-client-common/User"],(function(e,t,n){var r,o
function i(e){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function a(e){return(a=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function s(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called")
return e}function c(e,t){return(c=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function u(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function l(e,t){for(var n=0;n<t.length;n++){var r=t[n]
r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function f(e,t,n){return t&&l(e.prototype,t),n&&l(e,n),e}function p(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
var d,h,m,y,v,b,g=function(){function e(t,n){u(this,e),p(this,"_data",void 0),p(this,"_id",void 0),p(this,"_ix",void 0),this._id=t,this._data=n
var r=n.rankings.findIndex((function(e){return e===t}))
if(r<0||r>=n.rankings.length)throw new Error("Couldn't find user")
this._ix=r}return f(e,[{key:"getName",value:function(){return this._data.names[this._ix]}},{key:"getUserType",value:function(){return this._data.types[this._ix]}},{key:"getHandicap",value:function(){return this._data.handicaps[this._ix]}},{key:"getHandicapSecondsSaved",value:function(){return this._data.hsSaved[this._ix]}},{key:"getHandicapSecondsUsed",value:function(){return this._data.userSpending[this._ix]}},{key:"getId",value:function(){return this._id}},{key:"setId",value:function(e){throw new Error("Method not implemented.")}},{key:"setHandicap",value:function(e){throw new Error("Method not implemented.")}},{key:"setChat",value:function(e,t){throw new Error("Method not implemented.")}},{key:"getLastChat",value:function(e){throw new Error("Method not implemented.")}},{key:"getLastElevation",value:function(){return 0}},{key:"getPositionUpdate",value:function(e){throw new Error("Method not implemented.")}},{key:"setDistance",value:function(e){throw new Error("Method not implemented.")}},{key:"setSpeed",value:function(e){throw new Error("Method not implemented.")}},{key:"setDistanceHistory",value:function(e){throw new Error("Method not implemented.")}},{key:"getDistanceHistory",value:function(){throw new Error("Method not implemented.")}},{key:"getLastSlopeInWholePercent",value:function(){throw new Error("Method not implemented.")}},{key:"getDistance",value:function(){throw new Error("Method not implemented.")}},{key:"getSpeed",value:function(){throw new Error("Method not implemented.")}},{key:"getImage",value:function(){throw new Error("Method not implemented.")}},{key:"getBigImageMd5",value:function(){throw new Error("Method not implemented.")}},{key:"getLastHandicapChangeTime",value:function(){throw new Error("Method not implemented.")}},{key:"physicsTick",value:function(e,t,n){throw new Error("Method not implemented.")}},{key:"notifyDrafteeThisCycle",value:function(e,t){throw new Error("Method not implemented.")}},{key:"getDrafteeCount",value:function(e){throw new Error("Method not implemented.")}},{key:"getSecondsAgoToCross",value:function(e,t){throw new Error("Method not implemented.")}},{key:"isDraftingLocalUser",value:function(){throw new Error("Method not implemented.")}},{key:"getLastWattsSaved",value:function(){throw new Error("Method not implemented.")}},{key:"hasDraftersThisCycle",value:function(e){throw new Error("Method not implemented.")}},{key:"getDisplay",value:function(e){throw new Error("Method not implemented.")}},{key:"setImage",value:function(e,t){throw new Error("Method not implemented.")}},{key:"absorbNameUpdate",value:function(e,t,n,r){throw new Error("Method not implemented.")}},{key:"absorbPositionUpdate",value:function(e,t){throw new Error("Method not implemented.")}},{key:"isPowerValid",value:function(e){throw new Error("Method not implemented.")}},{key:"notifyPower",value:function(e,t){throw new Error("Method not implemented.")}},{key:"notifyCadence",value:function(e,t){throw new Error("Method not implemented.")}},{key:"notifyHrm",value:function(e,t){throw new Error("Method not implemented.")}},{key:"getLastHrm",value:function(e){throw new Error("Method not implemented.")}},{key:"getLastPower",value:function(){throw new Error("Method not implemented.")}},{key:"setFinishTime",value:function(e){throw new Error("Method not implemented.")}},{key:"getRaceTimeSeconds",value:function(e){throw new Error("Method not implemented.")}},{key:"isFinished",value:function(){throw new Error("Method not implemented.")}},{key:"getMsSinceLastPacket",value:function(e){throw new Error("Method not implemented.")}},{key:"notePacket",value:function(e){throw new Error("Method not implemented.")}}]),e}(),_=function(){function e(t){var n=this
u(this,e),p(this,"users",void 0),this.users=[],t.rankings.forEach((function(e){n.users.push(new g(e,t))}))}return f(e,[{key:"getUsers",value:function(e){return this.users}},{key:"getUser",value:function(e){return this.users.find((function(t){return t.getId()===e}))||null}},{key:"getLocalUser",value:function(){return null}}]),e}(),w=(r=Ember.computed("results","frame","users"),d=(o=function(e){function r(){var e,t
u(this,r)
for(var n=arguments.length,o=new Array(n),c=0;c<n;c++)o[c]=arguments[c]
return t=function(e,t){return!t||"object"!==i(t)&&"function"!=typeof t?s(e):t}(this,(e=a(r)).call.apply(e,[this].concat(o))),p(s(t),"results",null),p(s(t),"users",null),t}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function")
e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&c(e,t)}(r,Ember.Component.extend({})),f(r,[{key:"didInsertElement",value:function(){var e=this.get("results")
e&&this.set("users",new _(e))}},{key:"processedRankings",get:function(){var e=this.get("results"),r=this.get("users")
if(console.log("post-race display! ",e),e&&r){var o=[],i=e.rankings.find((function(e){var t=r.getUser(e)
return t&&t.getUserType()&n.UserTypeFlags.Ai}))
e.rankings.forEach((function(n,a){var s=r.getUser(n),c=(null==s?void 0:s.getName())||"Unknown",u=e.times[a]
o.push({userId:n,name:n===i?"Lead AI":c,rank:"#".concat(a+1),time:(0,t.formatSecondsHms)(u),hsSaved:e.hsSaved[a],efficiency:e.efficiency[a],spending:e.userSpending[a]})}))
var a={byRank:(o=o.filter((function(e){var t=r.getUser(e.userId)
return!!t&&(!(t.getUserType()&n.UserTypeFlags.Ai)||t.getId()===i)}))).slice(),byHs:o.slice().sort((function(e,t){return e.hsSaved>t.hsSaved?-1:1})).map((function(e){return{name:e.name,hsSaved:e.hsSaved.toFixed(1)}})),byEfficiency:o.slice().sort((function(e,t){return e.efficiency>t.efficiency?-1:1})).map((function(e){return{name:e.name,efficiency:"".concat(e.efficiency.toFixed(1),"/km")}}))}
for(var s in e.userSpending[0])console.log("need to compute for ",s),a[s]=o.slice().sort((function(e,t){return e.spending[s]>t.spending[s]?-1:1})).map((function(e){return{name:e.name,spending:"".concat(e.spending[s].toFixed(1))}}))
return console.log("final = ",a),a.raceDistanceKm=e.raceLengthKm,a.halfDistanceKm=e.raceLengthKm/2,a.sprintDistanceKm=.5,a}return{byRank:[],byHs:[],byEfficiency:[]}}}]),r}()).prototype,h="processedRankings",m=[r],y=Object.getOwnPropertyDescriptor(o.prototype,"processedRankings"),v=o.prototype,b={},Object.keys(y).forEach((function(e){b[e]=y[e]})),b.enumerable=!!b.enumerable,b.configurable=!!b.configurable,("value"in b||b.initializer)&&(b.writable=!0),b=m.slice().reverse().reduce((function(e,t){return t(d,h,e)||e}),b),v&&void 0!==b.initializer&&(b.value=b.initializer?b.initializer.call(v):void 0,b.initializer=void 0),void 0===b.initializer&&(Object.defineProperty(d,h,b),b=null),o)
e.default=w})),define("bt-web2/components/display-post-race/template",["exports"],(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
var t=Ember.HTMLBars.template({id:"xq5KE3P9",block:'{"symbols":["result","index","result","index","result"],"statements":[[1,[22,"tourjs-header"],false],[0,"\\n\\n\\n"],[7,"div",true],[10,"class","display-post-race__rankings"],[8],[0,"\\n  "],[7,"h3",true],[10,"class","display-post-race__title"],[8],[0,"Rankings:"],[9],[0,"\\n  "],[7,"table",true],[10,"class","display-post-race__table"],[8],[0,"\\n"],[4,"each",[[24,["processedRankings","byRank"]]],null,{"statements":[[0,"      "],[7,"tr",true],[10,"class","display-post-race__result"],[8],[0,"\\n        "],[7,"td",true],[8],[1,[23,5,["rank"]],false],[9],[0,"\\n        "],[7,"td",true],[8],[1,[23,5,["name"]],false],[9],[0,"\\n        "],[7,"td",true],[8],[0,"\\n"],[4,"if",[[23,5,["time"]]],null,{"statements":[[0,"            "],[1,[23,5,["time"]],false],[0,"\\n"]],"parameters":[]},{"statements":[[0,"            Not Finished\\n"]],"parameters":[]}],[0,"        "],[9],[0,"\\n      "],[9],[0,"\\n"]],"parameters":[5]},null],[0,"  "],[9],[0,"\\n\\n\\n  "],[7,"h3",true],[10,"class","display-post-race__title"],[8],[0,"Draft Kings and Queens:"],[9],[0,"\\n  "],[7,"p",true],[10,"class","display-post-race__text"],[8],[0,"This shows how many FTP-seconds of energy each person saved.  An FTP-second saved means for a 250W rider, they got to skip doing 250W for a second.  Or they got to do 125W less for 2 seconds."],[9],[0,"\\n  "],[7,"table",true],[10,"class","display-post-race__table"],[8],[0,"\\n"],[4,"each",[[24,["processedRankings","byHs"]]],null,{"statements":[[0,"      "],[7,"tr",true],[10,"class","display-post-race__result"],[8],[0,"\\n        "],[7,"td",true],[8],[0,"#"],[1,[28,"add",[[23,4,[]],1],null],false],[9],[0,"\\n        "],[7,"td",true],[8],[1,[23,3,["name"]],false],[9],[0,"\\n        "],[7,"td",true],[8],[0,"\\n"],[4,"if",[[23,3,["hsSaved"]]],null,{"statements":[[0,"            "],[1,[23,3,["hsSaved"]],false],[0,"\\n"]],"parameters":[]},{"statements":[[0,"            Not Finished\\n"]],"parameters":[]}],[0,"        "],[9],[0,"\\n      "],[9],[0,"\\n"]],"parameters":[3,4]},null],[0,"  "],[9],[0,"\\n\\n  \\n  "],[7,"h3",true],[10,"class","display-post-race__title"],[8],[0,"The \\"Definitely Not A Prius\\" Award"],[9],[0,"\\n  "],[7,"p",true],[10,"class","display-post-race__text"],[8],[0,"Who used the most energy per km?  Rankings are by FTP-seconds spent per kilometer."],[9],[0,"\\n  "],[7,"table",true],[10,"class","display-post-race__table"],[8],[0,"\\n"],[4,"each",[[24,["processedRankings","byEfficiency"]]],null,{"statements":[[0,"      "],[7,"tr",true],[10,"class","display-post-race__result"],[8],[0,"\\n        "],[7,"td",true],[8],[0,"#"],[1,[28,"add",[[23,2,[]],1],null],false],[9],[0,"\\n        "],[7,"td",true],[8],[1,[23,1,["name"]],false],[9],[0,"\\n        "],[7,"td",true],[8],[0,"\\n"],[4,"if",[[23,1,["efficiency"]]],null,{"statements":[[0,"            "],[1,[23,1,["efficiency"]],false],[0,"\\n"]],"parameters":[]},{"statements":[[0,"            Not Finished\\n"]],"parameters":[]}],[0,"        "],[9],[0,"\\n      "],[9],[0,"\\n"]],"parameters":[1,2]},null],[0,"  "],[9],[0,"\\n\\n\\n  "],[1,[28,"display-post-race-spending",null,[["list","overDistanceKm","title","description"],[[24,["processedRankings","last-500m"]],[24,["processedRankings","sprintDistanceKm"]],"Sprint Finish","Energy spent in the last 500m"]]],false],[0,"\\n\\n  "],[1,[28,"display-post-race-spending",null,[["list","overDistanceKm","title","description"],[[24,["processedRankings","first-half"]],[24,["processedRankings","halfDistanceKm"]],"First Half Heroes","Energy spent in the first half of the course.  You don\'t want to be winning this ranking."]]],false],[0,"\\n\\n       \\n  "],[1,[28,"display-post-race-spending",null,[["list","overDistanceKm","title","description"],[[24,["processedRankings","last-half"]],[24,["processedRankings","halfDistanceKm"]],"Negative Splits Aren\'t So Negative","Energy spent in the second half of the course"]]],false],[0,"\\n\\n  "],[1,[28,"display-post-race-spending",null,[["list","title","description"],[[24,["processedRankings","while-downhill"]],"Which Way Does Gravity Go?","Total FTP-seconds spent on downhill segments.  It\'s probably unwise to win this ranking."]]],false],[0,"\\n  \\n  "],[1,[28,"display-post-race-spending",null,[["list","title","description"],[[24,["processedRankings","while-uphill"]],"Up Up And Away!","Total FTP-seconds spent on uphill segments"]]],false],[0,"\\n       \\n  "],[1,[28,"display-post-race-spending",null,[["list","overDistanceKm","title","description"],[[24,["processedRankings","whole-course"]],[24,["processedRankings","raceDistanceKm"]],"Total Energy Spent","Total FTP-seconds spent on the entire course"]]],false],[0,"\\n\\n    "],[7,"br",true],[8],[9],[7,"br",true],[8],[9],[7,"br",true],[8],[9],[7,"br",true],[8],[9],[7,"br",true],[8],[9],[7,"br",true],[8],[9],[7,"br",true],[8],[9],[0,"\\n       \\n"],[9]],"hasEval":false}',meta:{moduleName:"bt-web2/components/display-post-race/template.hbs"}})
e.default=t})),define("bt-web2/components/display-pre-race-rider/component",["exports"],(function(e){function t(e){return(t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function n(e,t){for(var n=0;n<t.length;n++){var r=t[n]
r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function r(e,n){return!n||"object"!==t(n)&&"function"!=typeof n?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called")
return e}(e):n}function o(e){return(o=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function i(e,t){return(i=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
var a=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),r(this,o(t).apply(this,arguments))}var a,s,c
return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function")
e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&i(e,t)}(t,Ember.Component.extend({classNames:["display-pre-race-rider__container"],display:null})),a=t,(s=[{key:"didInsertElement",value:function(){var e=this.get("display").user.getImage()
if(e){var t=this.element.querySelector(".display-pre-race-rider__image")
t&&(t.style.backgroundImage="url('".concat(e,"')"))}}}])&&n(a.prototype,s),c&&n(a,c),t}()
e.default=a})),define("bt-web2/components/display-pre-race-rider/template",["exports"],(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
var t=Ember.HTMLBars.template({id:"bNZ1QwXC",block:'{"symbols":[],"statements":[[7,"div",true],[10,"class","display-pre-race-rider__image-holder"],[8],[0,"\\n  "],[7,"div",true],[10,"class","display-pre-race-rider__image"],[8],[9],[0,"\\n"],[9],[0,"\\n"],[7,"div",true],[10,"class","display-pre-race-rider__text"],[8],[0,"\\n  "],[7,"b",true],[8],[1,[24,["display","name"]],false],[9],[7,"br",true],[8],[9],[0,"\\n  "],[7,"i",true],[10,"class","fas fa-bolt"],[8],[9],[0," "],[1,[24,["display","lastPower"]],false],[7,"br",true],[8],[9],[0,"\\n  Handicap: "],[1,[24,["display","handicap"]],false],[7,"br",true],[8],[9],[0,"\\n"],[9]],"hasEval":false}',meta:{moduleName:"bt-web2/components/display-pre-race-rider/template.hbs"}})
e.default=t})),define("bt-web2/components/display-pre-race/component",["exports"],(function(e){var t,n
function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function o(e,t){for(var n=0;n<t.length;n++){var r=t[n]
r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function i(e,t){return!t||"object"!==r(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called")
return e}(e):t}function a(e){return(a=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function s(e,t){return(s=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
var c,u,l,f,p,d,h=(t=Ember.computed("connection.msOfStart","frame"),c=(n=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),i(this,a(t).apply(this,arguments))}var n,r,c
return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function")
e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&s(e,t)}(t,Ember.Component.extend({connection:Ember.inject.service(),frame:0,classNames:["display-pre-race__container"]})),n=t,(r=[{key:"startsInSeconds",get:function(){var e=this.get("connection").msOfStart
if(e>0){var t=(new Date).getTime()
return(Math.max(0,e-t)/1e3).toFixed(1)}return"Unknown"}}])&&o(n.prototype,r),c&&o(n,c),t}()).prototype,u="startsInSeconds",l=[t],f=Object.getOwnPropertyDescriptor(n.prototype,"startsInSeconds"),p=n.prototype,d={},Object.keys(f).forEach((function(e){d[e]=f[e]})),d.enumerable=!!d.enumerable,d.configurable=!!d.configurable,("value"in d||d.initializer)&&(d.writable=!0),d=l.slice().reverse().reduce((function(e,t){return t(c,u,e)||e}),d),p&&void 0!==d.initializer&&(d.value=d.initializer?d.initializer.call(p):void 0,d.initializer=void 0),void 0===d.initializer&&(Object.defineProperty(c,u,d),d=null),n)
e.default=h})),define("bt-web2/components/display-pre-race/template",["exports"],(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
var t=Ember.HTMLBars.template({id:"z73+Awts",block:'{"symbols":["riderDisplay","riderDisplay","riderDisplay"],"statements":[[1,[22,"tourjs-header"],false],[0,"\\n"],[4,"if",[[24,["startsInSeconds"]]],null,{"statements":[[0,"  "],[7,"div",true],[10,"class","display-pre-race__start"],[8],[0,"\\n    \\n    Starts In: "],[1,[28,"time-display",[[24,["startsInSeconds"]]],null],false],[0,"\\n  "],[9],[0,"\\n"]],"parameters":[]},null],[4,"each",[[24,["localRiders"]]],null,{"statements":[[0,"  "],[1,[28,"display-pre-race-rider",null,[["display"],[[23,3,[]]]]],false],[0,"\\n"]],"parameters":[3]},null],[4,"each",[[24,["nonLocalHumans"]]],null,{"statements":[[0,"  "],[1,[28,"display-pre-race-rider",null,[["display"],[[23,2,[]]]]],false],[0,"\\n"]],"parameters":[2]},null],[4,"each",[[24,["ais"]]],null,{"statements":[[0,"  "],[1,[28,"display-pre-race-rider",null,[["display"],[[23,1,[]]]]],false],[0,"\\n"]],"parameters":[1]},null],[7,"div",true],[10,"class","bluetooth-warning-socket"],[8],[9]],"hasEval":false}',meta:{moduleName:"bt-web2/components/display-pre-race/template.hbs"}})
e.default=t})),define("bt-web2/components/display-race/component",["exports","bt-web2/server-client-common/Utils"],(function(e,t){var n,r
function o(e){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function i(e,t){for(var n=0;n<t.length;n++){var r=t[n]
r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function a(e,t){return!t||"object"!==o(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called")
return e}(e):t}function s(e){return(s=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function c(e,t){return(c=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
var u,l,f,p,d,h,m=(n=Ember.computed("frame"),u=(r=function(e){function n(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,n),a(this,s(n).apply(this,arguments))}var r,o,u
return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function")
e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&c(e,t)}(n,Ember.Component.extend({frame:0,raceState:null,devices:Ember.inject.service("devices"),connection:Ember.inject.service("connection")})),r=n,(o=[{key:"didInsertElement",value:function(){var e=this,n=this.get("raceState");(0,t.assert2)(n),setTimeout((function t(){e.isDestroyed||(e.incrementProperty("frame"),setTimeout(t,200))}))}},{key:"click",value:function(e){if(e&&e.target){var t=e.target.clientWidth,n=e.clientX/t
console.log("you clicked at pos ",e.clientX,e.target.clientWidth),n>.9?this.get("connection").chat("I WILL LEAD"):n<.1&&this.get("connection").chat("I will rest")}}},{key:"recentHandicapChange",get:function(){var e=(new Date).getTime(),t=this.devices.getLocalUser()
return t&&t.getLastHandicapChangeTime()>=e-15e3?t.getHandicap().toFixed(1)+"W":null}}])&&i(r.prototype,o),u&&i(r,u),n}()).prototype,l="recentHandicapChange",f=[n],p=Object.getOwnPropertyDescriptor(r.prototype,"recentHandicapChange"),d=r.prototype,h={},Object.keys(p).forEach((function(e){h[e]=p[e]})),h.enumerable=!!h.enumerable,h.configurable=!!h.configurable,("value"in h||h.initializer)&&(h.writable=!0),h=f.slice().reverse().reduce((function(e,t){return t(u,l,e)||e}),h),d&&void 0!==h.initializer&&(h.value=h.initializer?h.initializer.call(d):void 0,h.initializer=void 0),void 0===h.initializer&&(Object.defineProperty(u,l,h),h=null),r)
e.default=m})),define("bt-web2/components/display-race/template",["exports"],(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
var t=Ember.HTMLBars.template({id:"T2DLDjMP",block:'{"symbols":[],"statements":[[0,"\\n"],[7,"div",true],[10,"class","display-race__content"],[8],[0,"\\n  "],[7,"div",true],[10,"class","display-race__main-holder"],[8],[0,"\\n    "],[1,[28,"main-map",null,[["raceState"],[[24,["raceState"]]]]],false],[0,"\\n    "],[7,"div",true],[10,"class","display-race__controls-container"],[8],[0,"\\n"],[4,"if",[[24,["overlay"]]],null,{"statements":[[0,"        "],[7,"div",true],[10,"class","display-race__rankings-container"],[8],[0,"\\n          "],[1,[28,"component",[[24,["overlay"]]],[["raceState","overlayData","frame"],[[24,["raceState"]],[24,["overlayData"]],[24,["frame"]]]]],false],[0,"\\n        "],[9],[0,"\\n"]],"parameters":[]},null],[0,"      "],[7,"div",true],[10,"class","display-race__controls-gap"],[8],[9],[0,"\\n      "],[7,"div",true],[10,"class","display-race__status-and-map"],[8],[0,"\\n        \\n        "],[7,"div",true],[10,"class","display-race__status-container"],[8],[0,"\\n          "],[1,[28,"user-dashboard",null,[["raceState","frame"],[[24,["raceState"]],[24,["frame"]]]]],false],[0,"\\n        "],[9],[0,"\\n        "],[7,"div",true],[10,"class","display-race__mini-map-container"],[8],[0,"\\n          "],[1,[28,"mini-map-live",null,[["raceState"],[[24,["raceState"]]]]],false],[0,"\\n        "],[9],[0,"\\n        \\n      "],[9],[0,"\\n      "],[7,"div",true],[11,"class",[29,["display-race__handicap-update-container ",[28,"if",[[24,["recentHandicapChange"]],"show"],null]]]],[8],[0,"\\n        Handicap revised to "],[1,[22,"recentHandicapChange"],false],[7,"br",true],[8],[9],[0,"\\n        Congratulations!\\n      "],[9],[0,"\\n    "],[9],[0,"\\n  "],[9],[0,"\\n"],[9]],"hasEval":false}',meta:{moduleName:"bt-web2/components/display-race/template.hbs"}})
e.default=t})),define("bt-web2/components/joinable-ride/component",["exports"],(function(e){function t(e){return(t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function n(e,n){return!n||"object"!==t(n)&&"function"!=typeof n?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called")
return e}(e):n}function r(e){return(r=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function o(e,t){return(o=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
var i=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),n(this,r(t).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function")
e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&o(e,t)}(t,Ember.Component.extend({})),t}()
e.default=i})),define("bt-web2/components/joinable-ride/template",["exports"],(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
var t=Ember.HTMLBars.template({id:"i1nzw0UR",block:'{"symbols":["&default"],"statements":[[14,1]],"hasEval":false}',meta:{moduleName:"bt-web2/components/joinable-ride/template.hbs"}})
e.default=t})),define("bt-web2/components/leader-board/component",["exports","bt-web2/server-client-common/User","bt-web2/server-client-common/Utils"],(function(e,t,n){var r,o
function i(e){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function a(e,t){for(var n=0;n<t.length;n++){var r=t[n]
r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function s(e,t){return!t||"object"!==i(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called")
return e}(e):t}function c(e){return(c=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function u(e,t){return(u=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function l(e){var t=e>=0?"":"-"
if(e>-10&&e<10)return"".concat(t).concat(Math.abs(e).toFixed(2),"s")
if(e>-60&&e<60)return"".concat(t).concat(Math.abs(e).toFixed(1),"s")
var n=Math.abs(e),r=Math.floor(n/60),o=n-60*r
return"".concat(t).concat(r.toFixed(0),"m").concat(o.toFixed(0),"s")}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
var f,p,d,h,m,y,v=(r=Ember.computed("frame"),f=(o=function(e){function r(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r),s(this,c(r).apply(this,arguments))}var o,i,f
return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function")
e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&u(e,t)}(r,Ember.Component.extend({raceState:null,classNames:["leader-board__container"]})),o=r,(i=[{key:"didInsertElement",value:function(){(0,n.assert2)(this.get("raceState"))}},{key:"rankings",get:function(){var e=(new Date).getTime(),n=this.get("raceState")
if(n){var r=n.getUserProvider().getUsers(e)
if(r.length<=0)return null
for(var o=function(e){var n=[],r=e[0],o=0,i=e.find((function(e){return e.getUserType()&t.UserTypeFlags.Local}))
if(!i)return[]
for(var a=0;a<e.length;a++){var s=e[a]
if(r.getUserType()&t.UserTypeFlags.Ai)if(s.getUserType()&t.UserTypeFlags.Ai);else{var c=new t.User("Gr. "+r.getName(),t.DEFAULT_RIDER_MASS,t.DEFAULT_HANDICAP_POWER,r.getUserType()),u=e[o],l=u.getDistance()>i.getDistance()?r:u
c.setDistance(l.getDistance()),c.setSpeed(l.getSpeed()),c.setDistanceHistory(l.getDistanceHistory()),n.push({user:c,rank:"#".concat(o+1)}),n.push({user:s,rank:"#".concat(a+1)}),o=a+1}else s.getUserType()&t.UserTypeFlags.Ai||(n.push({user:s,rank:"#".concat(a+1)}),o=a+1)
r=s}if(r.getUserType()&t.UserTypeFlags.Ai){var f=new t.User("Gr. "+r.getName(),t.DEFAULT_RIDER_MASS,t.DEFAULT_HANDICAP_POWER,r.getUserType()),p=e[o],d=p.getDistance()>i.getDistance()?r:p
f.setDistance(d.getDistance()),f.setSpeed(d.getSpeed()),f.setDistanceHistory(d.getDistanceHistory()),n.push({user:f,rank:"#".concat(o+1)})}return n}(r=r.sort((function(e,t){return e.getDistance()>t.getDistance()?-1:1}))),i=0,a=null,s=0;s<o.length;s++)if(o[s].user.getUserType()&t.UserTypeFlags.Local){i=s,a=o[s].user
break}if(!a)return[]
var c=Math.max(0,Math.min(o.length-6,i-2)),u=Math.min(c+6,r.length)
return(o=o.slice(c,u)).map((function(t,r){var o=t.user,i=Object.assign({rankString:t.rank},t.user.getDisplay(n))
if(a&&o.getId()!==a.getId())if(o.getDistance()>a.getDistance()){var s=o.getSecondsAgoToCross(e,a.getDistance())
null!==s&&s>1&&(i.secondsDelta=l(s))}else{var c=a.getSecondsAgoToCross(e,o.getDistance())
null!==c&&c>1&&(i.secondsDelta=l(-c))}return i}))}return[]}}])&&a(o.prototype,i),f&&a(o,f),r}()).prototype,p="rankings",d=[r],h=Object.getOwnPropertyDescriptor(o.prototype,"rankings"),m=o.prototype,y={},Object.keys(h).forEach((function(e){y[e]=h[e]})),y.enumerable=!!y.enumerable,y.configurable=!!y.configurable,("value"in y||y.initializer)&&(y.writable=!0),y=d.slice().reverse().reduce((function(e,t){return t(f,p,e)||e}),y),m&&void 0!==y.initializer&&(y.value=y.initializer?y.initializer.call(m):void 0,y.initializer=void 0),void 0===y.initializer&&(Object.defineProperty(f,p,y),y=null),o)
e.default=v}))
define("bt-web2/components/leader-board/template",["exports"],(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
var t=Ember.HTMLBars.template({id:"tcLzLFPT",block:'{"symbols":["ranking","index"],"statements":[[4,"each",[[24,["rankings"]]],null,{"statements":[[0,"  "],[7,"div",true],[11,"class",[29,["leader-board__rank ",[23,1,["classString"]]]]],[8],[0,"\\n    "],[7,"span",true],[10,"class","leader-board__rank-text"],[8],[0,"\\n      "],[1,[23,1,["rankString"]],false],[0,"\\n    "],[9],[0,"\\n    "],[7,"span",true],[10,"class","leader-board__rank-name"],[8],[0,"\\n      "],[1,[23,1,["name"]],false],[0,"\\n    "],[9],[0,"\\n    "],[7,"span",true],[10,"class","leader-board__rank-delta"],[8],[0,"\\n"],[4,"if",[[23,1,["secondsDelta"]]],null,{"statements":[[0,"        "],[1,[23,1,["secondsDelta"]],false],[0,"\\n"]],"parameters":[]},null],[0,"    "],[9],[0,"\\n    "],[7,"span",true],[10,"class","leader-board__rank-distance"],[8],[0,"\\n      "],[1,[23,1,["distance"]],false],[0,"\\n    "],[9],[0,"\\n  "],[9],[0,"\\n"]],"parameters":[1,2]},null]],"hasEval":false}',meta:{moduleName:"bt-web2/components/leader-board/template.hbs"}})
e.default=t})),define("bt-web2/components/main-map/component",["exports","bt-web2/server-client-common/drawing","bt-web2/server-client-common/DecorationFactory","bt-web2/server-client-common/DecorationState","bt-web2/config/environment","bt-web2/server-client-common/drawing-constants"],(function(e,t,n,r,o,i){function a(e){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function s(e,t){for(var n=0;n<t.length;n++){var r=t[n]
r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function c(e,t){return!t||"object"!==a(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called")
return e}(e):t}function u(e){return(u=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function l(e,t){return(l=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
var f=function(e){function a(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),c(this,u(a).apply(this,arguments))}var f,p,d
return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function")
e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&l(e,t)}(a,Ember.Component.extend({connection:Ember.inject.service("connection"),classNames:["main-map__container"],tagName:"canvas",raceState:null})),f=a,(p=[{key:"didInsertElement",value:function(){var e,a,s=this,c=this.element
if(c.parentElement){c.width=null===(e=c.parentElement)||void 0===e?void 0:e.clientWidth,c.height=null===(a=c.parentElement)||void 0===a?void 0:a.clientHeight
var u=this.get("raceState")
if(u){var l=new n.DecorationFactory(i.defaultThemeConfig),f=new r.DecorationState(null==u?void 0:u.getMap(),l),p=0,d=new t.PaintFrameState,h=0
requestAnimationFrame((function e(n){if(h++,!u)throw new Error("No race state available?")
var r=0
p&&(r=(n-p)/1e3),p=n
var i=(new Date).getTime()
u.tick(i),h%1==0&&(0,t.doPaintFrameStateUpdates)(o.default.rootURL,i,1*r,u,d),(0,t.paintCanvasFrame)(c,u,n,f,r,d),s.isDestroyed||requestAnimationFrame(e)}))}}}}])&&s(f.prototype,p),d&&s(f,d),a}()
e.default=f})),define("bt-web2/components/main-map/template",["exports"],(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
var t=Ember.HTMLBars.template({id:"oWcsOHrH",block:'{"symbols":[],"statements":[],"hasEval":false}',meta:{moduleName:"bt-web2/components/main-map/template.hbs"}})
e.default=t})),define("bt-web2/components/mini-map-live/component",["exports","bt-web2/server-client-common/Utils","bt-web2/server-client-common/drawing","bt-web2/server-client-common/User"],(function(e,t,n,r){function o(e){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function i(e,t){for(var n=0;n<t.length;n++){var r=t[n]
r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function a(e,t){return!t||"object"!==o(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called")
return e}(e):t}function s(e){return(s=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function c(e,t){return(c=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
var u=function(e){function o(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,o),a(this,s(o).apply(this,arguments))}var u,l,f
return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function")
e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&c(e,t)}(o,Ember.Component.extend({classNames:["mini-map-live__container"],raceState:null})),u=o,(l=[{key:"didInsertElement",value:function(){(0,t.assert2)(this.get("raceState")),this._doFrame()}},{key:"_doFrame",value:function(){var e=this
if(!this.isDestroying){var t=(new Date).getTime(),o=this.element.querySelector("canvas")
if(!o)throw new Error("canvas not found")
var i=this.element.clientWidth,a=this.element.clientHeight
o.width=i,o.height=a
var s=[],c=this.get("raceState")
if(c){for(var u=c.getMap(),l=0;l<=1;l+=.01)s.push(u.getElevationAtDistance(l*u.getLength()))
var f=[],p=[],d=0
c.getUserProvider().getUsers(t).forEach((function(e){var t=e.getUserType()
t&r.UserTypeFlags.Ai?f.push(e.getDistance()/u.getLength()):t&r.UserTypeFlags.Local?d=e.getDistance()/u.getLength():p.push(e.getDistance()/u.getLength())}))
var h=this.element.clientWidth,m=this.element.clientHeight
this.isDestroyed||requestAnimationFrame((function(){var e={ctx:o.getContext("2d"),elevations:s,w:h,h:m,minElevSpan:.01*u.getLength(),localPositionPct:d,humanPositions:p,aiPositions:f};(0,n.drawMinimap)(e)}))}this.isDestroyed||setTimeout((function(){return e._doFrame()}),250)}}}])&&i(u.prototype,l),f&&i(u,f),o}()
e.default=u})),define("bt-web2/components/mini-map-live/template",["exports"],(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
var t=Ember.HTMLBars.template({id:"cMzBu7mv",block:'{"symbols":[],"statements":[[7,"canvas",true],[10,"id","mini-map-live"],[8],[9]],"hasEval":false}',meta:{moduleName:"bt-web2/components/mini-map-live/template.hbs"}})
e.default=t})),define("bt-web2/components/mini-map/component",["exports","bt-web2/server-client-common/drawing"],(function(e,t){function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function r(e,t){for(var n=0;n<t.length;n++){var r=t[n]
r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function o(e,t){return!t||"object"!==n(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called")
return e}(e):t}function i(e){return(i=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function a(e,t){return(a=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
var s=function(e){function n(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,n),o(this,i(n).apply(this,arguments))}var s,c,u
return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function")
e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&a(e,t)}(n,Ember.Component.extend({classNames:["mini-map__container"],race:null,_onChangeRace:Ember.observer("race",(function(){this._redraw()}))})),s=n,(c=[{key:"_redraw",value:function(){var e=this.get("race")
if(!e)throw new Error("you gotta provide your minimap a race!")
var n=document.createElement("canvas"),r=this.element.clientWidth,o=this.element.clientHeight
n.width=r,n.height=o
for(var i=[],a=e.getLength(),s=0;s<=1;s+=.005)i.push(e.getElevationAtDistance(s*a))
var c=n.getContext("2d");(0,t.drawMinimap)({ctx:c,elevations:i,w:r,h:o,minElevSpan:.01*e.getLength()})
var u=n.toDataURL(),l=this.element.querySelector("img")
l&&(l.src=u)}},{key:"didInsertElement",value:function(){this._redraw()}}])&&r(s.prototype,c),u&&r(s,u),n}()
e.default=s})),define("bt-web2/components/mini-map/template",["exports"],(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
var t=Ember.HTMLBars.template({id:"y8Jm4kEB",block:'{"symbols":[],"statements":[[7,"img",true],[10,"id","mini-map"],[8],[9]],"hasEval":false}',meta:{moduleName:"bt-web2/components/mini-map/template.hbs"}})
e.default=t})),define("bt-web2/components/pacing-challenge-overlay/component",["exports","bt-web2/server-client-common/User"],(function(e,t){var n,r
function o(e){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function i(e,t){for(var n=0;n<t.length;n++){var r=t[n]
r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function a(e,t){return!t||"object"!==o(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called")
return e}(e):t}function s(e){return(s=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function c(e,t){return(c=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
var u,l,f,p,d,h,m=(n=Ember.computed("frame"),u=(r=function(e){function n(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,n),a(this,s(n).apply(this,arguments))}var r,o,u
return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function")
e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&c(e,t)}(n,Ember.Component.extend({classNames:["pacing-challenge-overlay__container"],devices:Ember.inject.service(),overlayData:null})),r=n,(o=[{key:"didInsertElement",value:function(){}},{key:"powerData",get:function(){var e=(new Date).getTime(),n=this.devices.getPowerCounterAverage(e,"pacing-challenge"),r=this.get("overlayData"),o=this.devices.getLocalUser()
if(!o)throw new Error("Uh-oh")
var i=(r.endOfRideElevation-o.getLastElevation())*t.DEFAULT_GRAVITY*t.DEFAULT_RIDER_MASS,a=Math.max(0,i/t.DEFAULT_HANDICAP_POWER),s=.5*t.DEFAULT_RIDER_MASS*Math.pow(o.getSpeed(),2)/t.DEFAULT_HANDICAP_POWER,c=n.joules/o.getHandicap(),u=r.handicapSecondsAllowed-c,l=Math.max(.001,(r.mapLen-o.getDistance())/1e3),f=u,p=Math.min(f,u-a+s)
return{powerRemaining:p.toFixed(0),powerRemainingPerKm:(p/l).toFixed(0),rawPowerRemaining:f.toFixed(0),rawPowerRemainingPerKm:(f/l).toFixed(0),powerUsed:c.toFixed(),powerUsedPerKm:(c/(o.getDistance()/1e3)).toFixed(1)}}}])&&i(r.prototype,o),u&&i(r,u),n}()).prototype,l="powerData",f=[n],p=Object.getOwnPropertyDescriptor(r.prototype,"powerData"),d=r.prototype,h={},Object.keys(p).forEach((function(e){h[e]=p[e]})),h.enumerable=!!h.enumerable,h.configurable=!!h.configurable,("value"in h||h.initializer)&&(h.writable=!0),h=f.slice().reverse().reduce((function(e,t){return t(u,l,e)||e}),h),d&&void 0!==h.initializer&&(h.value=h.initializer?h.initializer.call(d):void 0,h.initializer=void 0),void 0===h.initializer&&(Object.defineProperty(u,l,h),h=null),r)
e.default=m})),define("bt-web2/components/pacing-challenge-overlay/template",["exports"],(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
var t=Ember.HTMLBars.template({id:"wNSd9/Ho",block:'{"symbols":[],"statements":[[7,"div",true],[10,"class","pacing-challenge-overlay__row header"],[8],[0,"\\n  "],[7,"span",true],[10,"class","pacing-challenge-overlay__label header"],[8],[0,"Dashboard"],[9],[0," \\n  "],[7,"span",true],[10,"class","pacing-challenge-overlay__data header"],[8],[0,"Amount"],[9],[0,"\\n  "],[7,"span",true],[10,"class","pacing-challenge-overlay__data header"],[8],[0,"Per Km"],[9],[0,"\\n"],[9],[0,"\\n"],[7,"div",true],[10,"class","pacing-challenge-overlay__row"],[8],[0,"\\n  "],[7,"span",true],[10,"class","pacing-challenge-overlay__label"],[8],[0,"Energy Left:"],[9],[0," \\n"],[4,"if",[[24,["overlayData","usedAllPower"]]],null,{"statements":[[0,"    "],[7,"span",true],[10,"class","pacing-challenge-overlay__data"],[8],[0,"COASTING"],[9],[0,"\\n"]],"parameters":[]},{"statements":[[0,"    "],[7,"span",true],[10,"class","pacing-challenge-overlay__data"],[8],[1,[24,["powerData","powerRemaining"]],false],[9],[0,"\\n    "],[7,"span",true],[10,"class","pacing-challenge-overlay__data"],[8],[1,[24,["powerData","powerRemainingPerKm"]],false],[9],[0,"\\n"]],"parameters":[]}],[9],[0,"\\n"],[7,"div",true],[10,"class","pacing-challenge-overlay__row"],[8],[0,"\\n  "],[7,"span",true],[10,"class","pacing-challenge-overlay__label"],[8],[0,"Raw Left"],[9],[0," \\n"],[4,"if",[[24,["overlayData","usedAllPower"]]],null,{"statements":[[0,"    "],[7,"span",true],[10,"class","pacing-challenge-overlay__data"],[8],[0,"COASTING"],[9],[0,"\\n"]],"parameters":[]},{"statements":[[0,"    "],[7,"span",true],[10,"class","pacing-challenge-overlay__data"],[8],[1,[24,["powerData","rawPowerRemaining"]],false],[9],[0,"\\n    "],[7,"span",true],[10,"class","pacing-challenge-overlay__data"],[8],[1,[24,["powerData","rawPowerRemainingPerKm"]],false],[9],[0,"\\n"]],"parameters":[]}],[9],[0,"\\n"],[7,"div",true],[10,"class","pacing-challenge-overlay__row"],[8],[0,"\\n  "],[7,"span",true],[10,"class","pacing-challenge-overlay__label"],[8],[0,"Used:"],[9],[0," \\n  "],[7,"span",true],[10,"class","pacing-challenge-overlay__data"],[8],[1,[24,["powerData","powerUsed"]],false],[9],[0,"\\n  "],[7,"span",true],[10,"class","pacing-challenge-overlay__data"],[8],[1,[24,["powerData","powerUsedPerKm"]],false],[9],[0,"\\n"],[9]],"hasEval":false}',meta:{moduleName:"bt-web2/components/pacing-challenge-overlay/template.hbs"}})
e.default=t})),define("bt-web2/components/pending-race/component",["exports","bt-web2/server-client-common/Utils","bt-web2/server-client-common/communication"],(function(e,t,n){var r,o,i,a,s,c,u
function l(e){return(l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function f(e,t){for(var n=0;n<t.length;n++){var r=t[n]
r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function p(e,t){return!t||"object"!==l(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called")
return e}(e):t}function d(e){return(d=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function h(e,t){return(h=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function m(e,t,n,r,o){var i={}
return Object.keys(r).forEach((function(e){i[e]=r[e]})),i.enumerable=!!i.enumerable,i.configurable=!!i.configurable,("value"in i||i.initializer)&&(i.writable=!0),i=n.slice().reverse().reduce((function(n,r){return r(e,t,n)||n}),i),o&&void 0!==i.initializer&&(i.value=i.initializer?i.initializer.call(o):void 0,i.initializer=void 0),void 0===i.initializer&&(Object.defineProperty(e,t,i),i=null),i}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
var y=(r=Ember.computed("race"),o=Ember.computed("race"),i=Ember.computed("race"),a=Ember.computed("race","frame"),s=Ember.computed("race"),c=Ember.computed("race","frame"),m((u=function(e){function r(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r),p(this,d(r).apply(this,arguments))}var o,i,a
return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function")
e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&h(e,t)}(r,Ember.Component.extend({classNames:["pending-race__content"],classNameBindings:["hasHumans"],race:null})),o=r,(i=[{key:"didInsertElement",value:function(){(0,t.assert2)(this.joinRace)}},{key:"hasHumans",get:function(){var e=this.get("race")
return!!e&&e.whoIn.length>0}},{key:"raceTime",get:function(){var e=this.get("race")
return e?new Date(e.tmScheduledStart).toLocaleString():"Unknown"}},{key:"hasWhen",get:function(){var e=this.get("race")
return!!e&&!!(e.tmActualStart>0||e.tmScheduledStart>0)}},{key:"lengthString",get:function(){var e=this.get("race")
return e?"".concat((e.lengthMeters/1e3).toFixed(1),"km"):"Unknown"}},{key:"raceElevations",get:function(){var e=this.get("race")
return e?new n.SimpleElevationMap(e.elevations,e.lengthMeters):null}},{key:"statusString",get:function(){var e=this.get("race")
if(!e)return"Unknown"
switch(this.get("frame"),e.status){case n.CurrentRaceState.PostRace:return"Finished!"
case n.CurrentRaceState.PreRace:if(e.tmScheduledStart<=0)return"Will start when players join"
var r=e.tmScheduledStart-(new Date).getTime()
return r>0?"Starting in ".concat((0,t.formatSecondsHms)(r/1e3)):"Started ".concat((0,t.formatSecondsHms)(-r/1e3)," ago")
case n.CurrentRaceState.Racing:var o=e.tmActualStart-(new Date).getTime()
return o>0?"Starting in ".concat((0,t.formatSecondsHms)(o/1e3)):"Started ".concat((0,t.formatSecondsHms)(-o/1e3)," ago")}}}])&&f(o.prototype,i),a&&f(o,a),r}()).prototype,"hasHumans",[r],Object.getOwnPropertyDescriptor(u.prototype,"hasHumans"),u.prototype),m(u.prototype,"raceTime",[o],Object.getOwnPropertyDescriptor(u.prototype,"raceTime"),u.prototype),m(u.prototype,"hasWhen",[i],Object.getOwnPropertyDescriptor(u.prototype,"hasWhen"),u.prototype),m(u.prototype,"lengthString",[a],Object.getOwnPropertyDescriptor(u.prototype,"lengthString"),u.prototype),m(u.prototype,"raceElevations",[s],Object.getOwnPropertyDescriptor(u.prototype,"raceElevations"),u.prototype),m(u.prototype,"statusString",[c],Object.getOwnPropertyDescriptor(u.prototype,"statusString"),u.prototype),u)
e.default=y})),define("bt-web2/components/pending-race/template",["exports"],(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
var t=Ember.HTMLBars.template({id:"WImZ2gHm",block:'{"symbols":[],"statements":[[7,"div",true],[10,"class","pending-race__row"],[8],[0,"\\n  "],[7,"span",true],[10,"class","pending-race__key"],[8],[0,"\\n    What:\\n  "],[9],[0,"\\n  "],[7,"span",true],[10,"class","pending-race__value"],[8],[0,"\\n    "],[1,[24,["race","displayName"]],false],[0,"\\n  "],[9],[0,"\\n"],[9],[0,"\\n\\n"],[4,"if",[[24,["hasWhen"]]],null,{"statements":[[0,"  "],[7,"div",true],[10,"class","pending-race__row"],[8],[0,"\\n    "],[7,"span",true],[10,"class","pending-race__key"],[8],[0,"\\n      When:\\n    "],[9],[0,"\\n    "],[7,"span",true],[10,"class","pending-race__value"],[8],[0,"\\n      "],[1,[22,"raceTime"],false],[0,"\\n    "],[9],[0,"\\n  "],[9],[0,"\\n"]],"parameters":[]},null],[7,"div",true],[10,"class","pending-race__row"],[8],[0,"\\n  "],[7,"span",true],[10,"class","pending-race__key"],[8],[0,"\\n    Current Riders:\\n  "],[9],[0,"\\n  "],[7,"span",true],[10,"class","pending-race__value"],[8],[0,"\\n    "],[1,[24,["race","whoIn","length"]],false],[0," humans, "],[1,[24,["race","whoInAi","length"]],false],[0," AI\\n  "],[9],[0,"\\n"],[9],[0,"\\n"],[7,"div",true],[10,"class","pending-race__row"],[8],[0,"\\n  "],[7,"span",true],[10,"class","pending-race__key"],[8],[0,"\\n    Status:\\n  "],[9],[0,"\\n  "],[7,"span",true],[10,"class","pending-race__value"],[8],[0,"\\n    "],[1,[22,"statusString"],false],[0,"\\n  "],[9],[0,"\\n"],[9],[0,"\\n"],[7,"div",true],[10,"class","pending-race__row"],[8],[0,"\\n  "],[7,"span",true],[10,"class","pending-race__key"],[8],[0,"\\n    Length:\\n  "],[9],[0,"\\n  "],[7,"span",true],[10,"class","pending-race__value"],[8],[0,"\\n    "],[1,[22,"lengthString"],false],[0,"\\n  "],[9],[0,"\\n"],[9],[0,"\\n"],[7,"div",true],[10,"class","pending-race__row"],[8],[0,"\\n  "],[1,[28,"mini-map",null,[["race"],[[24,["raceElevations"]]]]],false],[0,"\\n"],[9],[0,"\\n"],[7,"a",false],[12,"class","pending-race__join-button"],[12,"href",[29,[[24,["race","url"]]]]],[3,"action",[[23,0,[]],[24,["joinRace"]],[24,["race","gameId"]]]],[8],[0,"Join"],[9]],"hasEval":false}',meta:{moduleName:"bt-web2/components/pending-race/template.hbs"}})
e.default=t})),define("bt-web2/components/stored-data/component",["exports","bt-web2/server-client-common/Utils","bt-web2/services/devices","bt-web2/set-up-ride/route","ember-md5","bt-web2/components/user-set-up-widget/component"],(function(e,t,n,r,o,i){function a(e){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function s(e,t){for(var n=0;n<t.length;n++){var r=t[n]
r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function c(e,t){return!t||"object"!==a(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called")
return e}(e):t}function u(e){return(u=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function l(e,t){return(l=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
var f=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),c(this,u(t).apply(this,arguments))}var n,r,o
return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function")
e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&l(e,t)}(t,e),n=t,(r=[{key:"didInsertElement",value:function(){this.observeImage(),this.observeMd5()}}])&&s(n.prototype,r),o&&s(n,o),t}(Ember.Component.extend({devices:Ember.inject.service(),classNames:["stored-data__content"],hasData:!1,triedToGetData:!1,userHasImageSet:!1,imageUpdateCount:0,override:"",yourImage:"",riders:[],yourmd5:Ember.computed("yourImage","override",(function(){if(console.log("your md5"),this.get("override"))return this.get("override")
var e=this.devices.getLocalUser()
if(e&&e.getBigImageMd5())return e.getBigImageMd5()
var t=this.get("yourImage")
return(0,o.default)(t)})),observeImage:Ember.observer("devices.ridersVersion",(function(){if(this.devices.getLocalUser()){var e=window.localStorage.getItem(i.USERSETUP_KEY_IMAGE)
this.set("userHasImageSet",!!e),e&&this.set("yourImage",e)}})),observeMd5:Ember.observer("yourmd5",(function(){var e=this,t={imageMd5:this.get("yourmd5")}
this.incrementProperty("imageUpdateCount")
var n=this.get("imageUpdateCount");(0,r.apiGet)("user-ride-results",t).then((function(t){if(!e.isDestroyed&&(e.set("triedToGetData",!0),n===e.get("imageUpdateCount"))){var r=[]
for(var o in t)r.push({name:o,rides:t[o]})
e.set("hasData",r.length>0),e.set("riders",r)}})).finally((function(){e.isDestroyed||e.set("triedToGetData",!0)}))})),actions:{downloadRide:function(e){(0,t.assert2)(0===e.samples.length,"we're expecting the parameter here to be a basic ride.  we need to ask the server for the whole thing")
var o=this.get("yourmd5"),i=this.get("override")||o,a={tmStart:e.tmStart,riderName:e.riderName,imageMd5:i}
return(0,r.apiGet)("user-ride-result",a).then((function(r){(0,t.assert2)(r.samples.length>0,"the one we fetch specifically should have full samples"),(0,t.assert2)(r.tmStart===e.tmStart&&r.rideName===e.rideName),(0,n.dumpRaceResultToPWX)(r)}))},downloadImg:function(){var e=this.devices.getLocalUser()
if(e){var t=this.get("yourImage"),n=new Blob([t],{type:"application/octet-stream"}),r=(window.URL.createObjectURL(n),document.createElement("a"))
r.href=t,r.download="".concat(e.getName(),"-security-image.png"),r.target="_blank",document.body.appendChild(r),r.click(),document.body.removeChild(r)}}}}))
e.default=f})),define("bt-web2/components/stored-data/template",["exports"],(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
var t=Ember.HTMLBars.template({id:"vULZVLIa",block:'{"symbols":["rider","ride"],"statements":[[7,"h3",true],[10,"class","stored-data__title"],[8],[0,"Stored Data"],[9],[0,"\\n"],[7,"p",true],[10,"class","stored-data__subtitle"],[8],[1,[22,"yourmd5"],false],[9],[0,"\\n"],[4,"if",[[24,["hasData"]]],null,{"statements":[[4,"each",[[24,["riders"]]],null,{"statements":[[0,"    "],[7,"hr",true],[8],[9],[0,"\\n    "],[7,"h5",true],[10,"class","stored-data__title"],[8],[1,[23,1,["name"]],false],[9],[0,"\\n    "],[7,"ul",true],[8],[0,"\\n    "],[1,[28,"log",["rider ",[23,1,[]]],null],false],[0,"\\n"],[4,"each",[[23,1,["rides","results"]]],null,{"statements":[[0,"      "],[7,"li",true],[8],[0,"\\n        "],[7,"a",false],[12,"class","stored-data__link"],[12,"href","#"],[3,"action",[[23,0,[]],"downloadRide",[23,2,[]]]],[8],[1,[23,2,["rideName"]],false],[9],[0,"\\n      "],[9],[0,"\\n"]],"parameters":[2]},null],[0,"    "],[9],[0,"\\n"]],"parameters":[1]},null]],"parameters":[]},{"statements":[[4,"if",[[24,["triedToGetData"]]],null,{"statements":[[0,"    "],[7,"p",true],[10,"class","stored-data__p"],[8],[0,"Tour.js could not locate data for your current image"],[9],[0,"\\n"]],"parameters":[]},{"statements":[[4,"if",[[24,["userHasImageSet"]]],null,{"statements":[[0,"      "],[7,"p",true],[10,"class","stored-data__p"],[8],[0,"Loading..."],[9],[0,"\\n"]],"parameters":[]},{"statements":[[0,"      "],[7,"p",true],[10,"class","stored-data__p"],[8],[0,"You don\'t have a rider image set."],[9],[0,"\\n"]],"parameters":[]}],[0,"    \\n"]],"parameters":[]}]],"parameters":[]}],[7,"p",true],[10,"class","stored-data__p"],[8],[0,"Tour.js kinda-sorta secures your data by requiring you to have an image set.  The exact pixels of your image allow you to access your specific data uniquely."],[9],[0,"\\n"],[7,"p",true],[10,"class","stored-data__p"],[8],[0,"Tip: Tour.js is a for-fun project with zero effort applied to security.  If you\'re sensitive about your data, I recommend not setting an image, which will result in data not getting saved."],[9],[0,"\\n"],[4,"if",[[24,["yourImage"]]],null,{"statements":[[0,"  "],[7,"p",true],[10,"class","stored-data__p"],[8],[0,"Click "],[7,"a",false],[12,"href","#"],[3,"action",[[23,0,[]],"downloadImg"]],[8],[0,"here"],[9],[0," to download your image if you want to set up other devices to save/load as that user.  Just use that image as your user image on the other device."],[9],[0,"\\n"]],"parameters":[]},null],[4,"if",[[24,["yourmd5"]]],null,{"statements":[[0,"  "],[7,"p",true],[10,"class","stored-data__p"],[8],[0,"You can always view your results with "],[7,"a",true],[11,"href",[29,["https://tourjs.ca/results?md5=",[22,"yourmd5"]]]],[8],[0,"this link"],[9],[0,".  You can share that link to other devices as well."],[9],[0,"\\n"]],"parameters":[]},null]],"hasEval":false}',meta:{moduleName:"bt-web2/components/stored-data/template.hbs"}})
e.default=t})),define("bt-web2/components/tourjs-header/component",["exports","bt-web2/pojs/DeviceFactory","bt-web2/services/devices"],(function(e,t,n){function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function o(e,t){for(var n=0;n<t.length;n++){var r=t[n]
r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function i(e,t){return!t||"object"!==r(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called")
return e}(e):t}function a(e){return(a=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function s(e,t){return(s=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
var c=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),i(this,a(t).apply(this,arguments))}var n,r,c
return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function")
e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&s(e,t)}(t,e),n=t,(r=[{key:"didInsertElement",value:function(){var e=this
this.set("frameInterval",setInterval((function(){e.incrementProperty("frame")}),1e3))}},{key:"willDestroyElement",value:function(){clearInterval(this.get("frameInterval"))}}])&&o(n.prototype,r),c&&o(n,c),t}(Ember.Component.extend({classNames:["tourjs-header__container"],devices:Ember.inject.service("devices"),connection:Ember.inject.service("connection"),frame:0,frameInterval:null,you:Ember.computed("devices.ridersVersion",(function(){return this.devices.getLocalUser()})),yourName:Ember.computed("you",(function(){var e=this.get("you")
return e?e.getName():"Unset"})),yourFtp:Ember.computed("you",(function(){var e=this.get("you")
return e?e.getHandicap().toFixed(1)+"W":"Unset"})),hasPower:Ember.computed("devices.ridersVersion",(function(){return!!this.devices.getPowerDevice()})),hasHrm:Ember.computed("devices.ridersVersion",(function(){return!!this.devices.getHrmDevice()})),lastPower:Ember.computed("frame","you",(function(){var e=this.get("you")
return e&&e.getLastPower().toFixed(0)+"W"||"---W"})),lastHrm:Ember.computed("frame","you",(function(){var e=this.get("you")
return e&&e.getLastHrm((new Date).getTime()).toFixed(0)+"bpm"||"---bpm"})),actions:{connectHrm:function(){var e=this;(0,t.getDeviceFactory)().findHrm().then((function(t){e.devices.setLocalUserDevice(t,n.DeviceFlags.Hrm)}))},connectPower:function(){var e=this;(0,t.getDeviceFactory)().findPowermeter(!1).then((function(t){e.devices.setLocalUserDevice(t,n.DeviceFlags.AllButHrm)}))}}}))
e.default=c})),define("bt-web2/components/tourjs-header/template",["exports"],(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
var t=Ember.HTMLBars.template({id:"YxkSiSFi",block:'{"symbols":[],"statements":[[4,"link-to",null,[["class","route"],["tourjs-header__title","index"]],{"statements":[[0,"Tour.js"]],"parameters":[]},null],[0,"\\n"],[7,"div",true],[10,"class","tourjs-header__subhead"],[8],[0,"\\n\\n\\n  "],[7,"div",true],[10,"class","tourjs-header__subhead--item"],[8],[0,"\\n    "],[7,"div",true],[10,"class","tourjs-header__subhead--item-label"],[8],[4,"link-to",null,[["route"],["set-up-user"]],{"statements":[[0,"Name"]],"parameters":[]},null],[0,":"],[9],[0,"\\n    "],[7,"div",true],[10,"class","tourjs-header__subhead--item-value"],[8],[1,[22,"yourName"],false],[9],[0,"\\n  "],[9],[0,"\\n\\n\\n  "],[7,"div",true],[10,"class","tourjs-header__subhead--item"],[8],[0,"\\n    "],[7,"div",true],[10,"class","tourjs-header__subhead--item-label"],[8],[4,"link-to",null,[["route"],["set-up-user"]],{"statements":[[0,"FTP"]],"parameters":[]},null],[0,":"],[9],[0,"\\n    "],[7,"div",true],[10,"class","tourjs-header__subhead--item-value"],[8],[1,[22,"yourFtp"],false],[9],[0,"\\n  "],[9],[0,"\\n\\n\\n"],[4,"if",[[24,["hasHrm"]]],null,{"statements":[[0,"    "],[7,"div",true],[10,"class","tourjs-header__subhead--item"],[8],[0,"\\n      "],[7,"div",true],[10,"class","tourjs-header__subhead--item-label"],[8],[7,"a",false],[12,"href","#"],[3,"action",[[23,0,[]],"connectHrm"]],[8],[0,"BPM:"],[9],[9],[0,"\\n      "],[7,"div",true],[10,"class","tourjs-header__subhead--item-value"],[8],[1,[22,"lastHrm"],false],[9],[0,"\\n    "],[9],[0,"\\n"]],"parameters":[]},{"statements":[[0,"    "],[7,"div",true],[10,"class","tourjs-header__subhead--item"],[8],[0,"\\n      "],[7,"button",false],[3,"action",[[23,0,[]],"connectHrm"]],[8],[0,"Connect"],[7,"br",true],[8],[9],[0,"HRM"],[9],[0,"\\n    "],[9],[0,"\\n"]],"parameters":[]}],[4,"if",[[24,["devices","kickrConnected"]]],null,{"statements":[[0,"    "],[7,"div",true],[10,"class","tourjs-header__subhead--item"],[8],[0,"\\n      "],[4,"link-to",null,[["route"],["kickr-setup"]],{"statements":[[0,"Kickr Setup"]],"parameters":[]},null],[0,"\\n    "],[9],[0,"\\n"]],"parameters":[]},null],[0,"\\n\\n"],[4,"if",[[24,["hasPower"]]],null,{"statements":[[0,"    "],[7,"div",true],[10,"class","tourjs-header__subhead--item"],[8],[0,"\\n      "],[7,"div",true],[10,"class","tourjs-header__subhead--item-label"],[8],[7,"a",false],[12,"href","#"],[3,"action",[[23,0,[]],"connectPower"]],[8],[0,"Power"],[9],[9],[0,"\\n      "],[7,"div",true],[10,"class","tourjs-header__subhead--item-value"],[8],[1,[22,"lastPower"],false],[9],[0,"\\n    "],[9],[0,"\\n"]],"parameters":[]},{"statements":[[0,"    "],[7,"div",true],[10,"class","tourjs-header__subhead--item"],[8],[0,"\\n      "],[7,"button",false],[3,"action",[[23,0,[]],"connectPower"]],[8],[0,"Connect"],[7,"br",true],[8],[9],[0,"Power"],[9],[0,"\\n    "],[9],[0,"\\n"]],"parameters":[]}],[9]],"hasEval":false}',meta:{moduleName:"bt-web2/components/tourjs-header/template.hbs"}})
e.default=t})),define("bt-web2/components/user-dashboard/component",["exports","bt-web2/server-client-common/Utils"],(function(e,t){var n,r
function o(e){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function i(e,t){for(var n=0;n<t.length;n++){var r=t[n]
r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function a(e,t){return!t||"object"!==o(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called")
return e}(e):t}function s(e){return(s=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function c(e,t){return(c=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
var u,l,f,p,d,h,m=(n=Ember.computed("frame","user"),u=(r=function(e){function n(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,n),a(this,s(n).apply(this,arguments))}var r,o,u
return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function")
e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&c(e,t)}(n,Ember.Component.extend({user:null,frame:null,raceState:null,classNames:["user-dashboard__container"]})),r=n,(o=[{key:"didInsertElement",value:function(){(0,t.assert2)(this.get("raceState")),(0,t.assert2)(void 0!==this.get("frame"))
var e=this.get("raceState")
if(!e)throw new Error("Can't have a dashboard when there's no race!")
var n=e.getLocalUser()
if(!n)throw new Error("Can't have a dashboard for a user that doesn't exist!")
this.set("user",n)}},{key:"userDisplay",get:function(){var e=this.get("raceState")
if(e){var t=e.getLocalUser()
if(t)return t.getDisplay(e)}return null}}])&&i(r.prototype,o),u&&i(r,u),n}()).prototype,l="userDisplay",f=[n],p=Object.getOwnPropertyDescriptor(r.prototype,"userDisplay"),d=r.prototype,h={},Object.keys(p).forEach((function(e){h[e]=p[e]})),h.enumerable=!!h.enumerable,h.configurable=!!h.configurable,("value"in h||h.initializer)&&(h.writable=!0),h=f.slice().reverse().reduce((function(e,t){return t(u,l,e)||e}),h),d&&void 0!==h.initializer&&(h.value=h.initializer?h.initializer.call(d):void 0,h.initializer=void 0),void 0===h.initializer&&(Object.defineProperty(u,l,h),h=null),r)
e.default=m})),define("bt-web2/components/user-dashboard/template",["exports"],(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
var t=Ember.HTMLBars.template({id:"BSIkza/m",block:'{"symbols":[],"statements":[[4,"if",[[24,["userDisplay"]]],null,{"statements":[[0,"  "],[7,"div",true],[10,"class","user-dashboard__table"],[8],[0,"\\n    "],[7,"div",true],[10,"class","user-dashboard__tr"],[8],[0,"\\n      "],[7,"div",true],[10,"class","user-dashboard__group"],[8],[0,"\\n        "],[7,"span",true],[10,"class","user-dashboard__label"],[8],[7,"i",true],[10,"class","fas fa-bolt"],[8],[9],[9],[0,"\\n        "],[7,"span",true],[10,"class","user-dashboard__value"],[8],[1,[24,["userDisplay","lastPower"]],false],[9],[0,"\\n      "],[9],[0,"\\n      "],[7,"div",true],[10,"class","user-dashboard__group"],[8],[0,"\\n        "],[7,"span",true],[10,"class","user-dashboard__label"],[8],[7,"i",true],[10,"class","fas fa-tachometer-alt"],[8],[9],[9],[0,"\\n        "],[7,"span",true],[10,"class","user-dashboard__value"],[8],[1,[24,["userDisplay","speed"]],false],[9],[0,"\\n      "],[9],[0,"\\n      "],[7,"div",true],[10,"class","user-dashboard__group"],[8],[0,"\\n        "],[7,"span",true],[10,"class","user-dashboard__label"],[8],[7,"i",true],[10,"class","fas fa-mountain"],[8],[9],[9],[0,"\\n        "],[7,"span",true],[10,"class","user-dashboard__value"],[8],[1,[24,["userDisplay","slope"]],false],[9],[0,"\\n      "],[9],[0,"\\n"],[4,"if",[[24,["userDisplay","hrm"]]],null,{"statements":[[0,"        "],[7,"div",true],[10,"class","user-dashboard__group"],[8],[0,"\\n          "],[7,"span",true],[10,"class","user-dashboard__label"],[8],[7,"i",true],[10,"class","fa fa-heart"],[10,"aria-hidden","true"],[8],[9],[9],[0,"\\n          "],[7,"span",true],[10,"class","user-dashboard__value"],[8],[1,[24,["userDisplay","hrm"]],false],[9],[0,"\\n        "],[9],[0,"\\n"]],"parameters":[]},null],[0,"    "],[9],[0,"\\n  "],[9],[0,"\\n"]],"parameters":[]},null]],"hasEval":false}',meta:{moduleName:"bt-web2/components/user-dashboard/template.hbs"}})
e.default=t})),define("bt-web2/components/user-set-up-widget/component",["exports","ember-md5"],(function(e,t){var n,r
function o(e){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function i(e,t){for(var n=0;n<t.length;n++){var r=t[n]
r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function a(e,t){return!t||"object"!==o(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called")
return e}(e):t}function s(e){return(s=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function c(e,t){return(c=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}Object.defineProperty(e,"__esModule",{value:!0}),e.resizeImage=f,e.storeFromVirginImage=p,e.default=e.USERSETUP_PAST_USERS=e.USERSETUP_KEY_HANDICAP=e.USERSETUP_KEY_NAME=e.USERSETUP_KEY_IMAGE=void 0
var u="user-set-up:lastImage"
e.USERSETUP_KEY_IMAGE=u
e.USERSETUP_KEY_NAME="user-set-up:lastName"
e.USERSETUP_KEY_HANDICAP="user-set-up:lastHandicap"
function l(e){for(var t,n=this,r=e.target.files,o=0;t=r[o];o++)if(t.type.match("image.*")){var i=new FileReader
i.onload=function(e){var t=e.target.result,r=Promise.resolve(t)
return t.length>4194304&&(console.log("image from camera is too large "+(t.length/1024).toFixed(0)+"kb, need to downsize"),r=f(t,1024,1024)),r.then((function(e){n.setImage(e,!1)}))},i.readAsDataURL(t)}}function f(e,t,n){return new Promise((function(r){var o=new Image
o.onload=function(){var e=o.width/o.height,i=64,a=i*e
e>1?(a=t,i=t/e):(i=n,a=n*e)
var s=document.createElement("canvas")
s.width=a,s.height=i,s.style.width=a+"px",s.style.height=i+"px",s.style.position="fixed",s.style.left="-10000px",s.style.top="0px",s.style.zIndex="10000",s.style.border="1px solid black",document.body.appendChild(s)
var c=s.getContext("2d")
if(c){c.drawImage(o,0,0,a,i)
var u=s.toDataURL("image/jpeg",.75)
document.body.removeChild(s),r(u)}},o.src=e}))}function p(e,n,r){n||(console.log("setting ",e.substr(0,100)," with length ",e.length,"and md5 ",(0,t.default)(e)," to localstorage"),localStorage.setItem(u,e))
var o=document.createElement("img")
return new Promise((function(t,n){o.onload=function(){return o.width<=256&&o.height<=256?(r&&(r.src=e),t(e)):f(e,256,256).then((function(e){return p(e,!0,r)})).then(t,n)},o.src=e}))}e.USERSETUP_PAST_USERS="user-set-up:past-users"
var d,h,m,y,v,b,g=(n=Ember.computed("userName","userHandicap"),r=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),a(this,s(t).apply(this,arguments))}var n,r,o
return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function")
e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&c(e,t)}(t,e),n=t,(r=[{key:"didInsertElement",value:function(){window.assert2(this.onDone)
var e=window.localStorage.getItem(u)
e&&this.setImage(e)
var t=window.localStorage.getItem("user-set-up:lastName")
t&&this.set("userName",t)
var n=""+window.localStorage.getItem("user-set-up:lastHandicap")
n&&isFinite(parseFloat(n))&&this.set("userHandicap",n)
var r=this.element.querySelector('input[type="file"]')
r&&r.addEventListener("change",l.bind(this),!1)}},{key:"setImage",value:function(e){p(e,!1,this.element.querySelector(".user-set-up__image"))}},{key:"disableDone",get:function(){return!this.get("userName")||!this.get("userHandicap")}}])&&i(n.prototype,r),o&&i(n,o),t}(Ember.Component.extend({devices:Ember.inject.service("devices"),userName:"Art",userHandicap:"300",canDoBluetooth:!0,onDone:function(e){},actions:{useOldUser:function(e){console.log("useOldUser ",e),this.set("userName",e.name),this.set("userHandicap",e.handicap)
var t=this.element.querySelector(".user-set-up__image")
t&&(t.src=e.imageBase64,window.localStorage.setItem(u,e.imageBase64))},done:function(){var e=this.element.querySelector(".user-set-up__image"),n=localStorage.getItem(u),r=null
e&&(r=e.src),localStorage.setItem("user-set-up:lastHandicap",""+this.userHandicap),localStorage.setItem("user-set-up:lastName",""+this.userName)
var o={name:this.userName,handicap:parseFloat(this.userHandicap),imageBase64:r,bigImageMd5:(0,t.default)(n)},i=this.get("pastUsers")
i[o.name]=o,window.localStorage.setItem("user-set-up:past-users",JSON.stringify(i)),this.onDone(o)}},pastUsers:Ember.computed((function(){try{var e=window.localStorage.getItem("user-set-up:past-users")
return e?JSON.parse(e):{}}catch(t){return{}}}))})),d=r.prototype,h="disableDone",m=[n],y=Object.getOwnPropertyDescriptor(r.prototype,"disableDone"),v=r.prototype,b={},Object.keys(y).forEach((function(e){b[e]=y[e]})),b.enumerable=!!b.enumerable,b.configurable=!!b.configurable,("value"in b||b.initializer)&&(b.writable=!0),b=m.slice().reverse().reduce((function(e,t){return t(d,h,e)||e}),b),v&&void 0!==b.initializer&&(b.value=b.initializer?b.initializer.call(v):void 0,b.initializer=void 0),void 0===b.initializer&&(Object.defineProperty(d,h,b),b=null),r)
e.default=g})),define("bt-web2/components/user-set-up-widget/template",["exports"],(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
var t=Ember.HTMLBars.template({id:"Ww8tHTwm",block:'{"symbols":["user","name"],"statements":[[7,"div",true],[10,"class","user-set-up__content"],[8],[0,"\\n  "],[7,"div",true],[10,"class","user-set-up__title"],[8],[0,"\\n    Set Up Your User\\n  "],[9],[0,"\\n"],[4,"if",[[24,["pastUsers"]]],null,{"statements":[[0,"    "],[7,"h3",true],[8],[0,"This PC has had other users in the past"],[9],[0,"\\n"],[4,"each",[[28,"-each-in",[[24,["pastUsers"]]],null]],null,{"statements":[[0,"      "],[7,"button",false],[3,"action",[[23,0,[]],"useOldUser",[23,1,[]]]],[8],[1,[23,2,[]],false],[9],[0,"\\n"]],"parameters":[1,2]},null]],"parameters":[]},null],[0,"  "],[7,"div",true],[10,"class","user-set-up__element"],[8],[0,"\\n    "],[7,"div",true],[10,"class","user-set-up__label"],[8],[0,"Your Name"],[9],[0,"\\n    "],[1,[28,"input",null,[["value","placeholder","class"],[[24,["userName"]],"Your Name","user-set-up__input"]]],false],[0,"\\n  "],[9],[0,"\\n  "],[7,"div",true],[10,"class","user-set-up__element"],[8],[0,"\\n    "],[7,"label",true],[10,"for","user-picture"],[10,"class","user-set-up__label"],[8],[0,"Your Picture (click to add)\\n      "],[7,"div",true],[10,"class","user-set-up__imagefile"],[8],[0,"\\n        "],[7,"img",true],[10,"class","user-set-up__image"],[8],[9],[0,"\\n        "],[7,"input",true],[10,"id","user-picture"],[10,"accept","image/*"],[10,"class","user-set-up__file"],[10,"style","display:none;"],[10,"type","file"],[8],[9],[0,"\\n      "],[9],[0,"\\n    "],[9],[0,"\\n  "],[9],[0,"\\n  "],[7,"div",true],[10,"class","user-set-up__element"],[8],[0,"\\n    "],[7,"div",true],[10,"class","user-set-up__label"],[8],[0,"Your Handicap / FTP"],[9],[0,"\\n    "],[1,[28,"input",null,[["value","placeholder","class"],[[24,["userHandicap"]],"Your Handicap or FTP","user-set-up__input"]]],false],[0,"\\n  "],[9],[0,"\\n  "],[7,"div",true],[10,"class","user-set-up__element"],[8],[0,"\\n    "],[7,"button",false],[12,"class","user-set-up__button"],[12,"disabled",[22,"disableDone"]],[3,"action",[[23,0,[]],"done"]],[8],[0,"Done"],[9],[0,"\\n  "],[9],[0,"\\n"],[9]],"hasEval":false}',meta:{moduleName:"bt-web2/components/user-set-up-widget/template.hbs"}})
e.default=t})),define("bt-web2/components/vertical-align/component",["exports"],(function(e){function t(e){return(t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function n(e,n){return!n||"object"!==t(n)&&"function"!=typeof n?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called")
return e}(e):n}function r(e){return(r=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function o(e,t){return(o=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
var i=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),n(this,r(t).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function")
e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&o(e,t)}(t,Ember.Component.extend({classNames:["vertical-align__container"]})),t}()
e.default=i})),define("bt-web2/components/vertical-align/template",["exports"],(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
var t=Ember.HTMLBars.template({id:"aOFpNMud",block:'{"symbols":["&default"],"statements":[[7,"div",true],[10,"class","vgap"],[8],[9],[0,"\\n"],[7,"div",true],[10,"class","vgap-content"],[8],[0,"\\n  "],[14,1],[0,"\\n"],[9],[0,"\\n"],[7,"div",true],[10,"class","vgap"],[8],[9]],"hasEval":false}',meta:{moduleName:"bt-web2/components/vertical-align/template.hbs"}})
e.default=t})),define("bt-web2/config/environment.d",["exports"],(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
var t=config
e.default=t})),define("bt-web2/formats",["exports"],(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
e.default={time:{hhmmss:{hour:"numeric",minute:"numeric",second:"numeric"}},date:{hhmmss:{hour:"numeric",minute:"numeric",second:"numeric"}},number:{EUR:{style:"currency",currency:"EUR",minimumFractionDigits:2,maximumFractionDigits:2},USD:{style:"currency",currency:"USD",minimumFractionDigits:2,maximumFractionDigits:2}}}})),define("bt-web2/helpers/add",["exports"],(function(e){function t(e){return e[0]+e[1]}Object.defineProperty(e,"__esModule",{value:!0}),e.add=t,e.default=void 0
var n=Ember.Helper.helper(t)
e.default=n})),define("bt-web2/helpers/and",["exports","ember-truth-helpers/helpers/and"],(function(e,t){Object.defineProperty(e,"__esModule",{value:!0}),Object.defineProperty(e,"default",{enumerable:!0,get:function(){return t.default}}),Object.defineProperty(e,"and",{enumerable:!0,get:function(){return t.and}})})),define("bt-web2/helpers/app-version",["exports","bt-web2/config/environment","ember-cli-app-version/utils/regexp"],(function(e,t,n){function r(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=t.default.APP.version,i=r.versionOnly||r.hideSha,a=r.shaOnly||r.hideVersion,s=null
return i&&(r.showExtended&&(s=o.match(n.versionExtendedRegExp)),s||(s=o.match(n.versionRegExp))),a&&(s=o.match(n.shaRegExp)),s?s[0]:o}Object.defineProperty(e,"__esModule",{value:!0}),e.appVersion=r,e.default=void 0
var o=Ember.Helper.helper(r)
e.default=o})),define("bt-web2/helpers/divide",["exports"],(function(e){function t(e){if(e.length<2)return""
var t=parseFloat(""+e[0]),n=parseFloat(""+e[1])
console.log("dividing ",e[0]," by ",e[1])
var r=t/n
return e[2]?r.toFixed(e[2]):t/n}Object.defineProperty(e,"__esModule",{value:!0}),e.divide=t,e.default=void 0
var n=Ember.Helper.helper(t)
e.default=n})),define("bt-web2/helpers/eq",["exports","ember-truth-helpers/helpers/equal"],(function(e,t){Object.defineProperty(e,"__esModule",{value:!0}),Object.defineProperty(e,"default",{enumerable:!0,get:function(){return t.default}}),Object.defineProperty(e,"equal",{enumerable:!0,get:function(){return t.equal}})})),define("bt-web2/helpers/format-date",["exports","ember-intl/helpers/format-date"],(function(e,t){Object.defineProperty(e,"__esModule",{value:!0}),Object.defineProperty(e,"default",{enumerable:!0,get:function(){return t.default}})})),define("bt-web2/helpers/format-message",["exports","ember-intl/helpers/format-message"],(function(e,t){Object.defineProperty(e,"__esModule",{value:!0}),Object.defineProperty(e,"default",{enumerable:!0,get:function(){return t.default}})}))
define("bt-web2/helpers/format-number",["exports","ember-intl/helpers/format-number"],(function(e,t){Object.defineProperty(e,"__esModule",{value:!0}),Object.defineProperty(e,"default",{enumerable:!0,get:function(){return t.default}})})),define("bt-web2/helpers/format-relative",["exports","ember-intl/helpers/format-relative"],(function(e,t){Object.defineProperty(e,"__esModule",{value:!0}),Object.defineProperty(e,"default",{enumerable:!0,get:function(){return t.default}})})),define("bt-web2/helpers/format-time",["exports","ember-intl/helpers/format-time"],(function(e,t){Object.defineProperty(e,"__esModule",{value:!0}),Object.defineProperty(e,"default",{enumerable:!0,get:function(){return t.default}})})),define("bt-web2/helpers/gt",["exports","ember-truth-helpers/helpers/gt"],(function(e,t){Object.defineProperty(e,"__esModule",{value:!0}),Object.defineProperty(e,"default",{enumerable:!0,get:function(){return t.default}}),Object.defineProperty(e,"gt",{enumerable:!0,get:function(){return t.gt}})})),define("bt-web2/helpers/gte",["exports","ember-truth-helpers/helpers/gte"],(function(e,t){Object.defineProperty(e,"__esModule",{value:!0}),Object.defineProperty(e,"default",{enumerable:!0,get:function(){return t.default}}),Object.defineProperty(e,"gte",{enumerable:!0,get:function(){return t.gte}})})),define("bt-web2/helpers/is-array",["exports","ember-truth-helpers/helpers/is-array"],(function(e,t){Object.defineProperty(e,"__esModule",{value:!0}),Object.defineProperty(e,"default",{enumerable:!0,get:function(){return t.default}}),Object.defineProperty(e,"isArray",{enumerable:!0,get:function(){return t.isArray}})})),define("bt-web2/helpers/is-empty",["exports","ember-truth-helpers/helpers/is-empty"],(function(e,t){Object.defineProperty(e,"__esModule",{value:!0}),Object.defineProperty(e,"default",{enumerable:!0,get:function(){return t.default}})})),define("bt-web2/helpers/is-equal",["exports","ember-truth-helpers/helpers/is-equal"],(function(e,t){Object.defineProperty(e,"__esModule",{value:!0}),Object.defineProperty(e,"default",{enumerable:!0,get:function(){return t.default}}),Object.defineProperty(e,"isEqual",{enumerable:!0,get:function(){return t.isEqual}})})),define("bt-web2/helpers/lt",["exports","ember-truth-helpers/helpers/lt"],(function(e,t){Object.defineProperty(e,"__esModule",{value:!0}),Object.defineProperty(e,"default",{enumerable:!0,get:function(){return t.default}}),Object.defineProperty(e,"lt",{enumerable:!0,get:function(){return t.lt}})})),define("bt-web2/helpers/lte",["exports","ember-truth-helpers/helpers/lte"],(function(e,t){Object.defineProperty(e,"__esModule",{value:!0}),Object.defineProperty(e,"default",{enumerable:!0,get:function(){return t.default}}),Object.defineProperty(e,"lte",{enumerable:!0,get:function(){return t.lte}})})),define("bt-web2/helpers/md5",["exports","ember-md5/helpers/md5"],(function(e,t){Object.defineProperty(e,"__esModule",{value:!0}),Object.defineProperty(e,"default",{enumerable:!0,get:function(){return t.default}})})),define("bt-web2/helpers/not-eq",["exports","ember-truth-helpers/helpers/not-equal"],(function(e,t){Object.defineProperty(e,"__esModule",{value:!0}),Object.defineProperty(e,"default",{enumerable:!0,get:function(){return t.default}}),Object.defineProperty(e,"notEq",{enumerable:!0,get:function(){return t.notEq}})})),define("bt-web2/helpers/not",["exports","ember-truth-helpers/helpers/not"],(function(e,t){Object.defineProperty(e,"__esModule",{value:!0}),Object.defineProperty(e,"default",{enumerable:!0,get:function(){return t.default}}),Object.defineProperty(e,"not",{enumerable:!0,get:function(){return t.not}})})),define("bt-web2/helpers/or",["exports","ember-truth-helpers/helpers/or"],(function(e,t){Object.defineProperty(e,"__esModule",{value:!0}),Object.defineProperty(e,"default",{enumerable:!0,get:function(){return t.default}}),Object.defineProperty(e,"or",{enumerable:!0,get:function(){return t.or}})})),define("bt-web2/helpers/t",["exports","ember-intl/helpers/t"],(function(e,t){Object.defineProperty(e,"__esModule",{value:!0}),Object.defineProperty(e,"default",{enumerable:!0,get:function(){return t.default}})})),define("bt-web2/helpers/time-display",["exports","bt-web2/server-client-common/Utils"],(function(e,t){function n(e){if(!(e.length<1)){var n=parseFloat(e[0])
return isFinite(n)?(0,t.formatSecondsHms)(n):e[0]}}Object.defineProperty(e,"__esModule",{value:!0}),e.timeDisplay=n,e.default=void 0
var r=Ember.Helper.helper(n)
e.default=r})),define("bt-web2/helpers/xor",["exports","ember-truth-helpers/helpers/xor"],(function(e,t){Object.defineProperty(e,"__esModule",{value:!0}),Object.defineProperty(e,"default",{enumerable:!0,get:function(){return t.default}}),Object.defineProperty(e,"xor",{enumerable:!0,get:function(){return t.xor}})})),define("bt-web2/hrm-control/controller",["exports","bt-web2/server-client-common/heart-rate-engine"],(function(e,t){var n,r,o,i
function a(e){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function s(e,t){for(var n=0;n<t.length;n++){var r=t[n]
r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function c(e,t){return!t||"object"!==a(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called")
return e}(e):t}function u(e){return(u=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function l(e,t){return(l=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function f(e,t,n,r,o){var i={}
return Object.keys(r).forEach((function(e){i[e]=r[e]})),i.enumerable=!!i.enumerable,i.configurable=!!i.configurable,("value"in i||i.initializer)&&(i.writable=!0),i=n.slice().reverse().reduce((function(n,r){return r(e,t,n)||n}),i),o&&void 0!==i.initializer&&(i.value=i.initializer?i.initializer.call(o):void 0,i.initializer=void 0),void 0===i.initializer&&(Object.defineProperty(e,t,i),i=null),i}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
var p=(n=Ember.computed("lastBpm"),r=Ember.computed("targetHandicap"),o=Ember.computed("targetBpm"),f((i=function(e){function n(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,n),c(this,u(n).apply(this,arguments))}var r,o,i
return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function")
e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&l(e,t)}(n,e),r=n,(o=[{key:"startup",value:function(){var e=this
console.log("starting hrm control mode")
var n=(new Date).getTime(),r=this.devices.getLocalUser()
r?(this.set("hrmEngine",new t.HeartRateEngine(r.getLastHrm(n))),setTimeout((function t(){var o=(new Date).getTime(),i=(o-n)/1e3
n=o
var a=e.get("targetBpm"),s=e.get("targetHandicap"),c=e.get("hrmEngine")
if(c&&r){var u=c.tick(r,o,i,a,s,e.get("gain")/100).newTargetHandicap
e.set("targetHandicap",u)}e.devices.tick(o,!1),e.isDestroyed||setTimeout(t,500)}),500)):alert("Somehow we don't have a user")}},{key:"_applyTargetErg",value:function(e,t){this.devices.setErgMode(t*e.getHandicap()/100),this.set("targetHandicap",t)}},{key:"strLastBpm",get:function(){return this.get("lastBpm").toFixed(0)+"bpm"}},{key:"strTargetHandicap",get:function(){return this.get("targetHandicap").toFixed(1)+"%"}},{key:"strTargetBpm",get:function(){return this.get("targetBpm").toFixed(0)+"bpm"}}])&&s(r.prototype,o),i&&s(r,i),n}(Ember.Controller.extend({devices:Ember.inject.service(),lastBpm:0,targetHandicap:75,targetBpm:150,gain:100,hrmEngine:null,actions:{upTarget:function(e){this.incrementProperty("targetBpm",e)},downTarget:function(e){this.decrementProperty("targetBpm",e)},upErg:function(){this.incrementProperty("targetHandicap")},downErg:function(){this.decrementProperty("targetHandicap")},gainAdjust:function(e){this.incrementProperty("gain",e)},downloadFile:function(){this.devices.dumpPwx("HRM-Control",(new Date).getTime())}}}))).prototype,"strLastBpm",[n],Object.getOwnPropertyDescriptor(i.prototype,"strLastBpm"),i.prototype),f(i.prototype,"strTargetHandicap",[r],Object.getOwnPropertyDescriptor(i.prototype,"strTargetHandicap"),i.prototype),f(i.prototype,"strTargetBpm",[o],Object.getOwnPropertyDescriptor(i.prototype,"strTargetBpm"),i.prototype),i)
e.default=p})),define("bt-web2/hrm-control/route",["exports"],(function(e){function t(e){return(t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function n(e,t){for(var n=0;n<t.length;n++){var r=t[n]
r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function r(e,n){return!n||"object"!==t(n)&&"function"!=typeof n?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called")
return e}(e):n}function o(e){return(o=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function i(e,t){return(i=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
var a=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),r(this,o(t).apply(this,arguments))}var a,s,c
return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function")
e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&i(e,t)}(t,Ember.Route.extend({})),a=t,(s=[{key:"setupController",value:function(e,t){e.set("model",t),e.startup()}}])&&n(a.prototype,s),c&&n(a,c),t}()
e.default=a})),define("bt-web2/hrm-control/template",["exports"],(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
var t=Ember.HTMLBars.template({id:"6q7q94xe",block:'{"symbols":[],"statements":[[7,"div",true],[10,"class","hrm-control__super-container"],[8],[0,"\\n  "],[7,"div",true],[10,"class","hrm-control__container"],[8],[0,"\\n    "],[7,"h1",true],[8],[0,"HRM control mode"],[9],[0,"\\n    "],[7,"div",true],[10,"class","hrm-control__button-row"],[8],[0,"\\n      "],[7,"button",false],[12,"class","hrm-control__button"],[3,"action",[[23,0,[]],"upErg"]],[8],[0,"% Up"],[9],[7,"br",true],[8],[9],[0,"\\n      "],[7,"button",false],[12,"class","hrm-control__button"],[3,"action",[[23,0,[]],"downErg"]],[8],[0,"% Down"],[9],[7,"br",true],[8],[9],[0,"\\n    "],[9],[0,"\\n    "],[7,"div",true],[10,"class","hrm-control__data"],[8],[0,"\\n      "],[7,"div",true],[10,"class","hrm-control__data-row"],[8],[0,"\\n        "],[7,"div",true],[10,"class","hrm-control__data-key"],[8],[0,"Target %"],[9],[0,"\\n        "],[7,"div",true],[10,"class","hrm-control__data-value"],[8],[1,[22,"strTargetHandicap"],false],[9],[0,"\\n      "],[9],[0,"\\n      "],[7,"div",true],[10,"class","hrm-control__data-row"],[8],[0,"\\n        "],[7,"div",true],[10,"class","hrm-control__data-key"],[8],[0,"Current bpm"],[9],[0,"\\n        "],[7,"div",true],[10,"class","hrm-control__data-value"],[8],[1,[22,"strLastBpm"],false],[9],[0,"\\n      "],[9],[0,"\\n      "],[7,"div",true],[10,"class","hrm-control__data-row"],[8],[0,"\\n        "],[7,"div",true],[10,"class","hrm-control__data-key"],[8],[0,"Target bpm"],[9],[0,"\\n        "],[7,"div",true],[10,"class","hrm-control__data-value"],[8],[1,[22,"strTargetBpm"],false],[9],[0,"\\n      "],[9],[0,"\\n    "],[9],[0,"\\n    "],[7,"div",true],[10,"class","hrm-control__button-row"],[8],[0,"\\n      "],[7,"button",false],[12,"class","hrm-control__button"],[3,"action",[[23,0,[]],"downTarget",5]],[8],[7,"i",true],[10,"class","fas fa-heart hrm-control__heart down5"],[8],[9],[0," -5"],[9],[7,"br",true],[8],[9],[0,"\\n      "],[7,"button",false],[12,"class","hrm-control__button"],[3,"action",[[23,0,[]],"downTarget",1]],[8],[7,"i",true],[10,"class","fas fa-heart hrm-control__heart down1"],[8],[9],[0," -1"],[9],[7,"br",true],[8],[9],[0,"\\n      "],[7,"button",false],[12,"class","hrm-control__button"],[3,"action",[[23,0,[]],"upTarget",1]],[8],[7,"i",true],[10,"class","fas fa-heart hrm-control__heart up1"],[8],[9],[0," +1"],[9],[7,"br",true],[8],[9],[0,"\\n      "],[7,"button",false],[12,"class","hrm-control__button"],[3,"action",[[23,0,[]],"upTarget",5]],[8],[7,"i",true],[10,"class","fas fa-heart hrm-control__heart up5"],[8],[9],[0," +5"],[9],[7,"br",true],[8],[9],[0,"\\n    "],[9],[0,"\\n    "],[7,"div",true],[10,"class","hrm-control__button-row"],[8],[0,"\\n      "],[7,"button",false],[12,"class","hrm-control__button"],[3,"action",[[23,0,[]],"gainAdjust",-1]],[8],[0,"Aggro - 1"],[9],[7,"br",true],[8],[9],[0,"\\n      "],[1,[22,"gain"],false],[0,"\\n      "],[7,"button",false],[12,"class","hrm-control__button"],[3,"action",[[23,0,[]],"gainAdjust",1]],[8],[0,"Aggro + 1"],[9],[7,"br",true],[8],[9],[0,"\\n    "],[9],[0,"\\n    "],[7,"br",true],[8],[9],[7,"br",true],[8],[9],[0,"\\n    "],[7,"button",false],[12,"class","hrm-control__download"],[3,"action",[[23,0,[]],"downloadFile"]],[8],[0,"Download PWX"],[9],[0,"\\n  "],[9],[0,"\\n"],[9]],"hasEval":false}',meta:{moduleName:"bt-web2/hrm-control/template.hbs"}})
e.default=t})),define("bt-web2/index/controller",["exports"],(function(e){function t(e){return(t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function n(e,n){return!n||"object"!==t(n)&&"function"!=typeof n?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called")
return e}(e):n}function r(e){return(r=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function o(e,t){return(o=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
var i=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),n(this,r(t).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function")
e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&o(e,t)}(t,Ember.Controller.extend({devices:Ember.inject.service()})),t}()
e.default=i})),define("bt-web2/index/route",["exports"],(function(e){function t(e){return(t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function n(e,n){return!n||"object"!==t(n)&&"function"!=typeof n?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called")
return e}(e):n}function r(e){return(r=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function o(e,t){return(o=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
var i=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),n(this,r(t).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function")
e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&o(e,t)}(t,e),t}(Ember.Route.extend({actions:{goto:function(e){this.transitionTo(e)}}}))
e.default=i})),define("bt-web2/index/template",["exports"],(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
var t=Ember.HTMLBars.template({id:"zHk0OJqQ",block:'{"symbols":[],"statements":[[7,"div",true],[10,"class","index__container"],[8],[0,"\\n  "],[1,[22,"tourjs-header"],false],[0,"\\n  "],[7,"div",false],[12,"class","index__activity user"],[3,"action",[[23,0,[]],"goto","set-up-user"]],[8],[0,"\\n"],[4,"vertical-align",null,[["class"],["index__activity--text"]],{"statements":[[0,"      Setup User\\n"]],"parameters":[]},null],[0,"  "],[9],[0,"\\n  "],[7,"div",false],[12,"class","index__activity race"],[3,"action",[[23,0,[]],"goto","set-up-ride"]],[8],[0,"\\n"],[4,"vertical-align",null,[["class"],["index__activity--text"]],{"statements":[[0,"      Race\\n"]],"parameters":[]},null],[0,"  "],[9],[0,"\\n  "],[7,"div",false],[12,"class","index__activity hrm-control"],[3,"action",[[23,0,[]],"goto","hrm-control"]],[8],[0,"\\n"],[4,"vertical-align",null,[["class"],["index__activity--text"]],{"statements":[[0,"      Heart Rate Workout\\n"]],"parameters":[]},null],[0,"  "],[9],[0,"\\n  "],[7,"div",false],[12,"class","index__activity pacing-challenge"],[3,"action",[[23,0,[]],"goto","pacing-challenge"]],[8],[0,"\\n"],[4,"vertical-align",null,[["class"],["index__activity--text"]],{"statements":[[0,"      Pacing Challenge\\n"]],"parameters":[]},null],[0,"  "],[9],[0,"\\n  "],[1,[22,"stored-data"],false],[0,"\\n"],[9]],"hasEval":false}',meta:{moduleName:"bt-web2/index/template.hbs"}})
e.default=t})),define("bt-web2/initializers/app-version",["exports","ember-cli-app-version/initializer-factory","bt-web2/config/environment"],(function(e,t,n){var r,o
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,n.default.APP&&(r=n.default.APP.name,o=n.default.APP.version)
var i={name:"App Version",initialize:(0,t.default)(r,o)}
e.default=i})),define("bt-web2/initializers/container-debug-adapter",["exports","ember-resolver/resolvers/classic/container-debug-adapter"],(function(e,t){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
var n={name:"container-debug-adapter",initialize:function(){var e=arguments[1]||arguments[0]
e.register("container-debug-adapter:main",t.default),e.inject("container-debug-adapter:main","namespace","application:main")}}
e.default=n})),define("bt-web2/initializers/export-application-global",["exports","bt-web2/config/environment"],(function(e,t){function n(){var e=arguments[1]||arguments[0]
if(!1!==t.default.exportApplicationGlobal){var n
if("undefined"!=typeof window)n=window
else if("undefined"!=typeof global)n=global
else{if("undefined"==typeof self)return
n=self}var r,o=t.default.exportApplicationGlobal
r="string"==typeof o?o:Ember.String.classify(t.default.modulePrefix),n[r]||(n[r]=e,e.reopen({willDestroy:function(){this._super.apply(this,arguments),delete n[r]}}))}}Object.defineProperty(e,"__esModule",{value:!0}),e.initialize=n,e.default=void 0
var r={name:"export-application-global",initialize:n}
e.default=r})),define("bt-web2/kickr-setup/controller",["exports","bt-web2/pojs/WebBluetoothDevice"],(function(e,t){function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function r(e,t){return!t||"object"!==n(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called")
return e}(e):t}function o(e){return(o=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function i(e,t){return(i=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e,t){for(var n=0;n<t.length;n++){var r=t[n]
r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function c(e,t,n){return t&&s(e.prototype,t),n&&s(e,n),e}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
var u=function(){function e(){var t,n,r
a(this,e),r=0,(n="slope")in(t=this)?Object.defineProperty(t,n,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[n]=r}return c(e,[{key:"getLastSlopeInWholePercent",value:function(){return this.slope}},{key:"setSlope",value:function(e){this.slope=e}}]),e}(),l=function(e){function t(){return a(this,t),r(this,o(t).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function")
e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&i(e,t)}(t,e),c(t,[{key:"_setup",value:function(){var e=this,t=parseInt(window.localStorage.getItem("kickr-downhill-number")||"0x3fff")
this.set("downhillStrength",t)
var n=parseInt(window.localStorage.getItem("kickr-uphill-number")||"0x2000")
this.set("uphillStrength",n)
setTimeout((function(){return function t(){e.incrementProperty("frame"),window.location.pathname.includes("kickr-setup")&&setTimeout((function(){return t()}),1e3)}()}),1e3)}}]),t}(Ember.Controller.extend({devices:Ember.inject.service("devices"),downhillStrength:16383,uphillStrength:8192,currentHill:0,mySlopeSource:new u,frame:0,_applyToKickr:function(e,n){var r=t.BluetoothKickrDevice.getKickrDevice()
r&&(r.setUphillDownhill(Math.floor(e),Math.floor(n)),console.log("applied uphill/downhill to kickr"))},hillObserver:Ember.observer("currentHill","downhillStrength","uphillStrength","frame",(function(){if(!this.isDestroyed){var e=this.get("currentHill"),n=parseInt(""+this.get("downhillStrength")),r=parseInt(""+this.get("uphillStrength")),o=this.get("frame")
console.log("kickr setup frame "+o+" setting slope to ",e),this.get("mySlopeSource").setSlope(e)
var i=t.BluetoothKickrDevice.getKickrDevice()
i&&(i.setUphillDownhill(n,r),i.setSlopeSource(this.get("mySlopeSource")),i.updateSlope((new Date).getTime(),1))}})),actions:{downhill:function(e){var t=parseInt(""+this.get("downhillStrength")),n=Math.min(16383,Math.max(0,t*e)),r=parseInt(""+this.get("uphillStrength")),o=Math.min(n-1,r)
this.set("downhillStrength",Math.floor(n)),this.set("uphillStrength",Math.floor(o)),this._applyToKickr(n,o)},uphill:function(e){var t=parseInt(""+this.get("uphillStrength")),n=Math.min(16383,Math.max(0,t*e)),r=parseInt(""+this.get("downhillStrength")),o=Math.max(n+1,r)
this.set("downhillStrength",Math.floor(o)),this.set("uphillStrength",Math.floor(n)),this._applyToKickr(o,n)},save:function(){window.localStorage.setItem("kickr-downhill-number",""+parseInt(""+this.get("downhillStrength"))),window.localStorage.setItem("kickr-uphill-number",""+parseInt(""+this.get("uphillStrength"))),alert("Saved kickr configs")},setHill:function(e){this.set("currentHill",e)}}}))
e.default=l})),define("bt-web2/kickr-setup/route",["exports"],(function(e){function t(e){return(t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function n(e,t){for(var n=0;n<t.length;n++){var r=t[n]
r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function r(e,n){return!n||"object"!==t(n)&&"function"!=typeof n?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called")
return e}(e):n}function o(e){return(o=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function i(e,t){return(i=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
var a=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),r(this,o(t).apply(this,arguments))}var a,s,c
return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function")
e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&i(e,t)}(t,Ember.Route.extend({})),a=t,(s=[{key:"setupController",value:function(e){e._setup()}}])&&n(a.prototype,s),c&&n(a,c),t}()
e.default=a})),define("bt-web2/kickr-setup/template",["exports"],(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
var t=Ember.HTMLBars.template({id:"RU6TxSVx",block:'{"symbols":[],"statements":[[7,"div",true],[10,"class","index__container"],[8],[0,"\\n  "],[1,[22,"tourjs-header"],false],[0,"\\n  "],[7,"p",true],[8],[0,"Do you have a Wahoo Kickr?  Wahoo doesn\'t appear to have released the specs for their control protocol, so this lets you configure my best-guess protocol."],[9],[0,"\\n  "],[7,"br",true],[8],[9],[0,"\\n  "],[7,"h4",true],[8],[0,"How to use"],[9],[0,"\\n  "],[7,"ul",true],[8],[0,"\\n    "],[7,"li",true],[8],[0,"Connect your kickr"],[9],[0,"\\n    "],[7,"li",true],[8],[0,"Shift to your fastest gear setting (downhill config)"],[9],[0,"\\n    "],[7,"li",true],[8],[0,"Set it to -10% with the buttons below"],[9],[0,"\\n    "],[7,"li",true],[8],[0,"Screw around with the \\"downhill strength\\" setting"],[9],[0,"\\n    "],[7,"li",true],[8],[0,"Shift to your gear you\'ll be doing climbing in"],[9],[0,"\\n    "],[7,"li",true],[8],[0,"Set it to +10% with the buttons below"],[9],[0,"\\n    "],[7,"li",true],[8],[0,"Screw around with the \\"uphill strength\\" setting"],[9],[0,"\\n    "],[7,"li",true],[8],[7,"b",true],[8],[0,"Don\'t forget to click \\"save\\" so you only have to do this once"],[9],[9],[0,"\\n  "],[9],[0,"\\n\\n"],[7,"br",true],[8],[9],[7,"br",true],[8],[9],[0,"\\n  Downhill Strength"],[7,"br",true],[8],[9],[0,"\\n  "],[1,[28,"input",null,[["class","value"],["kickr-setup__input",[24,["downhillStrength"]]]]],false],[0,"\\n  "],[7,"button",false],[12,"class","kickr-setup__button"],[3,"action",[[23,0,[]],"downhill",0.98]],[8],[0,"Harder"],[9],[0,"\\n  "],[7,"button",false],[12,"class","kickr-setup__button"],[3,"action",[[23,0,[]],"downhill",1.02]],[8],[0,"Easier"],[9],[7,"br",true],[8],[9],[0,"\\n\\n  Uphill Strength"],[7,"br",true],[8],[9],[0,"\\n  "],[1,[28,"input",null,[["class","value"],["kickr-setup__input",[24,["uphillStrength"]]]]],false],[0,"\\n  "],[7,"button",false],[12,"class","kickr-setup__button"],[3,"action",[[23,0,[]],"uphill",0.98]],[8],[0,"Harder"],[9],[0,"\\n  "],[7,"button",false],[12,"class","kickr-setup__button"],[3,"action",[[23,0,[]],"uphill",1.02]],[8],[0,"Easier"],[9],[7,"br",true],[8],[9],[0,"\\n  "],[7,"br",true],[8],[9],[0,"\\n  "],[7,"button",false],[12,"class","kickr-setup__button"],[3,"action",[[23,0,[]],"save"]],[8],[0,"Save Uphill/downhill strengths"],[9],[0,"\\n  "],[7,"br",true],[8],[9],[7,"br",true],[8],[9],[0,"\\n  "],[7,"h3",true],[8],[0,"Test your settings below"],[9],[0,"\\n\\n\\n  "],[7,"button",false],[12,"class","kickr-setup__button"],[3,"action",[[23,0,[]],"setHill",-20]],[8],[0,"-20%"],[9],[0,"\\n  "],[7,"button",false],[12,"class","kickr-setup__button"],[3,"action",[[23,0,[]],"setHill",-10]],[8],[0,"-10%"],[9],[0,"\\n  "],[7,"button",false],[12,"class","kickr-setup__button"],[3,"action",[[23,0,[]],"setHill",-8]],[8],[0,"-8%"],[9],[0,"\\n  "],[7,"button",false],[12,"class","kickr-setup__button"],[3,"action",[[23,0,[]],"setHill",-6]],[8],[0,"-6%"],[9],[0,"\\n  "],[7,"button",false],[12,"class","kickr-setup__button"],[3,"action",[[23,0,[]],"setHill",-4]],[8],[0,"-4%"],[9],[0,"\\n  "],[7,"button",false],[12,"class","kickr-setup__button"],[3,"action",[[23,0,[]],"setHill",-2]],[8],[0,"-2%"],[9],[7,"br",true],[8],[9],[0,"\\n  "],[7,"button",false],[12,"class","kickr-setup__button"],[3,"action",[[23,0,[]],"setHill",0]],[8],[0,"Flat"],[9],[7,"br",true],[8],[9],[0,"\\n\\n  "],[7,"button",false],[12,"class","kickr-setup__button"],[3,"action",[[23,0,[]],"setHill",2]],[8],[0,"2%"],[9],[0,"\\n  "],[7,"button",false],[12,"class","kickr-setup__button"],[3,"action",[[23,0,[]],"setHill",4]],[8],[0,"4%"],[9],[0,"\\n  "],[7,"button",false],[12,"class","kickr-setup__button"],[3,"action",[[23,0,[]],"setHill",6]],[8],[0,"6%"],[9],[0,"\\n  "],[7,"button",false],[12,"class","kickr-setup__button"],[3,"action",[[23,0,[]],"setHill",8]],[8],[0,"8%"],[9],[0,"\\n  "],[7,"button",false],[12,"class","kickr-setup__button"],[3,"action",[[23,0,[]],"setHill",10]],[8],[0,"10%"],[9],[0,"\\n  "],[7,"button",false],[12,"class","kickr-setup__button"],[3,"action",[[23,0,[]],"setHill",20]],[8],[0,"20%"],[9],[0,"\\n\\n"],[9]],"hasEval":false}',meta:{moduleName:"bt-web2/kickr-setup/template.hbs"}})
e.default=t})),define("bt-web2/models/wordpress/attachment",["exports","ember-wordpress/models/attachment"],(function(e,t){Object.defineProperty(e,"__esModule",{value:!0}),Object.defineProperty(e,"default",{enumerable:!0,get:function(){return t.default}})}))
define("bt-web2/models/wordpress/category",["exports","ember-wordpress/models/term"],(function(e,t){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
var n=t.default.extend({})
e.default=n})),define("bt-web2/models/wordpress/comment",["exports","ember-wordpress/models/comment"],(function(e,t){Object.defineProperty(e,"__esModule",{value:!0}),Object.defineProperty(e,"default",{enumerable:!0,get:function(){return t.default}})})),define("bt-web2/models/wordpress/page",["exports","ember-wordpress/models/post"],(function(e,t){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
var n=t.default.extend({})
e.default=n})),define("bt-web2/models/wordpress/post",["exports","ember-wordpress/models/post"],(function(e,t){Object.defineProperty(e,"__esModule",{value:!0}),Object.defineProperty(e,"default",{enumerable:!0,get:function(){return t.default}})})),define("bt-web2/models/wordpress/tag",["exports","ember-wordpress/models/term"],(function(e,t){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
var n=t.default.extend({})
e.default=n})),define("bt-web2/models/wordpress/user",["exports","ember-wordpress/models/user"],(function(e,t){Object.defineProperty(e,"__esModule",{value:!0}),Object.defineProperty(e,"default",{enumerable:!0,get:function(){return t.default}})})),define("bt-web2/pacing-challenge-race/controller",["exports","bt-web2/server-client-common/User","bt-web2/server-client-common/RideMap","bt-web2/server-client-common/RaceState","bt-web2/set-up-ride/route"],(function(e,t,n,r,o){var i,a
function s(e){return(s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function c(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function u(e,t,n){return(u="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=m(e)););return e}(e,t)
if(r){var o=Object.getOwnPropertyDescriptor(r,t)
return o.get?o.get.call(n):o.value}})(e,t,n||e)}function l(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function f(e,t){for(var n=0;n<t.length;n++){var r=t[n]
r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function p(e,t,n){return t&&f(e.prototype,t),n&&f(e,n),e}function d(e,t){return!t||"object"!==s(t)&&"function"!=typeof t?h(e):t}function h(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called")
return e}function m(e){return(m=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function y(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function")
e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&v(e,t)}function v(e,t){return(v=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}Object.defineProperty(e,"__esModule",{value:!0}),e.getPacingChallengeMap=P,e.default=e.PacingChallengeUserProvider=e.PacingChallengeLong=e.PacingChallengeFlat=e.PacingChallengeHills2=e.PacingChallengeHills1=e.PacingChallengeShortMap=void 0
var b=function(e){function n(){return l(this,n),d(this,m(n).apply(this,arguments))}return y(n,e),p(n,[{key:"getPowerTransform",value:function(e){return function(n){return t.DEFAULT_HANDICAP_POWER*(n/e.getHandicap())}}},{key:"getBounds",value:function(){return{minElev:-40,maxElev:50,minDist:0,maxDist:this.getLength()}}},{key:"getElevationAtDistance",value:function(e){return 15*Math.cos(e/400)+2.5*Math.cos(e/170)-7.5*Math.cos(e/2200)+50*Math.cos(Math.cos(e/750))-25}},{key:"getLength",value:function(){return 5e3}}]),n}(n.RideMapPartial)
e.PacingChallengeShortMap=b
var g=function(e){function t(){return l(this,t),d(this,m(t).apply(this,arguments))}return y(t,e),p(t,[{key:"getLength",value:function(){return"localhost"===window.location.hostname?100:u(m(t.prototype),"getLength",this).call(this)}},{key:"getElevationAtDistance",value:function(e){return 15*Math.cos(e/400)+2.5*Math.cos(e/170)-7.5*Math.cos(e/2200)+50*Math.cos(Math.cos(e/750))-25}}]),t}(b)
e.PacingChallengeHills1=g
var _=function(e){function t(){return l(this,t),d(this,m(t).apply(this,arguments))}return y(t,e),p(t,[{key:"getBounds",value:function(){return{minElev:0,maxElev:60,minDist:0,maxDist:this.getLength()}}},{key:"getElevationAtDistance",value:function(e){return 12*Math.cos(e/300)+6.5*Math.cos(e/150)+50*Math.cos(Math.cos(e/750))-25+e/250}}]),t}(b)
e.PacingChallengeHills2=_
var w=function(e){function t(){return l(this,t),d(this,m(t).apply(this,arguments))}return y(t,e),p(t,[{key:"getBounds",value:function(){return{minElev:0,maxElev:20,minDist:0,maxDist:this.getLength()}}},{key:"getElevationAtDistance",value:function(e){return 2*Math.sin(e/1e3)}}]),t}(b)
e.PacingChallengeFlat=w
var S=function(e){function t(){return l(this,t),d(this,m(t).apply(this,arguments))}return y(t,e),p(t,[{key:"getBounds",value:function(){return{minElev:-10,maxElev:60,minDist:0,maxDist:this.getLength()}}},{key:"getLength",value:function(){return 15e3}},{key:"getElevationAtDistance",value:function(e){return e<=1500?.01*e:e<=3e3?15-.01*(e-=1500):e<=5500?(e-=3e3,12*Math.sin(e/300)+6.5*Math.sin(e/150)+50*Math.sin(Math.sin(e/750))):e<=7500?this.getElevationAtDistance(5500):(e-=7500,this.getElevationAtDistance(7500)+8*Math.sin(Math.pow(e,.6)/1300)+5.5*Math.sin(e/250)+30*Math.sin(Math.sin(e/350)))}}]),t}(b)
function P(e){switch(e){default:case"hills1":return new g
case"hills2":return new _
case"flat":return new w
case"long":return new S}}e.PacingChallengeLong=S
var k=function(){function e(n,r,o){if(l(this,e),c(this,"users",void 0),c(this,"localUser",void 0),!n)throw new Error("You need to have your devices set up before starting")
n.setDistance(0),n.setSpeed(10),this.users=[n],this.localUser=n
for(var i=Math.min(o/2,2e3),a=1;a<30;a++){var s=new t.User("AI ".concat(30-a+1),t.DEFAULT_RIDER_MASS,100,t.UserTypeFlags.Ai|t.UserTypeFlags.Remote)
s.setDistance(a/30*i),s.notifyPower((new Date).getTime(),100*r*.9),this.users.push(s)}this.users.forEach((function(e,t){e.getId()<0&&e.setId(t)}))}return p(e,[{key:"getUsers",value:function(e){return this.users.slice()}},{key:"getUser",value:function(e){return this.users.find((function(t){return t.getId()===e}))||null}},{key:"getLocalUser",value:function(){return this.localUser}}]),e}()
e.PacingChallengeUserProvider=k
var O,E,T,j,D,x,M=0,U=(i=Ember.computed("ticks","handicapSecondsAllowed","usedAllPower"),O=(a=function(e){function n(){var e,t
l(this,n)
for(var r=arguments.length,o=new Array(r),i=0;i<r;i++)o[i]=arguments[i]
return c(h(t=d(this,(e=m(n)).call.apply(e,[this].concat(o)))),"pickedMapName",""),c(h(t),"_map",null),c(h(t),"_userProvider",null),c(h(t),"_raceState",null),c(h(t),"pctZeroTo100",0),c(h(t),"handicapSecondsAllowed",0),c(h(t),"ticks",0),c(h(t),"startingSpeedJoules",0),c(h(t),"_id",0),c(h(t),"usedAllPower",!1),t}return y(n,Ember.Controller.extend({devices:Ember.inject.service(),transitionedOut:false})),p(n,[{key:"_setup",value:function(e){this._id=M++,this.set("usedAllPower",!1),console.log("starting pacing challenge id ",this._id),this.set("transitionedOut",!1)
var n=parseFloat(e.pct)
if(n<0||n>200)throw new Error("Effort level out of range")
this.set("pctZeroTo100",n)
var o=this.devices.getLocalUser()
if(!o)throw new Error("You don't have a user set up yet")
var i=n/100
this.set("pickedMapName",e.map),this._map=P(e.map),this._userProvider=new k(o,n/100,this._map.getLength()),this.set("_raceState",new r.RaceState(this._map,this._userProvider,"Pacing-Challenge-".concat(n.toFixed(0),"%")))
var a=t.DEFAULT_HANDICAP_POWER*i,s=t.DEFAULT_CRR*t.DEFAULT_RIDER_MASS*t.DEFAULT_GRAVITY*this._map.getLength(),c=Math.pow(a/(t.DEFAULT_CDA*t.DEFAULT_RHO*.5),.333333333),u=.5*t.DEFAULT_CDA*t.DEFAULT_RHO*Math.pow(c,2)*this._map.getLength(),l=((this._map.getElevationAtDistance(this._map.getLength())-this._map.getElevationAtDistance(0))*t.DEFAULT_GRAVITY*t.DEFAULT_RIDER_MASS+s+u)/a,f=o.getHandicap()*i*l/o.getHandicap()
this.set("handicapSecondsAllowed",f),this.set("startingSpeedJoules",.5*t.DEFAULT_RIDER_MASS*Math.pow(c,2)),o.setDistance(0),o.setSpeed(c),this.devices.startPowerTimer("pacing-challenge"),this._tick()}},{key:"_tick",value:function(){var e=this
console.log("pacing-challenge-race ".concat(this._id," tick"))
var t=(new Date).getTime()
this.incrementProperty("ticks"),this.devices.tick(t,!0)
var n=this.devices.getLocalUser()
if(!n)throw new Error("You don't have a user set up yet")
var r=this._map
if(!r)throw new Error("No map")
var i=this._raceState
if(!i)throw new Error("No racestate")
var a=this.devices.getPowerCounterAverage(t,"pacing-challenge"),s=a.joules/n.getHandicap()
if(n.getDistance()>=r.getLength()){alert("You made it!\nIt took you ".concat(a.totalTimeSeconds.toFixed(1)," seconds and you used ").concat(s.toFixed(1)," energies.")),i.stop()
var c=this.get("handicapSecondsAllowed")-s,u={mapName:this.get("pickedMapName"),name:n.getName(),time:a.totalTimeSeconds,hsLeft:c,pct:this.get("pctZeroTo100")}
return(0,o.apiPost)("pacing-challenge-result",u).finally((function(){i.stop(),e.devices.dumpPwx("Pacing-Challenge-Success",(new Date).getTime()),e.transitionToRoute("pacing-challenge")}))}if(s>this.get("handicapSecondsAllowed")&&(this.set("usedAllPower",!0),this.devices.setPowerFilter((function(e){return console.log("filtered ",e.toFixed(0)," watts to zero"),0})),n.getSpeed()<1.5))return alert("You failed!\nYou used ".concat(s.toFixed(1)," energies before finishing the course.")),i.stop(),this.devices.dumpPwx("Pacing-Challenge-Failure",(new Date).getTime()),this.transitionToRoute("pacing-challenge")
this.isDestroyed||this.get("transitionedOut")?i.stop():setTimeout((function(){e._tick()}),200)}},{key:"notifyTransitionOut",value:function(){this.set("transitionedOut",!0)}},{key:"pacingChallengeData",get:function(){var e
if(!this._map)throw new Error("No map")
if(!this.get("handicapSecondsAllowed"))throw new Error("No limit on handi-seconds")
return console.log("used all power? ",this.get("usedAllPower")),{pctZeroToOne:this.get("pctZeroTo100")/100,handicapSecondsAllowed:this.get("handicapSecondsAllowed"),mapLen:this._map.getLength(),endOfRideElevation:null===(e=this._map)||void 0===e?void 0:e.getElevationAtDistance(this._map.getLength()),startOfRideElevation:this._map.getElevationAtDistance(0),speedJoulesToStart:this.get("startingSpeedJoules"),usedAllPower:this.get("usedAllPower")}}}]),n}()).prototype,E="pacingChallengeData",T=[i],j=Object.getOwnPropertyDescriptor(a.prototype,"pacingChallengeData"),D=a.prototype,x={},Object.keys(j).forEach((function(e){x[e]=j[e]})),x.enumerable=!!x.enumerable,x.configurable=!!x.configurable,("value"in x||x.initializer)&&(x.writable=!0),x=T.slice().reverse().reduce((function(e,t){return t(O,E,e)||e}),x),D&&void 0!==x.initializer&&(x.value=x.initializer?x.initializer.call(D):void 0,x.initializer=void 0),void 0===x.initializer&&(Object.defineProperty(O,E,x),x=null),a)
e.default=U})),define("bt-web2/pacing-challenge-race/route",["exports"],(function(e){function t(e){return(t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function n(e,t){for(var n=0;n<t.length;n++){var r=t[n]
r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function r(e,n){return!n||"object"!==t(n)&&"function"!=typeof n?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called")
return e}(e):n}function o(e){return(o=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function i(e,t){return(i=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
var a=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),r(this,o(t).apply(this,arguments))}var a,s,c
return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function")
e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&i(e,t)}(t,Ember.Route.extend({devices:Ember.inject.service()})),a=t,(s=[{key:"beforeModel",value:function(){var e
if(!this.devices.getLocalUser())return alert("You can't do a pacing challenge without having set yourself up first!"),this.transitionTo("pacing-challenge")
var t=(new Date).getTime()
return(null===(e=this.devices.getLocalUser())||void 0===e?void 0:e.isPowerValid(t))?void 0:(alert("You need a powermeter or trainer set up to play this game.  Click the lightning bolt."),this.transitionTo("pacing-challenge"))}},{key:"resetController",value:function(){this.controller.notifyTransitionOut()}},{key:"setupController",value:function(e,t){e._setup(t)}}])&&n(a.prototype,s),c&&n(a,c),t}()
e.default=a})),define("bt-web2/pacing-challenge-race/template",["exports"],(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
var t=Ember.HTMLBars.template({id:"AiCPfTGF",block:'{"symbols":[],"statements":[[1,[28,"display-race",null,[["raceState","overlay","overlayData"],[[24,["_raceState"]],"pacing-challenge-overlay",[24,["pacingChallengeData"]]]]],false]],"hasEval":false}',meta:{moduleName:"bt-web2/pacing-challenge-race/template.hbs"}})
e.default=t})),define("bt-web2/pacing-challenge/controller",["exports","bt-web2/pacing-challenge-race/controller","bt-web2/set-up-ride/route"],(function(e,t,n){function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function o(e,t){return!t||"object"!==r(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called")
return e}(e):t}function i(e){return(i=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function a(e,t){return(a=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
var s=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),o(this,i(t).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function")
e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&a(e,t)}(t,e),t}(Ember.Controller.extend({devices:Ember.inject.service(),pickedMapName:"hills1",pickedMap:Ember.computed("pickedMapName",(function(){return(0,t.getPacingChallengeMap)(this.get("pickedMapName"))})),pickedHills1:Ember.computed.equal("pickedMapName","hills1"),pickedHills2:Ember.computed.equal("pickedMapName","hills2"),pickedFlat:Ember.computed.equal("pickedMapName","flat"),pickedLong:Ember.computed.equal("pickedMapName","long"),actions:{start:function(e){var t=this.get("pickedMapName")
this.transitionToRoute("pacing-challenge-race",{pct:e,map:t})},pickMap:function(e){var t=this
this.set("pickedMapName",e),window.localStorage.setItem("pacing-challenge-map-name",e)
var r=this.get("devices").getLocalUser(),o=r&&r.getName()
return(0,n.apiGet)("pacing-challenge-records",{name:o,map:e}).then((function(e){t.set("model",e)}))}}}))
e.default=s})),define("bt-web2/pacing-challenge/route",["exports","bt-web2/set-up-ride/route"],(function(e,t){function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function r(e,t){for(var n=0;n<t.length;n++){var r=t[n]
r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function o(e,t){return!t||"object"!==n(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called")
return e}(e):t}function i(e){return(i=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function a(e,t){return(a=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
var s=function(e){function n(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,n),o(this,i(n).apply(this,arguments))}var s,c,u
return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function")
e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&a(e,t)}(n,Ember.Route.extend({devices:Ember.inject.service(),pickedMapName:"hills1"})),s=n,(c=[{key:"model",value:function(){var e=this.get("devices").getLocalUser(),n=e&&e.getName(),r=window.localStorage.getItem("pacing-challenge-map-name")||"hills1"
return this.set("pickedMapName",r),(0,t.apiGet)("pacing-challenge-records",{name:n,map:this.get("pickedMapName")}).then((function(e){return e}))}},{key:"setupController",value:function(e,t){console.log("setting up controller for pacing-challenge ",t),e.set("model",t),e.set("pickedMapName",this.get("pickedMapName"))}}])&&r(s.prototype,c),u&&r(s,u),n}()
e.default=s})),define("bt-web2/pacing-challenge/template",["exports"],(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
var t=Ember.HTMLBars.template({id:"IDq5pfMg",block:'{"symbols":["result","index","result","index","result","index","result","index","result","index"],"statements":[[7,"div",true],[10,"class","index__container"],[8],[0,"\\n  "],[1,[22,"tourjs-header"],false],[0,"\\n  "],[7,"div",true],[10,"class","index__activity explanation"],[8],[0,"\\n"],[4,"vertical-align",null,[["class"],["index__activity--text"]],{"statements":[[0,"      "],[7,"p",true],[8],[0,"Pacing Challenge mode is identical to if someone put 1L of gas in your can and told you to drive a 25km course as fast as you can.  You need to spend the energy available to you, but spend it efficiently!.  The various modes (125%, 100%, etc) give you more or less fuel to spend."],[9],[0,"\\n      "],[7,"p",true],[8],[0,"If you use too much energy, game over."],[9],[0,"\\n      "],[7,"p",true],[8],[0,"Tip: Powering up uphills and coasting downhills is wise."],[9],[0,"\\n"]],"parameters":[]},null],[0,"  "],[9],[0,"\\n\\n  "],[7,"div",true],[10,"class","index__activity explanation"],[8],[0,"\\n"],[4,"vertical-align",null,[["class"],["index__activity--text"]],{"statements":[[0,"      "],[7,"p",true],[8],[0,"Pacing Mode now offers different maps"],[9],[0,"\\n      "],[7,"p",true],[8],[0,"\\n        "],[7,"button",false],[12,"class","pacing-mode"],[12,"disabled",[22,"pickedHills1"]],[3,"action",[[23,0,[]],"pickMap","hills1"]],[8],[0,"Hills 1 (classic)"],[9],[0,"\\n        "],[7,"button",false],[12,"class","pacing-mode"],[12,"disabled",[22,"pickedHills2"]],[3,"action",[[23,0,[]],"pickMap","hills2"]],[8],[0,"Hills 2"],[9],[0,"\\n        "],[7,"button",false],[12,"class","pacing-mode"],[12,"disabled",[22,"pickedFlat"]],[3,"action",[[23,0,[]],"pickMap","flat"]],[8],[0,"Flat"],[9],[0,"\\n        "],[7,"button",false],[12,"class","pacing-mode"],[12,"disabled",[22,"pickedLong"]],[3,"action",[[23,0,[]],"pickMap","long"]],[8],[0,"15km"],[9],[0,"\\n      "],[9],[0,"\\n"]],"parameters":[]},null],[0,"  "],[9],[0,"\\n  "],[1,[28,"mini-map",null,[["race"],[[24,["pickedMap"]]]]],false],[0,"\\n\\n  "],[7,"div",false],[12,"class","index__activity 100"],[3,"action",[[23,0,[]],"start",125]],[8],[0,"\\n"],[4,"vertical-align",null,[["class"],["index__activity--text"]],{"statements":[[0,"      "],[7,"p",true],[8],[0,"125% Effort"],[9],[0,"\\n\\n"],[4,"each",[[24,["model","effort125"]]],null,{"statements":[[0,"        "],[7,"p",true],[10,"class","index__activity--small"],[8],[1,[23,9,["rank"]],false],[0,": "],[1,[28,"time-display",[[23,9,["time"]]],null],false],[0," by "],[1,[23,9,["name"]],false],[9],[0,"\\n"]],"parameters":[9,10]},null],[0,"      \\n"]],"parameters":[]},null],[0,"  "],[9],[0,"\\n  "],[7,"div",false],[12,"class","index__activity 100"],[3,"action",[[23,0,[]],"start",100]],[8],[0,"\\n"],[4,"vertical-align",null,[["class"],["index__activity--text"]],{"statements":[[0,"      "],[7,"p",true],[8],[0,"100% Effort"],[9],[0,"\\n"],[4,"each",[[24,["model","effort100"]]],null,{"statements":[[0,"        "],[7,"p",true],[10,"class","index__activity--small"],[8],[1,[23,7,["rank"]],false],[0,": "],[1,[28,"time-display",[[23,7,["time"]]],null],false],[0," by "],[1,[23,7,["name"]],false],[9],[0,"\\n"]],"parameters":[7,8]},null]],"parameters":[]},null],[0,"  "],[9],[0,"\\n  "],[7,"div",false],[12,"class","index__activity 90"],[3,"action",[[23,0,[]],"start",90]],[8],[0,"\\n"],[4,"vertical-align",null,[["class"],["index__activity--text"]],{"statements":[[0,"      90% Effort\\n"],[4,"each",[[24,["model","effort90"]]],null,{"statements":[[0,"        "],[7,"p",true],[10,"class","index__activity--small"],[8],[1,[23,5,["rank"]],false],[0,": "],[1,[28,"time-display",[[23,5,["time"]]],null],false],[0," by "],[1,[23,5,["name"]],false],[9],[0,"\\n"]],"parameters":[5,6]},null]],"parameters":[]},null],[0,"  "],[9],[0,"\\n  "],[7,"div",false],[12,"class","index__activity 80"],[3,"action",[[23,0,[]],"start",80]],[8],[0,"\\n"],[4,"vertical-align",null,[["class"],["index__activity--text"]],{"statements":[[0,"      80% Effort\\n"],[4,"each",[[24,["model","effort80"]]],null,{"statements":[[0,"        "],[7,"p",true],[10,"class","index__activity--small"],[8],[1,[23,3,["rank"]],false],[0,": "],[1,[28,"time-display",[[23,3,["time"]]],null],false],[0," by "],[1,[23,3,["name"]],false],[9],[0,"\\n"]],"parameters":[3,4]},null]],"parameters":[]},null],[0,"  "],[9],[0,"\\n  "],[7,"div",false],[12,"class","index__activity 50"],[3,"action",[[23,0,[]],"start",50]],[8],[0,"\\n"],[4,"vertical-align",null,[["class"],["index__activity--text"]],{"statements":[[0,"      50% Effort\\n"],[4,"each",[[24,["model","effort50"]]],null,{"statements":[[0,"        "],[7,"p",true],[10,"class","index__activity--small"],[8],[1,[23,1,["rank"]],false],[0,": "],[1,[28,"time-display",[[23,1,["time"]]],null],false],[0," by "],[1,[23,1,["name"]],false],[9],[0,"\\n"]],"parameters":[1,2]},null]],"parameters":[]},null],[0,"  "],[9],[0,"\\n"],[9]],"hasEval":false}',meta:{moduleName:"bt-web2/pacing-challenge/template.hbs"}})
e.default=t})),define("bt-web2/pojs/DeviceFactory",["exports","bt-web2/pojs/WebBluetoothDevice","bt-web2/pojs/DeviceUtils"],(function(e,t,n){function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){for(var n=0;n<t.length;n++){var r=t[n]
r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function a(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e}function s(e,t){return!t||"object"!==r(t)&&"function"!=typeof t?u(e):t}function c(e){return(c=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function u(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called")
return e}function l(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function")
e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&f(e,t)}function f(e,t){return(f=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}Object.defineProperty(e,"__esModule",{value:!0}),e.getDeviceFactory=function(){return h},e.TestPowermeter=void 0
var p=function(e){function n(){var e,t,r,i
return o(this,n),e=s(this,c(n).call(this)),t=u(e),i=null,(r="_interval")in t?Object.defineProperty(t,r,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[r]=i,e._interval=setInterval((function(){var t=(new Date).getTime()
e._notifyNewPower(t,50*Math.random()+200)}),500),e}return l(n,e),a(n,[{key:"getDeviceTypeDescription",value:function(){return"Fake Device"}},{key:"disconnect",value:function(){return clearInterval(this._interval),this._interval=null,Promise.resolve()}},{key:"getState",value:function(){return t.BTDeviceState.Ok}},{key:"name",value:function(){return"Test Powermeter"}},{key:"hasPower",value:function(){return!0}},{key:"hasCadence",value:function(){return!1}},{key:"hasHrm",value:function(){return!1}},{key:"updateSlope",value:function(e,t){return Promise.resolve(!1)}},{key:"updateErg",value:function(e,t){return Promise.resolve(!1)}},{key:"getDeviceId",value:function(){throw new Error("Method not implemented.")}},{key:"updateResistance",value:function(e,t){throw new Error("Method not implemented.")}}]),n}(t.PowerDataDistributor)
e.TestPowermeter=p
var d=function(e){function t(e){var r
return o(this,t),(r=s(this,c(t).call(this,e)))._startupPromise=r._startupPromise.then((function(){return(0,n.monitorCharacteristic)(e,"heart_rate","heart_rate_measurement",(function(e){r._decodeHrmData(e.target.value)}))})),r}return l(t,e),a(t,[{key:"_decodeHrmData",value:function(e){var t=(new Date).getTime(),n=0
n=0==(1&e.getUint8(0))?e.getUint8(1):e.getUint16(1,!0),this._notifyNewHrm(t,n)}},{key:"hasPower",value:function(){return!1}},{key:"hasCadence",value:function(){return!1}},{key:"hasHrm",value:function(){return!0}},{key:"getDeviceTypeDescription",value:function(){return"Bluetooth HRM"}},{key:"updateErg",value:function(e,t){return Promise.resolve(!1)}},{key:"updateSlope",value:function(e,t){return Promise.resolve(!1)}},{key:"updateResistance",value:function(e,t){return Promise.resolve(!1)}}]),t}(t.BluetoothDeviceShared),h=new(function(){function e(){o(this,e)}return a(e,[{key:"findDisplay",value:function(){var e,t,r,o,i
return regeneratorRuntime.async((function(a){for(;;)switch(a.prev=a.next){case 0:return this._checkAvailable(),e={filters:[{services:[n.serviceUuids.display4iiii]}]},a.next=4,regeneratorRuntime.awrap(navigator.bluetooth.requestDevice(e))
case 4:if(!(t=a.sent).gatt){a.next=18
break}return a.next=8,regeneratorRuntime.awrap(t.gatt.connect())
case 8:return r=a.sent,a.next=11,regeneratorRuntime.awrap(r.getPrimaryService(n.serviceUuids.display4iiii))
case 11:return o=a.sent,a.next=14,regeneratorRuntime.awrap(o.getCharacteristic(n.serviceUuids.display4iiiiControlPoint))
case 14:return i=a.sent,a.abrupt("return",i)
case 18:throw new Error("No device gatt?")
case 19:case"end":return a.stop()}}),null,this)}},{key:"findPowermeter",value:function(e){var r
return regeneratorRuntime.async((function(e){for(;;)switch(e.prev=e.next){case 0:return this._checkAvailable(),r={filters:[{services:["cycling_power"]},{services:["fitness_machine","cycling_power"]},{services:[n.serviceUuids.kickrService,"cycling_power"]}]},e.abrupt("return",navigator.bluetooth.requestDevice(r).then((function(e){if(e.gatt)return e.gatt.connect()
throw new Error("No device gatt?")})).then((function(e){return(0,n.deviceUtilsNotifyConnect)(),e.getPrimaryServices().then((function(r){var o=(0,n.getFtms)(r),i=(0,n.getCps)(r),a=(0,n.getKickrService)(r)
if(o)return new t.BluetoothFtmsDevice(e)
if(a)return new t.BluetoothKickrDevice(e)
if(i)return new t.BluetoothCpsDevice(e)
throw new Error("We don't recognize what kind of device this is")}))})))
case 3:case"end":return e.stop()}}),null,this)}},{key:"findHrm",value:function(){var e
return regeneratorRuntime.async((function(t){for(;;)switch(t.prev=t.next){case 0:return this._checkAvailable(),e={filters:[{services:["heart_rate"]}]},t.abrupt("return",navigator.bluetooth.requestDevice(e).then((function(e){if(e.gatt)return e.gatt.connect()
throw new Error("No device gatt?")})).then((function(e){return(0,n.deviceUtilsNotifyConnect)(),e.getPrimaryServices().then((function(t){if((0,n.getHrm)(t))return new d(e)
throw new Error("We don't recognize what kind of device this is")}))})))
case 3:case"end":return t.stop()}}),null,this)}},{key:"_checkAvailable",value:function(){var e
return regeneratorRuntime.async((function(t){for(;;)switch(t.prev=t.next){case 0:if(!window.location.search.includes("fake")&&"localhost"!==window.location.hostname){t.next=2
break}return t.abrupt("return")
case 2:return t.next=4,regeneratorRuntime.awrap(navigator.bluetooth.getAvailability())
case 4:if(t.sent){t.next=9
break}throw e="It looks like your browser/OS combo doesn't support BLE in the browser.\n\nOr your bluetooth is disabled.\n\nTourJS is best enjoyed on a Mac with Chrome or Android phone with Chrome.  If it asks for location services, allow them.  If none of that works, try a paid service like Zwift.",alert(e),e
case 9:case"end":return t.stop()}}))}}]),e}())})),define("bt-web2/pojs/DeviceUtils",["exports"],(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.getFtms=function(e){return e.find((function(e){return e.uuid===t.ftms}))||null},e.getHrm=function(e){return e.find((function(e){return e.uuid===t.hrm}))||null},e.getCps=function(e){return e.find((function(e){return e.uuid===t.cps}))||null},e.getKickrService=function(e){return e.find((function(e){return e.uuid===t.kickrService}))||null},e.monitorCharacteristic=function(e,t,n,r){return e.getPrimaryService(t).then((function(e){return e.getCharacteristic(n)})).then((function(e){return e.startNotifications()})).then((function(t){return t.addEventListener("characteristicvaluechanged",r),e}))},e.deviceUtilsNotifyConnect=function(){r=Promise.resolve(),o=new Map},e.writeToCharacteristic=function(e,t,i,a){return r=r.catch((function(e){console.log("The previous write-queue operation failed and the caller didn't clean it up >:(",e)})).then((function(){if("fitness_machine"===t&&o.has(i)){var r=o.get(i)
if(r)return r.writeValue(a)}return e.getPrimaryService(t).then((function(e){return n(100).then((function(){return e.getCharacteristic(i)}))})).then((function(e){return"fitness_machine"===t&&o.set(i,e),n(100).then((function(){return e.writeValue(a)}))}))}))},e.serviceUuids=void 0
var t={ftms:"00001826-0000-1000-8000-00805f9b34fb",cps:"00001818-0000-1000-8000-00805f9b34fb",kickrService:"a026ee01-0a7d-4ab3-97fa-f1500f9feb8b",display4iiii:"9891eaf5-5456-11eb-ae93-0242ac130002",display4iiiiControlPoint:"2ebe05f1-20f5-ec8e-374e-fc1900003c16",kickrWriteCharacteristic:"a026e005-0a7d-4ab3-97fa-f1500f9feb8b",hrm:"0000180d-0000-1000-8000-00805f9b34fb"}
function n(e){return new Promise((function(t){setTimeout(t,e)}))}e.serviceUuids=t
var r=Promise.resolve(),o=new Map})),define("bt-web2/pojs/WebBluetoothDevice",["exports","bt-web2/pojs/DeviceUtils","bt-web2/server-client-common/Utils"],(function(e,t,n){function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function o(e,t){return!t||"object"!==r(t)&&"function"!=typeof t?i(e):t}function i(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called")
return e}function a(e,t,n){return(a="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=s(e)););return e}(e,t)
if(r){var o=Object.getOwnPropertyDescriptor(r,t)
return o.get?o.get.call(n):o.value}})(e,t,n||e)}function s(e){return(s=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function c(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function")
e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&u(e,t)}function u(e,t){return(u=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function l(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function f(e,t){for(var n=0;n<t.length;n++){var r=t[n]
r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function p(e,t,n){return t&&f(e.prototype,t),n&&f(e,n),e}function d(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var h
Object.defineProperty(e,"__esModule",{value:!0}),e.BluetoothKickrDevice=e.BluetoothCpsDevice=e.BluetoothFtmsDevice=e.BluetoothDeviceShared=e.PowerDataDistributor=e.BTDeviceState=void 0,e.BTDeviceState=h,function(e){e[e.Ok=0]="Ok",e[e.BrieflyGone=1]="BrieflyGone",e[e.ExtendedGone=2]="ExtendedGone",e[e.Disconnected=3]="Disconnected"}(h||(e.BTDeviceState=h={}))
var m=function(){function e(){l(this,e),d(this,"_powerOutput",[]),d(this,"_cadenceOutput",[]),d(this,"_hrmOutput",[]),d(this,"_slopeSource",null),d(this,"_userWantsToKeep",!0),d(this,"_deviceFlags",0)}return p(e,[{key:"getDeviceFlags",value:function(){return this._deviceFlags}},{key:"setDeviceFlags",value:function(e){this._deviceFlags=e}},{key:"disconnect",value:function(){return this._userWantsToKeep=!1,Promise.resolve()}},{key:"userWantsToKeep",value:function(){return this._userWantsToKeep}},{key:"setPowerRecipient",value:function(e){this._powerOutput.push(e)}},{key:"setCadenceRecipient",value:function(e){this._cadenceOutput.push(e)}},{key:"setHrmRecipient",value:function(e){this._hrmOutput.push(e)}},{key:"setSlopeSource",value:function(e){this._slopeSource=e}},{key:"_notifyNewPower",value:function(e,t){this._powerOutput.forEach((function(n){n(e,t)}))}},{key:"_notifyNewCadence",value:function(e,t){this._cadenceOutput.forEach((function(n){n.notifyCadence(e,t)}))}},{key:"_notifyNewHrm",value:function(e,t){this._hrmOutput.forEach((function(n){n.notifyHrm(e,t)}))}}]),e}()
e.PowerDataDistributor=m
var y=function(e){function t(e){var n
return l(this,t),d(i(n=o(this,s(t).call(this))),"_gattDevice",void 0),d(i(n),"_state",void 0),d(i(n),"_startupPromise",Promise.resolve()),n._gattDevice=e,n._state=h.Disconnected,n}return c(t,e),p(t,[{key:"disconnect",value:function(){var e=this
return a(s(t.prototype),"disconnect",this).call(this).then((function(){return e._gattDevice.disconnect(),Promise.resolve()}))}},{key:"getDeviceId",value:function(){return this._gattDevice.device.id}},{key:"getState",value:function(){return this._state}},{key:"name",value:function(){return this._gattDevice.device.name||"Unknown"}}]),t}(m)
e.BluetoothDeviceShared=y
var v=function(e){function n(e){var r
return l(this,n),d(i(r=o(this,s(n).call(this,e))),"_hasSeenCadence",!1),d(i(r),"_tmLastErgUpdate",0),d(i(r),"_tmLastSlopeUpdate",0),r._startupPromise=r._startupPromise.then((function(){return(0,t.monitorCharacteristic)(e,"fitness_machine","indoor_bike_data",(function(e){r._decodeIndoorBikeData(e.target.value)})).then((function(){return(0,t.monitorCharacteristic)(e,"fitness_machine","fitness_machine_status",(function(e){r._decodeFitnessMachineStatus(e.target.value)}))})).then((function(){return(0,t.monitorCharacteristic)(e,"fitness_machine","fitness_machine_control_point",(function(e){r._decodeFtmsControlPoint(e.target.value)}))})).then((function(){var n=new DataView(new ArrayBuffer(1))
return n.setUint8(0,0),(0,t.writeToCharacteristic)(e,"fitness_machine","fitness_machine_control_point",n)}))})),r}return c(n,e),p(n,[{key:"getDeviceTypeDescription",value:function(){return"FTMS Smart Trainer"}},{key:"updateErg",value:function(e,n){var r=this
if(e-this._tmLastErgUpdate<500)return Promise.resolve(!1)
this._tmLastErgUpdate=e,console.log("updating FTMS device with erg "+n.toFixed(0)+"W")
var o=new DataView(new ArrayBuffer(20))
return o.setUint8(0,5),o.setInt16(1,n,!0),(0,t.writeToCharacteristic)(this._gattDevice,"fitness_machine","fitness_machine_control_point",o).then((function(){return console.log("sent FTMS command to "+r._gattDevice.device.name),!0})).catch((function(e){throw e}))}},{key:"updateSlope",value:function(e,n){var r=this
if(e-this._tmLastSlopeUpdate<500)return Promise.resolve(!1)
if(this._tmLastSlopeUpdate=e,!this._slopeSource)return console.log("Not updating FTMS device because no slope source"),Promise.resolve(!1)
var o=this._slopeSource.getLastSlopeInWholePercent()*n
o<0&&(o/=4),console.log("updating FTMS device with slope "+o.toFixed(1)+"%")
var i=new DataView(new ArrayBuffer(7))
return i.setUint8(0,17),i.setInt16(1,0,!0),i.setInt16(3,100*o,!0),i.setUint8(5,33),i.setUint8(6,0),(0,t.writeToCharacteristic)(this._gattDevice,"fitness_machine","fitness_machine_control_point",i).then((function(){return console.log("sent FTMS command to "+r._gattDevice.device.name),!0})).catch((function(e){throw e}))}},{key:"updateResistance",value:function(e,n){var r=this
if(e-this._tmLastSlopeUpdate<500)return Promise.resolve(!1)
this._tmLastSlopeUpdate=e
var o=new DataView(new ArrayBuffer(7))
return o.setUint8(0,4),o.setUint8(1,200*n),(0,t.writeToCharacteristic)(this._gattDevice,"fitness_machine","fitness_machine_control_point",o).then((function(){return console.log("sent FTMS resistance command to "+r._gattDevice.device.name),!0})).catch((function(e){throw e}))}},{key:"hasPower",value:function(){return!0}},{key:"hasCadence",value:function(){return this._hasSeenCadence}},{key:"hasHrm",value:function(){return!1}},{key:"_decodeFtmsControlPoint",value:function(e){if(console.log("decoding ftms control point"),128===e.getUint8(0)&&5===e.getUint8(2)){var n=new DataView(new ArrayBuffer(1))
return n.setUint8(0,0),(0,t.writeToCharacteristic)(this._gattDevice,"fitness_machine","fitness_machine_control_point",n).catch((function(){}))}}},{key:"_decodeIndoorBikeData",value:function(e){var t=(new Date).getTime(),n=e.getUint16(0,!0),r=2
if(!(1&n)){e.getUint16(r,!0)
r+=2}if(2&n&&(r+=2),4&n){var o=e.getUint16(r,!0)
r+=2,this._notifyNewCadence(t,o/2),this._hasSeenCadence=!0}if(8&n&&(r+=2),16&n&&(r+=3),32&n&&(r+=2),64&n){var i=e.getInt16(r,!0)
r+=2,this._notifyNewPower(t,i)}128&n&&(r+=2)}},{key:"_decodeFitnessMachineStatus",value:function(e){}}]),n}(y)
e.BluetoothFtmsDevice=v
var b=function(e){function n(e){var r
return l(this,n),d(i(r=o(this,s(n).call(this,e))),"_hasSeenCadence",!1),r._startupPromise=r._startupPromise.then((function(){return(0,t.monitorCharacteristic)(e,"cycling_power","cycling_power_measurement",(function(e){return r.onPowerMeasurementChanged(e.target.value)}))})),r}return c(n,e),p(n,[{key:"updateSlope",value:function(e,t){return Promise.resolve(!1)}},{key:"updateErg",value:function(e,t){return Promise.resolve(!1)}},{key:"getDeviceTypeDescription",value:function(){return"Bluetooth Powermeter"}}]),p(n,[{key:"onPowerMeasurementChanged",value:function(e){var t=(new Date).getTime(),n=(e.getUint16(0),e.getInt16(2,!0))
console.log("power device sez ",n),this._notifyNewPower(t,n)}},{key:"updateResistance",value:function(e,t){return Promise.resolve(!1)}},{key:"hasPower",value:function(){return!0}},{key:"hasCadence",value:function(){return this._hasSeenCadence}},{key:"hasHrm",value:function(){return!1}}]),n}(y)
e.BluetoothCpsDevice=b
var g=function(e){function r(e){var n
l(this,r),d(i(n=o(this,s(r).call(this,e))),"_downhillValue",16383),d(i(n),"_uphillValue",8192),d(i(n),"_lastSlopeSent",0),d(i(n),"_responsed",!1),d(i(n),"_tmLastSlopeUpdate",0),d(i(n),"_tmLastErgUpdate",0),r._singleton=i(n)
try{var a=parseInt(window.localStorage.getItem("kickr-downhill-number")||"0x3fff"),c=parseInt(window.localStorage.getItem("kickr-uphill-number")||"0x3fff")
isFinite(a)&&isFinite(c)&&a>=0&&a<=16383&&c>=0&&c<=16383&&a>c&&(n._downhillValue=a,n._uphillValue=c,console.log("kickr inited to ",a,c))}catch(u){}return n._startupPromise=n._startupPromise.then((function(){return(0,t.monitorCharacteristic)(e,"cycling_power",t.serviceUuids.kickrWriteCharacteristic,(function(e){return n._handleKickrResponse(e.target.value)}))})).catch((function(e){throw e})),n}return c(r,e),p(r,null,[{key:"getKickrDevice",value:function(){return r._singleton}}]),p(r,[{key:"getDeviceTypeDescription",value:function(){return"Wahoo Kickr"}},{key:"_handleKickrResponse",value:function(e){this._responsed=!0}},{key:"setUphillDownhill",value:function(e,t){this._downhillValue=e,this._uphillValue=t}},{key:"updateSlope",value:function(e,r){if(!this._slopeSource)return Promise.resolve(!1)
if(e-this._tmLastSlopeUpdate<500)return Promise.resolve(!1)
this._tmLastSlopeUpdate=e
var o=new DataView(new ArrayBuffer(3))
o.setUint8(0,64)
var i=this._slopeSource.getLastSlopeInWholePercent()*r
i=Math.min(i,10),i=Math.max(i,-10),i=Math.max(i,this._lastSlopeSent-.5),i=Math.min(i,this._lastSlopeSent+.5),this._lastSlopeSent=i
var a=(i- -10)/20,s=Math.max(0,a)
s=Math.min(1,a)
var c=this._downhillValue,u=this._uphillValue;(0,n.assert2)(s>=0&&s<=1)
var l=s*u+(1-s)*c
l=Math.max(this._uphillValue,l),l=Math.min(this._downhillValue,l)
var f=Buffer.alloc(2)
return f.writeUInt16LE(l,0),console.log("sending ",l,s),o.setUint16(1,f.readUInt16LE(0),!0),(0,t.writeToCharacteristic)(this._gattDevice,"cycling_power",t.serviceUuids.kickrWriteCharacteristic,o).then((function(){return!0})).catch((function(e){throw e}))}},{key:"updateErg",value:function(e,n){if(e-this._tmLastErgUpdate<500)return Promise.resolve(!1)
var r=new DataView(new ArrayBuffer(3))
return r.setUint8(0,66),r.setUint16(1,n,!0),console.log("writing ",r.buffer," to kickr"),(0,t.writeToCharacteristic)(this._gattDevice,"cycling_power",t.serviceUuids.kickrWriteCharacteristic,r)}},{key:"updateResistance",value:function(e,r){if(e-this._tmLastSlopeUpdate<500)return Promise.resolve(!1)
this._tmLastSlopeUpdate=e,console.log("kickr updating slope to ",r)
var o=new DataView(new ArrayBuffer(3))
o.setUint8(0,64)
var i=r,a=Math.max(0,i)
a=Math.min(1,i);(0,n.assert2)(a>=0&&a<=1)
var s=6235*a+24411*(1-a)
return console.log("sending ",s,a),o.setUint8(1,255&s),o.setUint8(2,s>>8&255),(0,t.writeToCharacteristic)(this._gattDevice,"cycling_power",t.serviceUuids.kickrWriteCharacteristic,o).then((function(){return!0})).catch((function(e){throw e}))}},{key:"hasCadence",value:function(){return!1}},{key:"hasHrm",value:function(){return!1}}]),r}(b)
e.BluetoothKickrDevice=g,d(g,"_singleton",null)})),define("bt-web2/race-results/route",["exports","bt-web2/set-up-ride/route"],(function(e,t){function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function r(e,t){for(var n=0;n<t.length;n++){var r=t[n]
r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function o(e,t){return!t||"object"!==n(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called")
return e}(e):t}function i(e){return(i=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function a(e,t){return(a=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
var s=function(e){function n(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,n),o(this,i(n).apply(this,arguments))}var s,c,u
return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function")
e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&a(e,t)}(n,Ember.Route.extend({})),s=n,(c=[{key:"model",value:function(e){return console.log("race-results params: ",e),(0,t.apiGet)("race-results",{key:e.key})}}])&&r(s.prototype,c),u&&r(s,u),n}()
e.default=s})),define("bt-web2/race-results/template",["exports"],(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
var t=Ember.HTMLBars.template({id:"aI9xuFdk",block:'{"symbols":[],"statements":[[1,[28,"display-post-race",null,[["results"],[[24,["model"]]]]],false]],"hasEval":false}',meta:{moduleName:"bt-web2/race-results/template.hbs"}})
e.default=t})),define("bt-web2/resolver",["exports","ember-resolver"],(function(e,t){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
var n=t.default
e.default=n})),define("bt-web2/results/controller",["exports"],(function(e){function t(e){return(t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function n(e,n){return!n||"object"!==t(n)&&"function"!=typeof n?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called")
return e}(e):n}function r(e){return(r=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function o(e,t){return(o=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
var i=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),n(this,r(t).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function")
e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&o(e,t)}(t,Ember.Controller.extend({queryParams:["md5"],md5:""})),t}()
e.default=i})),define("bt-web2/results/route",["exports"],(function(e){function t(e){return(t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function n(e,t){for(var n=0;n<t.length;n++){var r=t[n]
r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function r(e,n){return!n||"object"!==t(n)&&"function"!=typeof n?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called")
return e}(e):n}function o(e){return(o=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function i(e,t){return(i=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
var a=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),r(this,o(t).apply(this,arguments))}var a,s,c
return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function")
e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&i(e,t)}(t,Ember.Route.extend({})),a=t,(s=[{key:"setupController",value:function(e,t){e.set("model",t)}}])&&n(a.prototype,s),c&&n(a,c),t}()
e.default=a})),define("bt-web2/results/template",["exports"],(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
var t=Ember.HTMLBars.template({id:"I/DEeH3y",block:'{"symbols":[],"statements":[[7,"div",true],[10,"class","index__container"],[8],[0,"\\n  "],[1,[22,"tourjs-header"],false],[0,"\\n  "],[1,[28,"stored-data",null,[["override"],[[24,["md5"]]]]],false],[0,"\\n"],[9]],"hasEval":false}',meta:{moduleName:"bt-web2/results/template.hbs"}})
e.default=t})),define("bt-web2/ride/controller",["exports","bt-web2/server-client-common/User","bt-web2/config/environment","bt-web2/server-client-common/communication"],(function(e,t,n,r){var o,i,a,s,c
function u(e){return(u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function l(e,t){for(var n=0;n<t.length;n++){var r=t[n]
r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function f(e){return(f=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function p(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called")
return e}function d(e,t){return(d=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function h(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function m(e,t,n,r,o){var i={}
return Object.keys(r).forEach((function(e){i[e]=r[e]})),i.enumerable=!!i.enumerable,i.configurable=!!i.configurable,("value"in i||i.initializer)&&(i.writable=!0),i=n.slice().reverse().reduce((function(n,r){return r(e,t,n)||n}),i),o&&void 0!==i.initializer&&(i.value=i.initializer?i.initializer.call(o):void 0,i.initializer=void 0),void 0===i.initializer&&(Object.defineProperty(e,t,i),i=null),i}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
var y=(o=Ember.computed("devices.ridersVersion","connection._updateVersion"),i=Ember.computed("devices.ridersVersion","connection._updateVersion"),a=Ember.computed("devices.ridersVersion","connection._updateVersion"),s=Ember.computed("frame"),m((c=function(e){function o(){var e,t;(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,o)
for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i]
return t=function(e,t){return!t||"object"!==u(t)&&"function"!=typeof t?p(e):t}(this,(e=f(o)).call.apply(e,[this].concat(r))),h(p(t),"lastLocalMeters",0),h(p(t),"myTimeout",0),h(p(t),"frame",0),h(p(t),"_raceState",null),h(p(t),"_userSignedIn",!1),t}var i,a,s
return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function")
e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&d(e,t)}(o,e),i=o,(a=[{key:"_setup",value:function(e){var t=this
this.set("_gameId",e)
var r=this.devices.getLocalUser()
if(!r)return this.set("_userSignedIn",!1),Promise.resolve()
this.set("_userSignedIn",!0)
var o=n.default.gameServerHost,i=function(e){return console.log("connected, new race state! ",e),t.set("_raceState",e),t.myTimeout=setTimeout((function(){return t._tick()}),15),t.set("hasSentPwx",!1),t._raceState}
return this.connection.connect(o,e,"TheJoneses",r,i).then(i,(function(e){if(confirm("Failed to connect to ".concat(o,".  Start setup again?")))return t.transitionToRoute("set-up-user")}))}},{key:"_tick",value:function(){var e=this
if(!this.isDestroyed&&!this.isDestroying){var t=(new Date).getTime()
if(this.devices.getUsers(t).length<=0&&confirm("There aren't any users.  Start setup again?"))return this.transitionToRoute("set-up-user")
var n=this.get("_raceState")
if(!n)throw new Error("Failed to find race state")
if(!n.isOldNews()){n.tick(t)
var o=n.getLocalUser()
o&&o.getDistance()>=n.getMap().getLength()&&!this.get("hasSentPwx")&&(this.devices.dumpPwx("Online-Race",t),this.set("hasSentPwx",!0)),this.devices.tick(t,!0)
var i=this.get("connection")
if(i.postRace&&i.raceResults){i.disconnect("")
var a=i.raceResults
setTimeout((function(){window.location.href="/race-results/".concat(r.S2CFinishUpdate.getPermanentKey(a))}),1e3)}else this.myTimeout=setTimeout((function(){return e._tick()}),15),this.incrementProperty("frame")}}}},{key:"localRidersPreRace",get:function(){var e=this
if(!this._raceState)return[]
var n=(new Date).getTime()
return this.devices.getUsers(n).filter((function(e){return e.getUserType()&t.UserTypeFlags.Local})).map((function(t){return t.getDisplay(e._raceState)}))}},{key:"nonLocalHumans",get:function(){var e=this
if(!this._raceState)return[]
var n=(new Date).getTime()
return this.devices.getUsers(n).filter((function(e){return!(e.getUserType()&t.UserTypeFlags.Local||e.getUserType()&t.UserTypeFlags.Ai)})).map((function(t){return t.getDisplay(e._raceState)}))}},{key:"ais",get:function(){var e=this
if(!this._raceState)return[]
var n=(new Date).getTime()
return this.devices.getUsers(n).filter((function(e){return!(e.getUserType()&t.UserTypeFlags.Local)&&e.getUserType()&t.UserTypeFlags.Ai})).map((function(t){return t.getDisplay(e._raceState)}))}},{key:"remoteRiders",get:function(){var e=this
if(!this._raceState)return[]
var n=(new Date).getTime()
return this.devices.getUsers(n).filter((function(e){return e.getUserType()&t.UserTypeFlags.Remote})).map((function(t){return t.getDisplay(e._raceState)}))}}])&&l(i.prototype,a),s&&l(i,s),o}(Ember.Controller.extend({devices:Ember.inject.service(),connection:Ember.inject.service(),_raceState:null,hasSentPwx:!1,_gameId:"",actions:{doneAddingUser:function(e){console.log("done adding user",e," with md5 ",e.bigImageMd5),this.devices.addUser(e),this._setup(this.get("_gameId"))}},watchForRaceCompletion:Ember.observer("connection.postRace",(function(){}))}))).prototype,"localRidersPreRace",[o],Object.getOwnPropertyDescriptor(c.prototype,"localRidersPreRace"),c.prototype),m(c.prototype,"nonLocalHumans",[i],Object.getOwnPropertyDescriptor(c.prototype,"nonLocalHumans"),c.prototype),m(c.prototype,"ais",[a],Object.getOwnPropertyDescriptor(c.prototype,"ais"),c.prototype),m(c.prototype,"remoteRiders",[s],Object.getOwnPropertyDescriptor(c.prototype,"remoteRiders"),c.prototype),c)
e.default=y})),define("bt-web2/ride/route",["exports"],(function(e){function t(e){return(t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function n(e,t){for(var n=0;n<t.length;n++){var r=t[n]
r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function r(e,n){return!n||"object"!==t(n)&&"function"!=typeof n?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called")
return e}(e):n}function o(e){return(o=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function i(e,t){return(i=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
var a=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),r(this,o(t).apply(this,arguments))}var a,s,c
return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function")
e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&i(e,t)}(t,Ember.Route.extend({})),a=t,(s=[{key:"setupController",value:function(e,t){e._setup(t.gameId)}}])&&n(a.prototype,s),c&&n(a,c),t}()
e.default=a})),define("bt-web2/ride/template",["exports"],(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
var t=Ember.HTMLBars.template({id:"MJPKyvXo",block:'{"symbols":[],"statements":[[4,"if",[[24,["connection","preRace"]]],null,{"statements":[[0,"  "],[1,[28,"display-pre-race",null,[["frame","localRiders","nonLocalHumans","ais"],[[24,["frame"]],[24,["localRidersPreRace"]],[24,["nonLocalHumans"]],[24,["ais"]]]]],false],[0,"\\n"]],"parameters":[]},{"statements":[[4,"if",[[24,["connection","racing"]]],null,{"statements":[[4,"if",[[24,["_raceState"]]],null,{"statements":[[0,"    "],[1,[28,"display-race",null,[["raceState","overlay"],[[24,["_raceState"]],"leader-board"]]],false],[0,"\\n"]],"parameters":[]},{"statements":[[0,"    Connecting...\\n"]],"parameters":[]}]],"parameters":[]},null]],"parameters":[]}],[0,"\\n"],[4,"unless",[[24,["_userSignedIn"]]],null,{"statements":[[0,"  "],[7,"div",true],[10,"class","new-user__container"],[8],[0,"\\n    "],[1,[28,"user-set-up-widget",null,[["onDone"],[[28,"action",[[23,0,[]],"doneAddingUser"],null]]]],false],[0,"\\n  "],[9],[0,"\\n"]],"parameters":[]},null]],"hasEval":false}',meta:{moduleName:"bt-web2/ride/template.hbs"}})
e.default=t})),define("bt-web2/router",["exports","bt-web2/config/environment","bt-web2/pojs/WebBluetoothDevice"],(function(e,t,n){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
var r=Ember.Router.extend({location:t.default.locationType,rootURL:t.default.rootURL,connection:Ember.inject.service(),devices:Ember.inject.service(),init:function(){var e=this
this._super.apply(this,arguments),this.on("routeDidChange",(function(t){if(console.log("transition = ",t),t.from)switch(t.from.name){case"pacing-challenge-race":e.get("devices").dumpPwx("pacing-challenge-abandoned")
break
case"ride":console.log("they jumped away from the ride screen.  We probably need to disconnect"),console.log("connections = ",e.get("connection")),e.get("connection").disconnect("Quit-".concat(t.from.name))
break
case"kickr-setup":console.log("they've exited kickr-setup")
var r=n.BluetoothKickrDevice.getKickrDevice()
r&&(e.get("devices").setLocalUserDevice(r,7),console.log("reset their use of the kickr"))}}))}})
r.map((function(){this.route("set-up-user"),this.route("set-up-ride"),this.route("ride",{path:"/ride/:gameId"}),this.route("set-up-join"),this.route("test-hacks"),this.route("strava-auth"),this.route("hrm-control"),this.route("pacing-challenge"),this.route("pacing-challenge-race",{path:"/pacing-challenge-race/:pct"}),this.route("results"),this.route("kickr-setup"),this.route("race-results",{path:"/race-results/:key"}),this.route("ai")}))
var o=r
e.default=o})),define("bt-web2/serializers/wordpress/attachment",["exports","ember-wordpress/serializers/wordpress"],(function(e,t){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
var n=t.default.extend({})
e.default=n})),define("bt-web2/serializers/wordpress/category",["exports","ember-wordpress/serializers/wordpress"],(function(e,t){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
var n=t.default.extend({})
e.default=n})),define("bt-web2/serializers/wordpress/comment",["exports","ember-wordpress/serializers/wordpress"],(function(e,t){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
var n=t.default.extend({})
e.default=n})),define("bt-web2/serializers/wordpress/page",["exports","ember-wordpress/serializers/wordpress"],(function(e,t){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
var n=t.default.extend({})
e.default=n})),define("bt-web2/serializers/wordpress/post",["exports","ember-wordpress/serializers/wordpress"],(function(e,t){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
var n=t.default.extend({})
e.default=n}))
define("bt-web2/serializers/wordpress/tag",["exports","ember-wordpress/serializers/wordpress"],(function(e,t){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
var n=t.default.extend({})
e.default=n})),define("bt-web2/serializers/wordpress/user",["exports","ember-wordpress/serializers/wordpress"],(function(e,t){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
var n=t.default.extend({})
e.default=n})),define("bt-web2/server-client-common/DecorationFactory",["exports","bt-web2/server-client-common/DecorationItems","bt-web2/config/environment"],(function(e,t,n){function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function o(e,t){for(var n=0;n<t.length;n++){var r=t[n]
r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function i(e,t,n){return t&&o(e.prototype,t),n&&o(e,n),e}function a(e){return(a=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function s(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called")
return e}function c(e,t){return(c=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function u(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function l(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var f
Object.defineProperty(e,"__esModule",{value:!0}),e.randRange=d,e.DecorationFactory=e.LoadedDecoration=e.ConfiggedDecoration=e.Layer=void 0,e.Layer=f,function(e){e.FarScenery="FarScenery",e.NearSky="NearSky",e.NearRoadside="NearRoadside",e.Underground="Underground"}(f||(e.Layer=f={}))
var p=function e(t){u(this,e),l(this,"minDimensions",void 0),l(this,"maxDimensions",void 0),l(this,"minAltitude",void 0),l(this,"maxAltitude",void 0),l(this,"imageUrl",void 0),l(this,"layer",void 0),l(this,"frequencyPerKm",void 0),l(this,"name",void 0),l(this,"minSpeed",void 0),l(this,"maxSpeed",void 0),this.minDimensions=t.minDimensions,this.maxDimensions=t.maxDimensions,this.minSpeed=t.minSpeed,this.maxSpeed=t.maxSpeed,this.minAltitude=t.minAltitude,this.maxAltitude=t.maxAltitude,this.imageUrl=t.imageUrl,this.layer=t.layer,this.frequencyPerKm=t.frequencyPerKm,this.name=t.name}
function d(e,t){return Math.random()*(t-e)+e}e.ConfiggedDecoration=p
var h=function(e){function n(e,t){var o
return u(this,n),o=function(e,t){return!t||"object"!==r(t)&&"function"!=typeof t?s(e):t}(this,a(n).call(this,e)),l(s(o),"_img",null),o._img=t,o}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function")
e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&c(e,t)}(n,e),i(n,[{key:"generateDecoration",value:function(e,n){if(!this._img)return null
var r={x:d(this.minDimensions.x,this.maxDimensions.x),y:d(this.minDimensions.y,this.maxDimensions.y)},o=d(this.minAltitude,this.maxAltitude),i=e+r.x/2,a=n.getElevationAtDistance(i-r.x/2),s=n.getElevationAtDistance(i+r.x/2),c={x:i,y:o+Math.min(a,s)},u=Math.floor(Math.random()*this._img.length*10%this._img.length),l=this._img[u]
if(this.minSpeed&&this.maxSpeed){var f={x:d(this.minSpeed.x,this.maxSpeed.x),y:d(this.minSpeed.y,this.maxSpeed.y)}
return new t.MovingDecoration(c,f,r,l)}return new t.DecorationBase(c,r,l)}}]),n}(p)
e.LoadedDecoration=h
var m=function(){function e(t){var r=this
u(this,e),l(this,"_availableDecorations",void 0),this._availableDecorations=[],t.decorationSpecs.forEach((function(e){var t=e.imageUrl.length,o=0,i=[]
e.imageUrl.forEach((function(a){var s=document.createElement("img")
s.onload=function(){i.push(function(e){var t=document.createElement("canvas")
t.width=e.width,t.height=e.height
var n=t.getContext("2d")
n&&(n.save(),n.translate(e.width/2,e.height/2),n.rotate(Math.PI),n.drawImage(e,-e.width/2,-e.height/2),n.restore())
var r=document.createElement("img")
return r.src=t.toDataURL(),r}(s)),++o===t&&r._availableDecorations.push(new h(e,i))},s.src=n.default.rootURL+a}))}))}return i(e,[{key:"generateNewDecorations",value:function(e,t,n,r,o){var i=t*n,a=[]
return this._availableDecorations.forEach((function(t){if(t.layer===e){var n=1e3/t.frequencyPerKm/2,s=1-Math.pow(.5,i/n)
if(Math.random()<s){var c=t.generateDecoration(r,o)
c&&a.push(c)}}})),a}}]),e}()
e.DecorationFactory=m})),define("bt-web2/server-client-common/DecorationItems",["exports"],(function(e){function t(e){return(t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function n(e){return(n=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function r(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called")
return e}function o(e,t){return(o=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){for(var n=0;n<t.length;n++){var r=t[n]
r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function s(e,t,n){return t&&a(e.prototype,t),n&&a(e,n),e}function c(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}Object.defineProperty(e,"__esModule",{value:!0}),e.MovingDecoration=e.DecorationBase=void 0
var u=function(){function e(t,n,r){i(this,e),c(this,"position",void 0),c(this,"dimensions",void 0),c(this,"myImg",void 0),this.position=t,this.dimensions=n,this.myImg=r}return s(e,[{key:"tick",value:function(e){}},{key:"isOnScreen",value:function(e){return this.position.x+this.dimensions.x/2>=e}},{key:"draw",value:function(e){e.drawImage(this.myImg,this.position.x-this.dimensions.x/2,this.position.y-this.dimensions.y/2,this.dimensions.x,this.dimensions.y)}}]),e}()
e.DecorationBase=u
var l=function(e){function a(e,o,s,u){var l
return i(this,a),l=function(e,n){return!n||"object"!==t(n)&&"function"!=typeof n?r(e):n}(this,n(a).call(this,e,s,u)),c(r(l),"speed",void 0),l.speed=o,l}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function")
e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&o(e,t)}(a,e),s(a,[{key:"tick",value:function(e){this.position.x+=this.speed.x*e,this.position.y+=this.speed.y*e}}]),a}(u)
e.MovingDecoration=l})),define("bt-web2/server-client-common/DecorationState",["exports","bt-web2/server-client-common/DecorationFactory"],(function(e,t){function n(e){return function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t]
return n}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function r(e,t){for(var n=0;n<t.length;n++){var r=t[n]
r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}Object.defineProperty(e,"__esModule",{value:!0}),e.DecorationState=void 0
var i=function(){function e(n,r){var i=this;(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,e),o(this,"_decorations",void 0),o(this,"_factory",void 0),o(this,"_map",void 0),o(this,"_lastRight",0),o(this,"_images",{}),this._decorations=new Map,Object.keys(t.Layer).forEach((function(e){i._decorations.set(e,[])})),this._factory=r,this._map=n
var a={heart:"/assets/heart-bfcc4ae7b0c81630445aaa622b23bc49.png"},s=function(){var e=document.createElement("img")
e.onload=function(){i._images[c]=e},e.onerror=function(){},e.src=a[c]}
for(var c in a)s()}var i,a,s
return i=e,(a=[{key:"getImage",value:function(e){return this._images[e]?this._images[e]:null}},{key:"tick",value:function(e,r,o){var i=this
if(this._decorations.forEach((function(t){t.forEach((function(t){t.tick(e)}))})),this._decorations.forEach((function(e,t){i._decorations.set(t,e.filter((function(e){return e.isOnScreen(r)})))})),this._lastRight&&o>this._lastRight){var a=(o-this._lastRight)/e
for(var s in t.Layer){var c=this._decorations.get(s)
c&&c.push.apply(c,n(this._factory.generateNewDecorations(s,e,a,o,this._map)))}}this._lastRight=o}},{key:"draw",value:function(e,t){var n=this._decorations.get(t)
n&&n.forEach((function(t){t.draw(e)}))}}])&&r(i.prototype,a),s&&r(i,s),e}()
e.DecorationState=i})),define("bt-web2/server-client-common/FileSaving",["exports"],(function(e){function t(e,t){for(var n=0;n<t.length;n++){var r=t[n]
r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}Object.defineProperty(e,"__esModule",{value:!0}),e.samplesToPWX=function(e,t){var n=[]
n.push('<?xml version="1.0"?>'),n.push('<pwx xmlns="http://www.peaksware.com/PWX/1/0" creator="Golden Cheetah" xsi:schemaLocation="http://www.peaksware.com/PWX/1/0 http://www.peaksware.com/PWX/1/0/pwx.xsd" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" version="1.0" xmlns:xsd="http://www.w3.org/2001/XMLSchema">'),n.push("<workout>"),n.push("<athlete><name>".concat(t.riderName,"</name></athlete>")),n.push("<sportType>Bike</sportType>"),n.push('<device id="TourJS">\n                <make>Tour.JS</make>\n                <model>'.concat(t.deviceName,"</model>\n              </device>"))
var r=t.samples,o=r[0],i=Math.floor((r[r.length-1].tm-r[0].tm)/1e3),a=r[r.length-1].distance-r[0].distance,s=new Date(o.tm).toISOString().replace("Z","")
n.push("<time>".concat(s,"</time>\n              <summarydata>\n                  <beginning>0</beginning>\n                  <duration>").concat(i,"</duration>\n                  <dist>").concat(a,"</dist>\n              </summarydata>"))
var c=o
return r.forEach((function(e){if(e.distance>=c.distance){var t=(e.tm-o.tm)/1e3,r=""
e.hrm>0&&(r="<hr>".concat(e.hrm.toFixed(0),"</hr>")),n.push("<sample>\n                      <timeoffset>".concat(t.toFixed(0),"</timeoffset>\n                      ").concat(r,"\n                      <spd>").concat(e.speedMetersPerSec.toFixed(3),"</spd>\n                      <pwr>").concat(e.power.toFixed(0),"</pwr>\n                      <dist>").concat(e.distance.toFixed(0),"</dist>\n                  </sample>")),c=e}})),n.push("</workout>"),n.push("</pwx>"),n.join("\n")},e.WorkoutFileSaver=void 0
var o=function e(t,o){n(this,e),r(this,"power",void 0),r(this,"tm",void 0),r(this,"distance",void 0),r(this,"speedMetersPerSec",void 0),r(this,"hrm",void 0),this.tm=t,this.power=o.getLastPower(),this.distance=o.getDistance(),this.speedMetersPerSec=o.getSpeed(),this.hrm=o.getLastHrm(t)},i=function(){function e(t,o){n(this,e),r(this,"_user",void 0),r(this,"_tmLastSample",void 0),r(this,"_samples",void 0),console.log("built a new workout saver for ",t.getName()),this._user=t,this._tmLastSample=0,this._samples=[],this.tick(o),this._tmLastSample=o}var i,a,s
return i=e,(a=[{key:"tick",value:function(e){e-this._tmLastSample>=1e3&&(this._samples.push(new o(e,this._user)),this._tmLastSample=e)}},{key:"getWorkout",value:function(){return this._samples}}])&&t(i.prototype,a),s&&t(i,s),e}()
e.WorkoutFileSaver=i})),define("bt-web2/server-client-common/PluginCommunication",["exports"],(function(e){function t(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(e,t){for(var n=0;n<t.length;n++){var r=t[n]
r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function r(e,t,r){return t&&n(e.prototype,t),r&&n(e,r),e}function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var i
Object.defineProperty(e,"__esModule",{value:!0}),e.PluginToBrowserUpdate=e.PluginMode=e.PluginDescriptor=e.PluginType=void 0,e.PluginType=i,function(e){e[e.Fake=0]="Fake",e[e.USBWaterRower=1]="USBWaterRower",e[e.AntPlusFEC=2]="AntPlusFEC",e[e.AntPlusPM=3]="AntPlusPM",e[e.USBComputrainer=4]="USBComputrainer"}(i||(e.PluginType=i={}))
var a,s=function(){function e(n,r,i){t(this,e),o(this,"pluginId",void 0),o(this,"humanName",void 0),o(this,"pluginType",void 0),o(this,"supportsSmartTrainer",void 0),this.pluginId=""+1e6*Math.random(),this.humanName=n,this.pluginType=r,this.supportsSmartTrainer=i}return r(e,null,[{key:"validate",value:function(e){return e.pluginId&&e.humanName&&isFinite(e.pluginType)}}]),e}()
e.PluginDescriptor=s,e.PluginMode=a,function(e){e[e.Erg=0]="Erg",e[e.Slope=1]="Slope",e[e.Resistance=2]="Resistance"}(a||(e.PluginMode=a={}))
var c=function(){function e(n,r,i){t(this,e),o(this,"pluginId",void 0),o(this,"tmUpdate",void 0),o(this,"lastPower",void 0),this.pluginId=n,this.tmUpdate=r,this.lastPower=i}return r(e,null,[{key:"validate",value:function(e){return e.pluginId&&isFinite(e.tmUpdate)&&isFinite(e.lastPower)}}]),e}()
e.PluginToBrowserUpdate=c})),define("bt-web2/server-client-common/RaceState",["exports","bt-web2/server-client-common/User","bt-web2/server-client-common/Utils"],(function(e,t,n){function r(e,t){for(var n=0;n<t.length;n++){var r=t[n]
r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}Object.defineProperty(e,"__esModule",{value:!0}),e.getAIStrengthBoostForDistance=function(e){var t=e/4e4
return.89*Math.pow(t,-.155831)},e.RaceState=void 0
var i=function(){function e(t,n,r){(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,e),o(this,"_map",void 0),o(this,"_userProvider",void 0),o(this,"_gameId",void 0),o(this,"_tmUnfinishedHuman",0),o(this,"_stopped",!1),this._map=t,this._userProvider=n,this._gameId=r,this._tmUnfinishedHuman=(new Date).getTime(),e._mainRaceState=this}var i,a,s
return i=e,(a=[{key:"isOldNews",value:function(){return this!==e._mainRaceState}},{key:"stop",value:function(){this._stopped=!0}},{key:"tick",value:function(n){var r=this
if(!this._stopped&&("undefined"==typeof window||e._mainRaceState===this)){var o=this._userProvider.getUsers(n)
o.forEach((function(e){e.physicsTick(n,r._map,o),e.getUserType()&t.UserTypeFlags.Ai||e.isFinished()||(r._tmUnfinishedHuman=n)}))}}},{key:"getSecondsSinceLastNonFinishedHuman",value:function(e){return Math.max(0,(e-this._tmUnfinishedHuman)/1e3)}},{key:"getGameId",value:function(){return this._gameId}},{key:"getMap",value:function(){return this._map}},{key:"getLocalUser",value:function(){var e=(new Date).getTime(),r=this._userProvider.getUsers(e).filter((function(e){return e.getUserType()&t.UserTypeFlags.Local}))
return(0,n.assert2)(1===r.length),r[0]}},{key:"isAllHumansFinished",value:function(e){var n=this
return this._userProvider.getUsers(e).filter((function(e){return!(e.getUserType()&t.UserTypeFlags.Ai)})).every((function(e){return e.getDistance()>=n._map.getLength()}))}},{key:"isAllRacersFinished",value:function(e){var t=this
return this._userProvider.getUsers(e).every((function(e){return e.getDistance()>=t._map.getLength()}))}},{key:"isAnyHumansFinished",value:function(e){var n=this
return!!this._userProvider.getUsers(e).filter((function(e){return!(e.getUserType()&t.UserTypeFlags.Ai)})).find((function(e){return e.getDistance()>=n._map.getLength()}))}},{key:"absorbPositionUpdate",value:function(e,t){var n=this
t.clients.forEach((function(t){var r=n._userProvider.getUser(t.id)
r&&r.absorbPositionUpdate(e,t)}))}},{key:"absorbNameUpdate",value:function(e,t){var n=this
t.ids.forEach((function(r,o){var i=n._userProvider.getUser(r)
i&&i.absorbNameUpdate(e,t.names[o],t.userTypes[o],t.userHandicaps[o])}))}},{key:"getUserProvider",value:function(){return this._userProvider}}])&&r(i.prototype,a),s&&r(i,s),e}()
e.RaceState=i,o(i,"_mainRaceState",null)})),define("bt-web2/server-client-common/RideMap",["exports"],(function(e){function t(e){return(t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function n(e,n){return!n||"object"!==t(n)&&"function"!=typeof n?o(e):n}function r(e){return(r=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function o(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called")
return e}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function")
e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&a(e,t)}function a(e,t){return(a=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function s(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function c(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function u(e,t){for(var n=0;n<t.length;n++){var r=t[n]
r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function l(e,t,n){return t&&u(e.prototype,t),n&&u(e,n),e}Object.defineProperty(e,"__esModule",{value:!0}),e.PureCosineMap=e.IntoAHillMap=e.RideMapPartial=void 0
var f=function(){function e(){c(this,e)}return l(e,[{key:"getSlopeAtDistance",value:function(e){return(this.getElevationAtDistance(e+1)-this.getElevationAtDistance(e-1))/2}}]),e}()
e.RideMapPartial=f
var p=function(e){function t(e){var i
return c(this,t),s(o(i=n(this,r(t).call(this))),"_length",void 0),i._length=e,i}return i(t,e),l(t,[{key:"getElevationAtDistance",value:function(e){return e<50?Math.pow(e,2)/2e3:.05*(e-50)+1.25}},{key:"getLength",value:function(){return this._length}}]),t}(f)
e.IntoAHillMap=p
var d=function(e){function t(e){var i
return c(this,t),s(o(i=n(this,r(t).call(this))),"_length",void 0),i._length=e,i}return i(t,e),l(t,[{key:"getElevationAtDistance",value:function(e){return 25*Math.sin(e/1e3)+4*Math.cos(e/97)}},{key:"getLength",value:function(){return this._length}}]),t}(f)
e.PureCosineMap=d})),define("bt-web2/server-client-common/RideMapHandicap",["exports","bt-web2/server-client-common/RideMap","bt-web2/server-client-common/User","bt-web2/server-client-common/Utils"],(function(e,t,n,r){function o(e){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function i(e,t){for(var n=0;n<t.length;n++){var r=t[n]
r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function a(e){return(a=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function s(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called")
return e}function c(e,t){return(c=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function u(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}Object.defineProperty(e,"__esModule",{value:!0}),e.RideMapHandicap=void 0
var l=function(e){function t(e){var n
if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),n=function(e,t){return!t||"object"!==o(t)&&"function"!=typeof t?s(e):t}(this,a(t).call(this)),u(s(n),"_length",void 0),u(s(n),"_mapDesc",void 0),u(s(n),"minDist",void 0),u(s(n),"maxDist",void 0),u(s(n),"minElev",void 0),u(s(n),"maxElev",void 0),e.elevations.length<=0||e.distances.length<=0)throw new Error("Map description is bogus")
return n._length=e.distances[e.distances.length-1],n._mapDesc=e,n.minDist=e.distances[0],n.maxDist=n._length,n.minElev=e.elevations[0],n.maxElev=e.elevations[0],e.elevations.forEach((function(e){n.minElev=Math.min(e,n.minElev),n.maxElev=Math.max(e,n.maxElev)})),n}var l,f,p
return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function")
e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&c(e,t)}(t,e),l=t,(f=[{key:"_indexBelowMeters",value:function(e){if(e<=this._mapDesc.distances[0])return 0
if(e>=this._mapDesc.distances[this._mapDesc.distances.length-1])return this._mapDesc.distances.length-1
for(var t=0,n=this._mapDesc.distances.length-1;;){var r=Math.floor((t+n)/2),o=this._mapDesc.distances[r]
if(o>=e)n=r
else if(o<e){if(r>=n-1)return r
t=r}}}},{key:"getElevationAtDistance",value:function(e){if(e>=this.getLength())return this._mapDesc.elevations[this._mapDesc.elevations.length-1]
if(e<=0)return this._mapDesc.elevations[0]
var t=this._indexBelowMeters(e),n=t+1,o=this._mapDesc.distances[t],i=this._mapDesc.distances[n];(0,r.assert2)(i>o)
var a=(e-o)/(i-o);(0,r.assert2)(a>=0&&a<=1)
var s=this._mapDesc.elevations[t]
return a*this._mapDesc.elevations[n]+(1-a)*s}},{key:"getPowerTransform",value:function(e){return function(t){return n.DEFAULT_HANDICAP_POWER*(t/e.getHandicap())}}},{key:"getLength",value:function(){return this._length}},{key:"getBounds",value:function(){return{minElev:this.minElev,maxElev:this.maxElev,minDist:this.minDist,maxDist:this.maxDist}}}])&&i(l.prototype,f),p&&i(l,p),t}(t.RideMapPartial)
e.RideMapHandicap=l})),define("bt-web2/server-client-common/ServerAISnapshots",["exports","bt-web2/server-client-common/RaceState","bt-web2/server-client-common/User","bt-web2/server-client-common/Utils"],(function(e,t,n,r){function o(e){return function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t]
return n}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function i(e,t){var n=Object.keys(e)
if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e)
t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e,t){for(var n=0;n<t.length;n++){var r=t[n]
r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function c(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function u(e,t){var n=t-e
return Math.floor(Math.random()*n+e)}function l(e,t,n){var r=e.sequential()
return r.add(e.layers.dense({inputShape:[t],units:t})),r.add(e.layers.gaussianNoise({stddev:.05})),r.add(e.layers.dense({units:u(25,75),activation:"sigmoid"})),r.add(e.layers.gaussianNoise({stddev:.05})),r.add(e.layers.dense({units:u(25,75),activation:"sigmoid"})),r.add(e.layers.dense({units:n})),r}Object.defineProperty(e,"__esModule",{value:!0}),e.buildModel=l,e.predictFromRawTrainingData=function(e,t,n,o){var i=new h(o,n.killCols)._myData.map((function(e){return e.data}));(0,r.assert2)(i.length===n.inputSpans.length,"Our prepped data had ".concat(i.length," but our trained model expected ").concat(n.inputSpans.length))
var a=P(k(e,[i]),n.inputMin,n.inputMax),s=S(t.predict(a),n.labelMin,n.labelMax).dataSync()[0]
return s=Math.max(0,s)},e.takeTrainingSnapshot=function(e,t,i){var a,s={tm:(new Date).getTime(),version:"2"},c=i.getMap()
if(t.getDistance()>=c.getLength()||t.isFinished())return null
if(i.isAllRacersFinished(e))return null
if(t.isFinished())return null
if(t.getDistance()<=50)return null
var u=t.getDistance()
s.speed=t.getSpeed(),s.currentSlope=t.getLastSlopeInWholePercent(),s.ftpSecondsSavedPerKm=t.getHandicapSecondsSaved()/u,s.ftpSecondsSpentPerKm=[]
var l=t.getHandicapSecondsUsed()
for(var f in l)s.ftpSecondsSpentPerKm.push(l[f]/u)
s.currentDraftPct=t.getLastWattsSaved().pctOfMax,s.currentDrafteeCount=t.getDrafteeCount(e)
var p=t.getDrafteeIds(e).map((function(e){return i.getUserProvider().getUser(e)})).filter((function(e){return e})).sort((function(e,t){return e.getDistance()>t.getDistance()?-1:1}))
s.closestDrafteeFtpSecondsSavedPerKm=(p&&p.length>0&&(null===(a=p[0])||void 0===a?void 0:a.getHandicapSecondsSaved())||0)/u,s.distanceToFinish=c.getLength()-t.getDistance(),s.distanceInRace=t.getDistance(),s.pctOfRaceComplete=t.getDistance()/c.getLength()
var d=y(t.getDistance(),c,1),h=y(t.getDistance(),c,-1)
s.metersLeftToClimb=m(t.getDistance(),c,1),s.metersLeftToClimbCurrentUphill=d.vertToGo,s.metersLeftToDescend=m(t.getDistance(),c,-1),s.metersLeftToDescentCurrentDownhill=h.vertToGo,s.avgSlopeCurrentUphill=d.vertToGo/d.horzToGo||0,s.avgSlopeCurrentDownhill=h.vertToGo/h.horzToGo||0,s.last30SecPctFtp=t.getPowerAverageForLastNSeconds(e,30)/t.getHandicap(),s.last5MinPctFtp=t.getPowerAverageForLastNSeconds(e,300)/t.getHandicap()
var v=i.getUserProvider().getUsers(e)
v.sort((function(e,t){return e.getDistance()<t.getDistance()?-1:1}))
var b=v.findIndex((function(e){return e===t}))
if((0,r.assert2)(b>=0),b>=0&&b<v.length-1){var g=v[b+1]
g?(s.gapToGroupAhead=g.getSecondsAgoToCross(e,t.getDistance())||0,s.closeRateGroupAhead=t.getSpeed()-g.getSpeed()):(s.gapToGroupAhead=0,s.closeRateGroupAhead=0,(0,r.assert2)(!1))
var _=v.slice(b+1).find((function(e){return!(e.getUserType()&n.UserTypeFlags.Ai)}))
_?(s.gapToHumanAhead=_.getSecondsAgoToCross(e,t.getDistance())||0,s.closeRateHumanAhead=t.getSpeed()-_.getSpeed()):(s.gapToHumanAhead=0,s.closeRateHumanAhead=0)}else s.gapToGroupAhead=0,s.gapToHumanAhead=0,s.closeRateGroupAhead=0,s.closeRateHumanAhead=0
if(b>=1){var w=v[b-1]
w?(s.gapToGroupBehind=t.getSecondsAgoToCross(e,w.getDistance())||0,s.closeRateGroupBehind=t.getSpeed()-w.getSpeed()):(s.gapToGroupBehind=0,s.closeRateGroupBehind=0,(0,r.assert2)(!1))
var S=v.slice(0,b-1).find((function(e){return!(e.getUserType()&n.UserTypeFlags.Ai)}))
S?(s.gapToHumanBehind=t.getSecondsAgoToCross(e,S.getDistance())||0,s.closeRateHumanBehind=S.getSpeed()-t.getSpeed()):(s.gapToHumanBehind=0,s.closeRateHumanBehind=0)}else s.gapToGroupBehind=0,s.gapToHumanBehind=0,s.closeRateGroupBehind=0,s.closeRateHumanBehind=0
var P=function(e,t){var n=[],r=t[e].getDistance(),o=0
r=t[e].getDistance()
for(var i=e+1;i<t.length;i++){var a=t[i],s=a.getDistance()
if(!(Math.abs(s-r)<10)){o=t.length-i-1
break}n.push(a),r=s}var c=n.length
n.push(t[e]),r=t[e].getDistance()
for(var u=e-1;u>=0;u--){var l=t[u],f=l.getDistance()
if(!(Math.abs(f-r)<10))break
n.push(l),r=f}return n.sort((function(e,t){return e.getDistance()<t.getDistance()?-1:1})),{group:n,ixYou:c,ridersAheadOfGroup:o}}(b,v)
return s.biggestLeechInGroupFtpSecondsSavedPerKm=Math.max.apply(Math,[0].concat(o(P.group.filter((function(e){return e.getId()!==t.getId()})).map((function(e){return e.getHandicapSecondsSaved()/u}))))),s.groupSize=P.group.length,s.rankInGroup=P.ixYou,s.ridersAheadOfGroup=P.ridersAheadOfGroup,s.powerNextSecond=-1,s},e.trainingSnapshotToAILabel=v,e.trainingSnapshotToAIInput=b,e.brainPath=function(e,t){switch(t){case d.Deployed:return"./deploy-brains/".concat(e)
default:case d.ForTraining:return"./brains/".concat(e)}},e.removeBoringColumns=g,e.testModel=_,e.unnormalizeData=S,e.normalizeData=P,e.makeTensor=k,e.doNNTrainWithSnapshots=function(e,t,n,r,i,a){var s,c,u,p,d,h,m,y,S,E,T,j,D,x,M,U,R,A,C,L,I,F,H,N,B,W,z,K,G
return regeneratorRuntime.async((function(q){for(;;)switch(q.prev=q.next){case 0:s=n.map((function(e){return b(e,[])})),c=n.map(v),u=w([s,c]),J=2,p=function(e){if(Array.isArray(e))return e}(V=u)||function(e,t){if(!(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e)))return
var n=[],r=!0,o=!1,i=void 0
try{for(var a,s=e[Symbol.iterator]();!(r=(a=s.next()).done)&&(n.push(a.value),!t||n.length!==t);r=!0);}catch(c){o=!0,i=c}finally{try{r||null==s.return||s.return()}finally{if(o)throw i}}return n}(V,J)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}(),s=p[0],c=p[1],d=g(s),h=d.killCols,m=d.allInputDatasAsNumbers,y=l(e,m[0].length,1),S=k(e,m),E=k(e,c),T=Math.floor(.75*n.length),j=n.length-T,D=S.slice(0,T),x=E.slice(0,T),M=S.slice(T,j),U=E.slice(T,j),R=new f(S,E,[]),A=P(D,R.inputMin,R.inputMax),C=P(x,R.labelMin,R.labelMax),y.compile({optimizer:e.train.adam(),loss:e.losses.meanSquaredError,metrics:["mse"]}),L=x.size,300,I=-1e3,F=-1e3,H=-1e3,N=0,B=0,W=0,z=40,0,K=function(){var n,c,u,f,p,d,v,b,g,w,S
return regeneratorRuntime.async((function(P){for(;;)switch(P.prev=P.next){case 0:if(v=function(){var n,i,a,c
return regeneratorRuntime.async((function(u){for(;;)switch(u.prev=u.next){case 0:return n="".concat(t,"-").concat(b.score.toFixed(8),".brain"),u.next=3,regeneratorRuntime.awrap(y.save("downloads://".concat(n)))
case 3:R.killCols=h,r("".concat(n,"-norm.json"),JSON.stringify(R.toJSON())),R.killCols=[],i=_(e,y,M,U,R,!0,s),(a=[]).push(i.labels.join("\t")),c=i.data.map((function(e){return e.map((function(e){return e.toFixed(8)})).join("\t")})),a.push.apply(a,o(c)),r("".concat(n,"-check.txt"),a.join("\n"))
case 12:case"end":return u.stop()}}))},!a()){P.next=4
break}return v(),P.abrupt("return","break")
case 4:return n={initialEpoch:0,batchSize:L,epochs:300,shuffle:!0,verbose:0,callbacks:i},c={initialEpoch:300*N,batchSize:L,epochs:300*(N+1),shuffle:!0,verbose:0,callbacks:i},u=void 0,f=Math.random(),p=Math.floor(1e3*F),d=O[p],console.log("Last time, it took ".concat(d," iterations to hit ").concat(F)),void 0,void 0===d?z:1.05*d,W>z?(console.log("Total model rebuild"),y.dispose(),(y=l(e,m[0].length,1)).compile({optimizer:e.train.adam(),loss:e.losses.meanSquaredError,metrics:["mse"]}),u=n,B++,N=0,W=0,0,F=-1e3):f>.9?(u=n,N=0):u=c,P.next=16,regeneratorRuntime.awrap(y.fit(A,C,u))
case 16:if(W++,b=_(e,y,M,U,R,!1,s),g="".concat(B,".").concat(W,": "),F=Math.max(F,b.score),b.score>I&&W>1){for(w=Math.floor(1e3*F),S=Math.floor(1e3*b.score),G=w;G<S;G++)void 0===O[""+G]?O[""+G]=W:O[""+G]=Math.min(W,O[""+G])
console.log(g+"Metric of prediction = ",b.score.toFixed(8)," best so far ",I.toFixed(8)),z=Math.max(1.25*W,z),0,b.score>H+.005&&(v(),console.log("Stored result @ ",b.score),H=b.score),I=b.score}else console.log("".concat(g," missed (").concat(b.score,")"))
N++
case 23:case"end":return P.stop()}}))}
case 31:return q.next=34,regeneratorRuntime.awrap(K())
case 34:if("break"!==q.sent){q.next=37
break}return q.abrupt("break",39)
case 37:q.next=31
break
case 39:case"end":return q.stop()}var V,J}))},e.BrainLocation=e.TrainingDataPrepped=e.NormData=void 0
var f=function(){function e(t,n,o){a(this,e),c(this,"inputMin",void 0),c(this,"inputMax",void 0),c(this,"labelMin",void 0),c(this,"labelMax",void 0),c(this,"inputSpans",void 0),c(this,"labelSpans",void 0),c(this,"killCols",void 0),this.inputMin=t.min(0),this.inputMax=t.max(0),this.labelMin=n.min(0),this.labelMax=n.max(0),this.killCols=o,this.inputSpans=this.inputMax.sub(this.inputMin).dataSync(),this.labelSpans=this.labelMax.sub(this.labelMin).dataSync(),(0,r.assert2)(Array.isArray(o)&&o.length>=0&&o.length<this.inputSpans.length)}var t,n,o
return t=e,(n=[{key:"toJSON",value:function(){return{inputMin:this.inputMin.dataSync(),inputMax:this.inputMax.dataSync(),labelMin:this.labelMin.dataSync(),labelMax:this.labelMax.dataSync(),killCols:this.killCols}}}])&&s(t.prototype,n),o&&s(t,o),e}()
function p(e,t,n){return Math.max(e,Math.min(t,n))}e.NormData=f
var d,h=function e(r,o){var s=this
a(this,e),c(this,"_myData",void 0)
var u=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{}
t%2?i(Object(n),!0).forEach((function(t){c(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},r)
delete u.tm,delete u.powerNextSecond,delete u.rankInGroup,u.raceTotalLength=u.distanceInRace+u.distanceToFinish,u.pctOfRaceToFinish=1-r.pctOfRaceComplete,delete u.distanceInRace,delete u.distanceToFinish,u.negAvgSlopeCurrentDownhill=-u.avgSlopeCurrentDownhill,u.negAvgSlopeCurrentUphill=-u.avgSlopeCurrentUphill,u.currentSlope=-Math.abs(r.avgSlopeCurrentDownhill)||Math.abs(r.avgSlopeCurrentUphill),u.instantSlope=r.currentSlope,u.heightDeltaInCurrentHill=Math.abs(r.metersLeftToClimbCurrentUphill)||-Math.abs(r.metersLeftToDescentCurrentDownhill),u.heightDeltaRemaining=Math.abs(r.metersLeftToClimb)||-Math.abs(r.metersLeftToDescend),u.terminalVelocityAtFtp=function(e,t){for(var r=.5,o=r,i=0;;){var a=-n.DEFAULT_CRR*n.DEFAULT_RIDER_MASS*n.DEFAULT_GRAVITY,s=n.DEFAULT_CDA*n.DEFAULT_RHO*.5*r*r,c=t/100*(n.DEFAULT_RIDER_MASS*n.DEFAULT_GRAVITY),u=n.DEFAULT_HANDICAP_POWER*e/Math.max(r,.5)-c-s-a
if(Math.abs(u)<=.1)return r
u<0?r=((i=r)+o)/2:(o=r,i?r=(i+o)/2:r*=2)}}(1,r.currentSlope),u.deltaToTerminalVelocity=r.speed-u.terminalVelocityAtFtp,r.ridersAheadOfGroup<=0?(u.victoryMargin=r.gapToGroupBehind,u.victoryOrLossMargin=r.gapToGroupBehind):(u.victoryMargin=0,u.victoryOrLossMargin=-Math.abs(r.gapToGroupAhead)),delete u.gapToHumanAhead,delete u.gapToHumanBehind,delete u.closeRateHumanAhead,delete u.closeRateHumanBehind;[250,500,1e3,1500,2500,3500,4500,5e3,7500,1e4,15e3].forEach((function(e){u["distance-passed-".concat(e)]=p(0,r.distanceInRace/e,1),u["distanceleft-passed-".concat(e)]=p(0,r.distanceToFinish/e,1)})),u.aiRatingForDistanceCovered=(0,t.getAIStrengthBoostForDistance)(r.distanceInRace),u.aiRatingForMapLength=(0,t.getAIStrengthBoostForDistance)(u.raceTotalLength),u.aiRatingForDistanceLeft=(0,t.getAIStrengthBoostForDistance)(r.distanceToFinish),u.rankInGroup=r.rankInGroup/r.groupSize,this._myData=[]
for(var l in u)if("number"==typeof u[l])this._myData.push({data:u[l],name:l})
else if(Array.isArray(u[l]))switch(l){case"ftpSecondsSpentPerKm":break
default:!0,console.log("gotta handle",l," which had values ",u[l])}o.reverse().forEach((function(e){s._myData.splice(e,1)}))}
function m(e,t,n){for(var r=n*t.getElevationAtDistance(e),o=0,i=e;i<t.getLength();i+=t.getLength()/100){var a=n*t.getElevationAtDistance(i)
a>r&&(o+=a-r),r=a}return o}function y(e,t,n){for(var r=n*t.getElevationAtDistance(e),o=0,i=t.getLength()/100,a=e+i;a<t.getLength();a+=i){var s=n*t.getElevationAtDistance(a)
if(!(s>r))break
o+=s-r,r=s}return{vertToGo:o,horzToGo:a-i-e}}function v(e,t,n){for(var r=0,o=0,i=n[t].distanceInRace,a=t;a<Math.min(n.length,t+5)&&!(n[a].distanceInRace<i);a++)r+=n[a].powerNextSecond,o++
return[r/o]}function b(e,t){return new h(e,t)._myData}function g(e){for(var t=e[0].length,n=[],i=0;i<t;i++){console.log("working on col ",i)
var a=Math.max.apply(Math,o(e.map((function(e){return e[i].data}))))
Math.min.apply(Math,o(e.map((function(e){return e[i].data}))))===a&&(console.error("Data column ",e[0][i].name," is bad"),n.push(i))}return{allInputDatasAsNumbers:e.map((function(e){var t=[],i=-1
return n.forEach((function(n){t.push.apply(t,o(e.slice(i+1,n).map((function(e){return e.data})))),i=n})),t.push.apply(t,o(e.slice(i+1,e.length).map((function(e){return e.data})))),t.forEach((function(e){(0,r.assert2)(!isNaN(e)&&e>=-1e4)})),t})),killCols:n}}function _(e,t,n,r,i,a,s){e.engine().startScope()
var c=P(n,i.inputMin,i.inputMax),u=P(r,i.labelMin,i.labelMax),l=t.predict(c),f=function(e,t){var n=t,r=[],o=0,i=0,a=0
for(var s in n)o+=n[s]
for(var s in o/=n.length,n)i+=Math.pow(n[s]-o,2),r.push(e[s]),a+=Math.pow(r[s]-n[s],2)
return{meanValue:o,SStot:i,SSres:a,rSquared:1-a/i}}(l.dataSync(),u.dataSync()),p=[],d=[]
if(a){var h=u.dataSync(),m=l.dataSync(),y=r.dataSync(),v=n.dataSync(),b=S(l,i.labelMin,i.labelMax).dataSync(),g=v.length/b.length
d.push("Right Answer"),d.push("Predicted Answer"),d.push("Norm Right Answer"),d.push("Norm Predicted Answer"),d.push.apply(d,o(s[0].map((function(e){return e.name})))),y.forEach((function(e,t){var n=[]
n.push(e),n.push(b[t]),n.push(h[t]),n.push(m[t]),n.push.apply(n,o(v.slice(t*g,(t+1)*g))),p.push(n)}))}return e.engine().endScope(),{score:f.rSquared,data:p,labels:d}}function w(e){for(var t=e[0].length,n=function(){var n=Math.floor(Math.random()*t)
t--,e.forEach((function(e){var r=[e[n],e[t]]
e[t]=r[0],e[n]=r[1]}))};0!=t;)n()
return e}function S(e,t,n){return e.mul(n.sub(t)).add(t)}function P(e,t,n){return e.sub(t).div(n.sub(t))}function k(e,t){return e.tensor2d(t,[t.length,t[0].length])}e.TrainingDataPrepped=h,e.BrainLocation=d,function(e){e[e.ForTraining=0]="ForTraining",e[e.Deployed=1]="Deployed"}(d||(e.BrainLocation=d={}))
var O={}})),define("bt-web2/server-client-common/ServerGame",["exports","bt-web2/server-client-common/User","bt-web2/server-client-common/RaceState","bt-web2/server-client-common/communication","bt-web2/server-client-common/Utils","api/ServerConstants","fs","bt-web2/server-client-common/SpanAverage","bt-web2/server-client-common/ServerAISnapshots","@tensorflow/tfjs-node"],(function(e,t,n,r,o,i,a,s,c,u){function l(e){return(l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function f(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function p(e,t){for(var n=0;n<t.length;n++){var r=t[n]
r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function d(e,t,n){return t&&p(e.prototype,t),n&&p(e,n),e}function h(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called")
return e}function m(e,t,n){return(m="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=y(e)););return e}(e,t)
if(r){var o=Object.getOwnPropertyDescriptor(r,t)
return o.get?o.get.call(n):o.value}})(e,t,n||e)}function y(e){return(y=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function v(e,t){return(v=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function b(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}Object.defineProperty(e,"__esModule",{value:!0}),e.getBrainFolders=x,e.ServerGame=e.AIBoringBrain=e.AIUltraBoringBrain=e.AINNBrain=e.ServerUserProvider=e.ServerUser=void 0
var g=function(e){function n(e,t,r,o,i,a){var c
f(this,n),c=function(e,t){return!t||"object"!==l(t)&&"function"!=typeof t?h(e):t}(this,y(n).call(this,e,t,r,o)),b(h(c),"_tmLastNameSent",void 0),b(h(c),"_tmLastFinishUpdate",void 0),b(h(c),"_tmLastImageUpdate",void 0),b(h(c),"_usersIveBeenSentImagesFor",new Set),b(h(c),"_spanAverages",new Map),b(h(c),"_wsConnection",void 0),b(h(c),"_raceState",void 0),b(h(c),"_pendingTrainingSnapshot",null),b(h(c),"_tmTrainingSnapshot",0),c._tmLastFinishUpdate=-1,c._tmLastNameSent=-1,c._tmLastImageUpdate=-1,c._wsConnection=i,c._raceState=a
return[5,10,20,30,45,60].forEach((function(e){c._spanAverages.set(e,new s.SpanAverage(60*e))})),c}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function")
e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&v(e,t)}(n,e),d(n,[{key:"getWebSocket",value:function(){return this._wsConnection}},{key:"hasBeenSentImageFor",value:function(e){return this._usersIveBeenSentImagesFor.has(e)}},{key:"noteImageSent",value:function(e,t){this._usersIveBeenSentImagesFor.add(t),this._tmLastImageUpdate=e}},{key:"getLastImageUpdate",value:function(){return this._tmLastImageUpdate}},{key:"noteLastNameUpdate",value:function(e){this._tmLastNameSent=e}},{key:"getLastNameUpdate",value:function(){return this._tmLastNameSent}},{key:"getTimeSinceFinishUpdate",value:function(e){return e-this._tmLastFinishUpdate}},{key:"noteFinishUpdate",value:function(e){this._tmLastFinishUpdate=e}},{key:"setPosition",value:function(e){this._position=e}},{key:"_takeTrainingSnapshot",value:function(e){e-this._tmTrainingSnapshot>1500&&(this._pendingTrainingSnapshot&&(this._pendingTrainingSnapshot.powerNextSecond=this.getLastPower()/this.getHandicap(),a.default.appendFile((0,c.brainPath)("".concat(this.getName(),"-v").concat(this._pendingTrainingSnapshot.version,"-").concat(this.getBigImageMd5(),".training"),c.BrainLocation.ForTraining),JSON.stringify(this._pendingTrainingSnapshot,void 0,"\t")+"\n$$\n",{},(function(){})),this._pendingTrainingSnapshot=null),this._pendingTrainingSnapshot=(0,c.takeTrainingSnapshot)(e,this,this._raceState),this._tmTrainingSnapshot=e)}},{key:"notifyPower",value:function(e,r){if(m(y(n.prototype),"notifyPower",this).call(this,e,r),!(this.getUserType()&t.UserTypeFlags.Ai)){this._spanAverages.forEach((function(t,n){t.add(e,r)})),this._takeTrainingSnapshot(e)
var o=this._spanAverages.get(5),i=this._spanAverages.get(10),a=this._spanAverages.get(20),s=0,c=0
if(o&&o.isReady()){var u=o.getAverage()
u<=0&&(i&&i.reset(600),a&&a.reset(1200)),s+=.835*u,c++}if(i&&i.isReady())s+=.879*i.getAverage(),c++
if(a&&a.isReady())s+=.912*a.getAverage(),c++
if(c>0){var l=s/c
l>=1.02*this.getHandicap()&&(console.log("revising "+this.getName()+"'s FTP to "+l.toFixed(1)),this.setHandicap(l))}}}}]),n}(t.User)
e.ServerUser=g
var _=0,w=new Map,S=function(){function e(){f(this,e),b(this,"users",void 0),this.users=[]}return d(e,[{key:"getLocalUser",value:function(){return null}},{key:"getUsers",value:function(e){return this.users.filter((function(n){return n.getMsSinceLastPacket(e)<3e5||n.isFinished()||n.getUserType()&(t.UserTypeFlags.Ai|t.UserTypeFlags.Bot)}))}},{key:"getUser",value:function(e){return this.users.find((function(t){return t.getId()===e}))||null}},{key:"addUser",value:function(e,n,r,i){r||(r=0)
var a=_++,s=new g(e.riderName,t.DEFAULT_RIDER_MASS,e.riderHandicap,t.UserTypeFlags.Remote|r,n,i)
return s.getUserType()&(t.UserTypeFlags.Ai|t.UserTypeFlags.Bot)?(0,o.assert2)(null===n):(0,o.assert2)(null!==n),e.imageBase64&&(console.log("user ",e.riderName," has an image!"),s.setImage(e.imageBase64,e.bigImageMd5)),s.setId(a),this.users.push(s),w.set(a,s),a}}]),e}()
e.ServerUserProvider=S
var P=function(){function e(t,n){var r=this
f(this,e),b(this,"_model",null),b(this,"_name",void 0),b(this,"_strength",void 0),b(this,"_norms",void 0),b(this,"_finishLoad",void 0),(0,o.assert2)(t>=.75&&t<=1.05),t*=1.05
var i=(0,c.brainPath)(n,c.BrainLocation.Deployed)
this._finishLoad=new Promise((function(e,t){try{u.loadLayersModel("file://".concat(i,"/model.json")).then((function(t){var n=JSON.parse(a.default.readFileSync(i+"/norm.json","utf8"))
for(var o in r._norms={},n)n[o]=Object.values(n[o])
var s=(0,c.makeTensor)(u,[n.inputMax,n.inputMin]),l=(0,c.makeTensor)(u,[n.labelMax,n.labelMin])
r._norms=new c.NormData(s,l,n.killCols),r._model=t,e()}))}catch(n){t(n)}})),this._strength=t,this._name=n.split("-")[0]}return d(e,[{key:"finishLoadPromise",value:function(){return this._finishLoad}},{key:"getPower",value:function(e,t,n,r,o){return this._strength*t}},{key:"isNN",value:function(){return!!this._model}},{key:"getPowerNN",value:function(e,t){return t?this._model?e*this._strength*(0,c.predictFromRawTrainingData)(u,this._model,this._norms,t):this.getPower(0,e,t.distanceInRace,t.distanceInRace+t.distanceToFinish,t.avgSlopeCurrentUphill):1*e}},{key:"getName",value:function(e){return"".concat(this._name,"Bot ").concat((100*this._strength).toFixed(0),"%")}}]),e}()
e.AINNBrain=P
var k=function(){function e(t){f(this,e),b(this,"_nextChange",0),b(this,"_currentOutput",0),b(this,"_strength",0),this._strength=t}return d(e,[{key:"finishLoadPromise",value:function(){return Promise.resolve()}},{key:"getPower",value:function(e,n,r,o,i){return this._strength*t.DEFAULT_HANDICAP_POWER}},{key:"isNN",value:function(){return!1}},{key:"getPowerNN",value:function(e,t){throw new Error("Not implemented")}},{key:"getName",value:function(e){return"UltraBore"}}]),e}()
e.AIUltraBoringBrain=k
var O=function(){function e(t){f(this,e),b(this,"_nextChange",0),b(this,"_currentOutput",0),b(this,"_strength",0),this._strength=t}return d(e,[{key:"finishLoadPromise",value:function(){return Promise.resolve()}},{key:"getPower",value:function(e,t,n,r,o){if(e>this._nextChange||this._currentOutput<=0){this._nextChange=e+15*Math.random()+5
var i=.15*t
this._currentOutput=Math.max(0,t+Math.random()*i*2-i)}return this._strength*this._currentOutput}},{key:"isNN",value:function(){return!1}},{key:"getPowerNN",value:function(e,t){throw new Error("Not implemented")}},{key:"getName",value:function(e){return"Boring ".concat((100*this._strength).toFixed(0),"%")}}]),e}()
e.AIBoringBrain=O
var E=function(){function e(t){f(this,e),b(this,"_period",void 0),b(this,"_magnitude",void 0),b(this,"_strength",0),this._period=30*Math.random()+30,this._magnitude=.4*Math.random(),this._strength=t}return d(e,[{key:"finishLoadPromise",value:function(){return Promise.resolve()}},{key:"getPower",value:function(e,t,n,r,o){var i=t*this._magnitude*Math.sin(2*e*Math.PI/this._period)
return this._strength*Math.max(0,t+i)}},{key:"isNN",value:function(){return!1}},{key:"getPowerNN",value:function(e,t){throw new Error("Not implemented")}},{key:"getName",value:function(e){return"Sine ".concat((100*this._strength).toFixed(0),"%")}}]),e}(),T=function(){function e(t){f(this,e),b(this,"_magnitude",void 0),b(this,"_strength",0),this._magnitude=.9+.2*Math.random(),this._strength=t}return d(e,[{key:"finishLoadPromise",value:function(){return Promise.resolve()}},{key:"getPower",value:function(e,t,n,r,o){var i=this._magnitude*o/100+1
return this._strength*Math.max(0,t*i)}},{key:"isNN",value:function(){return!1}},{key:"getPowerNN",value:function(e,t){throw new Error("Not implemented")}},{key:"getName",value:function(e){return"Hill ".concat((100*this._strength).toFixed(0),"%")}}]),e}(),j=function(){function e(t){f(this,e),b(this,"_fractionOfLengthToSave",.95),b(this,"_fractionToSaveAt",.98),b(this,"_strength",0),this._fractionOfLengthToSave=.9+.075*Math.random(),this._fractionToSaveAt=.95+.04*Math.random(),this._strength=t}return d(e,[{key:"finishLoadPromise",value:function(){return Promise.resolve()}},{key:"getPower",value:function(e,t,n,r,o){if(n/r<this._fractionOfLengthToSave)return this._strength*t*this._fractionToSaveAt
var i=1-this._fractionOfLengthToSave
return(1-this._fractionOfLengthToSave*this._fractionToSaveAt)/i*t}},{key:"isNN",value:function(){return!1}},{key:"getPowerNN",value:function(e,t){throw new Error("Not implemented")}},{key:"getName",value:function(e){return"Savey ".concat((100*this._strength).toFixed(0),"%")}}]),e}()
function D(e,t){(0,o.assert2)(e>=.75&&e<=1.05)
switch(Math.floor(5*Math.random())){default:case 0:return new O(e)
case 1:return new E(e)
case 2:return new T(e)
case 3:return new j(e)
case 4:try{if(t.length>0){var n=Math.floor(Math.random()*t.length)
return new P(e,t[n])}return new j(e)}catch(r){return new j(e)}}}function x(){var e=(0,c.brainPath)("",c.BrainLocation.Deployed)
return a.default.readdirSync(e).filter((function(e){return a.default.statSync((0,c.brainPath)(e,c.BrainLocation.Deployed)).isDirectory()&&e.endsWith(".brain")}))}var M=function(){function e(o,i,a,s){f(this,e),b(this,"_stopped",!1),b(this,"_timeout",void 0),b(this,"_name",void 0),b(this,"_gameId",void 0),b(this,"_tmRaceStart",void 0),b(this,"_tmScheduledRaceStart",void 0),b(this,"_lastRaceStateMode",r.CurrentRaceState.PreRace),b(this,"_tmLastAiUpdate",void 0),b(this,"raceState",void 0),b(this,"userProvider",void 0),b(this,"_aiBrains",void 0),this.userProvider=new S,this.raceState=new n.RaceState(o,this.userProvider,i),this._aiBrains=new Map,this._tmLastAiUpdate=(new Date).getTime()
for(var c=(0,n.getAIStrengthBoostForDistance)(o.getLength()),u=x(),l=0;l<s;l++){var p=.25*Math.random()+.8,d=D(p,u),h=this.userProvider.addUser({riderName:d.getName(p),accountId:"-1",riderHandicap:300*c,gameId:i,imageBase64:null,bigImageMd5:null},null,t.UserTypeFlags.Ai,this.raceState)
this._aiBrains.set(h,d)}this._timeout=null,this._tmScheduledRaceStart=-1,this._tmRaceStart=-1,this._name=a,this._gameId=i}return d(e,[{key:"getDisplayName",value:function(){return this._name}},{key:"getGameId",value:function(){return this._gameId}},{key:"findUserByImage",value:function(e,n,r,o){var i=this.userProvider.getUsers(e).find((function(e){return!(e.getUserType()&t.UserTypeFlags.Ai)&&e.getHandicap()===o&&e.getName()===r&&e.getImage()&&e.getImage()===n}))||null
return i||null}},{key:"start",value:function(e){this._tmRaceStart=e,this._tmLastAiUpdate=e,this._scheduleTick()}},{key:"stop",value:function(){this._stopped=!0,this.raceState.stop()}},{key:"addUser",value:function(e,t,n){var o=this.userProvider.addUser(t,n,0,this.raceState),i=this.userProvider.getUser(o)
return i&&this._lastRaceStateMode===r.CurrentRaceState.PostRace&&(i.setFinishTime(e),i.setPosition(this.raceState.getMap().getLength())),this._tmScheduledRaceStart<0&&(this._tmScheduledRaceStart=e+5e3),this._scheduleTick(),o}},{key:"scheduleRaceStartTime",value:function(e){this._tmScheduledRaceStart=e}},{key:"getLastRaceState",value:function(){return this._lastRaceStateMode}},{key:"getRaceStartTime",value:function(){return this._tmRaceStart}},{key:"getRaceScheduledStartTime",value:function(){return this._tmScheduledRaceStart}},{key:"getUser",value:function(e){return w.get(e)}},{key:"_tick",value:function(){var e=this
if(!this._stopped){var n=(new Date).getTime(),i=null
if(n-this._tmLastAiUpdate>250&&(this.userProvider.getUsers(n).forEach((function(r){if(r.getUserType()&t.UserTypeFlags.Ai){var o=r.getHandicap()/t.DEFAULT_HANDICAP_POWER*r.getHandicap()+50*Math.random()-25,i=e._aiBrains.get(r.getId())
if(i)if(i.isNN()){var a=(0,c.takeTrainingSnapshot)(n,r,e.raceState)
o=a?i.getPowerNN(r.getHandicap(),a):.9*r.getHandicap()}else{var s=e.raceState.getMap(),u=r.getDistance()
o=i.getPower(n/1e3,r.getHandicap(),u,s.getLength(),100*s.getSlopeAtDistance(u))}r.notifyPower(n,Math.max(0,o))}})),this._tmLastAiUpdate=n),n<this._tmScheduledRaceStart)this._scheduleTick(),i=r.CurrentRaceState.PreRace,this._tmRaceStart=-1
else{switch(this._tmRaceStart<0&&(this._tmRaceStart=n),this._lastRaceStateMode){case r.CurrentRaceState.PreRace:i=r.CurrentRaceState.Racing,console.log("we're past the scheduled start time of ".concat(this.raceState.getGameId(),", so we're starting")),this.raceState.tick(n)
break
case r.CurrentRaceState.Racing:if(this.raceState.isAllHumansFinished(n))if(this.raceState.isAllRacersFinished(n)){var s=new r.S2CFinishUpdate(this.userProvider,this._tmRaceStart)
try{a.default.mkdirSync("../finish-data/")}catch(u){}a.default.writeFileSync("../finish-data/".concat(r.S2CFinishUpdate.getPermanentKey(s),".json"),JSON.stringify(s)),i=r.CurrentRaceState.PostRace,console.log("all racers (human and AI) are done ".concat(this.raceState.getGameId(),", so we're post-race now"))}else{this.raceState.tick(n),this.raceState.getSecondsSinceLastNonFinishedHuman(n)>=300?(i=r.CurrentRaceState.PostRace,console.log("Been 5 minutes since we last saw an unfinished human on "+this.raceState.getGameId()+", so we're going to post-race")):i=r.CurrentRaceState.Racing}else this.raceState.tick(n),i=r.CurrentRaceState.Racing
break
case r.CurrentRaceState.PostRace:i=r.CurrentRaceState.PostRace}this._scheduleTick()}(0,o.assert2)(null!==i,"We must set this every time"),this._lastRaceStateMode=i}}},{key:"_scheduleTick",value:function(){var e=this
this._stopped||(this._timeout=setTimeout((function(){return e._tick()}),1e3/i.SERVER_PHYSICS_FRAME_RATE))}}]),e}()
e.ServerGame=M})),define("bt-web2/server-client-common/ServerHttpObjects",["exports"],(function(e){function t(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}Object.defineProperty(e,"__esModule",{value:!0}),e.ScheduleRacePostRequest=void 0
e.ScheduleRacePostRequest=function e(n,r,o,i){(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,e),t(this,"tmWhen",void 0),t(this,"raceName",void 0),t(this,"hostName",void 0),t(this,"elevations",void 0),t(this,"lengthMeters",void 0),this.tmWhen=r.getTime(),this.raceName=o,this.hostName=i,this.elevations=[]
for(var a=0;a<=1;a+=.005){var s=a*n.getLength()
this.elevations.push(n.getElevationAtDistance(s))}this.lengthMeters=n.getLength()}})),define("bt-web2/server-client-common/SpanAverage",["exports","bt-web2/server-client-common/Utils"],(function(e,t){function n(e,t){for(var n=0;n<t.length;n++){var r=t[n]
r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}Object.defineProperty(e,"__esModule",{value:!0}),e.SpanAverage=void 0
var i=function e(t,n,i){r(this,e),o(this,"tm",void 0),o(this,"dt",void 0),o(this,"power",void 0),this.tm=t,this.dt=n,this.power=i},a=function(){function e(t){r(this,e),o(this,"samples",[]),o(this,"dtSum",0),o(this,"powerSum",0),o(this,"tmLast",0),o(this,"secondsSpan",0),this.reset(t)}var a,s,c
return a=e,(s=[{key:"reset",value:function(e){this.samples=[],this.dtSum=0,this.powerSum=0,this.tmLast=0,this.secondsSpan=e}},{key:"isReady",value:function(){if(this.samples.length<=0)return!1
var e=this.samples[0]
return(this.samples[this.samples.length-1].tm-e.tm)/1e3>=.95*this.secondsSpan}},{key:"getAverage",value:function(){return this.isReady()?this.powerSum/this.dtSum:0}},{key:"add",value:function(e,n){if(0!==this.tmLast){var r=(e-this.tmLast)/1e3
if(r>2)this.tmLast=e
else{this.dtSum+=r,this.powerSum+=r*n,this.samples.push(new i(e,r,n))
for(var o=0;this.samples.length>0;){var a=this.samples[o]
if(!((e-a.tm)/1e3>this.secondsSpan))break
o++,this.dtSum-=a.dt,this.powerSum=Math.max(0,this.powerSum-a.power*a.dt),(0,t.assert2)(this.powerSum>=0)}this.samples=this.samples.slice(o)}}else this.tmLast=e}}])&&n(a.prototype,s),c&&n(a,c),e}()
e.SpanAverage=a})),define("bt-web2/server-client-common/User",["exports","bt-web2/server-client-common/Utils"],(function(e,t){function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function r(e){return(r=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function o(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called")
return e}function i(e,t){return(i=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e,t){for(var n=0;n<t.length;n++){var r=t[n]
r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function c(e,t,n){return t&&s(e.prototype,t),n&&s(e,n),e}function u(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}Object.defineProperty(e,"__esModule",{value:!0}),e.User=e.JoulesUsedClass=e.UserTypeFlags=e.DEFAULT_RIDER_MASS=e.DEFAULT_HANDICAP_POWER=e.DEFAULT_CDA=e.DEFAULT_RHO=e.DEFAULT_GRAVITY=e.DEFAULT_CRR=void 0
e.DEFAULT_CRR=.0033
e.DEFAULT_GRAVITY=9.81
e.DEFAULT_RHO=1.225
e.DEFAULT_CDA=.25
e.DEFAULT_HANDICAP_POWER=300
var l
e.DEFAULT_RIDER_MASS=80,e.UserTypeFlags=l,function(e){e[e.Local=1]="Local",e[e.Remote=2]="Remote",e[e.Ai=4]="Ai",e[e.Bot=8]="Bot"}(l||(e.UserTypeFlags=l={}))
var f,p=function(){function e(){a(this,e),u(this,"_lastPower",0),u(this,"_tmLastPower",0),u(this,"_id",-1),u(this,"_tmFinish",-1),u(this,"_tmLastPacket",-1),u(this,"_powerHistory",[]),u(this,"_lastHrm",0),u(this,"_tmLastHrm",0)}return c(e,[{key:"isPowerValid",value:function(e){return e-this._tmLastPower<5e3}},{key:"getPowerAverageForLastNSeconds",value:function(e,t){for(var n=0,r=0,o=e-1e3*t,i=this._powerHistory.length-1;i>=0&&!(this._powerHistory[i].tm<o);i--)n+=this._powerHistory[i].distance,r++
return n/r}},{key:"notifyPower",value:function(e,t){this._lastPower=t,this._tmLastPower=e,this._powerHistory.push({tm:e,distance:t})}},{key:"notifyCadence",value:function(e,t){}},{key:"notifyHrm",value:function(e,t){this._tmLastHrm=e,this._lastHrm=t}},{key:"getLastHrm",value:function(e){return e<=this._tmLastHrm+5e3?this._lastHrm:0}},{key:"getLastPower",value:function(){return this._lastPower}},{key:"setFinishTime",value:function(e){this._tmFinish=e}},{key:"getRaceTimeSeconds",value:function(e){return(this._tmFinish-e)/1e3}},{key:"isFinished",value:function(){return this._tmFinish>=0}},{key:"getMsSinceLastPacket",value:function(e){return Math.max(0,e-this._tmLastPacket)}},{key:"notePacket",value:function(e){this._tmLastPacket=e}},{key:"setId",value:function(e){e<0?(0,t.assert2)(this._id>=0,"You're only allowed setting back to a negative id when you're disconnecting"):e>=0&&(0,t.assert2)(this._id<0,"You're only allowed setting positive IDs when you're connecting"),this._id=e}},{key:"getId",value:function(){return this._id}}]),e}()
e.JoulesUsedClass=f,function(e){e.WholeCourse="whole-course",e.Last500m="last-500m",e.WhileUphill="while-uphill",e.WhileDownhill="while-downhill",e.FirstHalf="first-half",e.LastHalf="last-half"}(f||(e.JoulesUsedClass=f={}))
var d=function(e){function s(e,t,i,c){var l
return a(this,s),l=function(e,t){return!t||"object"!==n(t)&&"function"!=typeof t?o(e):t}(this,r(s).call(this)),u(o(l),"_massKg",void 0),u(o(l),"_handicap",void 0),u(o(l),"_typeFlags",void 0),u(o(l),"_name",void 0),u(o(l),"_lastSlopeWholePercent",0),u(o(l),"_imageBase64",null),u(o(l),"_bigImageMd5",null),u(o(l),"_lastT",0),u(o(l),"_speed",0),u(o(l),"_position",0),u(o(l),"_lastDraftSaving",{watts:0,pctOfMax:0,fromDistance:0}),u(o(l),"_distanceHistory",[]),u(o(l),"_tmLastHandicapRevision",0),u(o(l),"_pendingDraftees",{}),u(o(l),"_lastDraftees",{}),u(o(l),"_tmDrafteeCycle",0),u(o(l),"_lastElevation",0),u(o(l),"_lastChat",""),u(o(l),"_lastChatTime",0),u(o(l),"_physicsJoulesSaved",0),u(o(l),"_physicsJoulesUsed",{}),u(o(l),"_lastDraftUser",null),l._massKg=t,l._handicap=i,l._typeFlags=c,l._name=e,l._lastT=(new Date).getTime()/1e3,l}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function")
e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&i(e,t)}(s,e),c(s,[{key:"setHandicap",value:function(e){(0,t.assert2)(e>=this._handicap,"you should only increase handicaps, not tank them"),this._handicap=e}},{key:"setChat",value:function(e,t){this._lastChat=t,this._lastChatTime=e}},{key:"getLastChat",value:function(e){return e-this._lastChatTime>1e4?null:{tmWhen:this._lastChatTime,chat:this._lastChat}}},{key:"getLastElevation",value:function(){return this._lastElevation}},{key:"getPositionUpdate",value:function(e){return{id:this.getId(),distance:this.getDistance(),speed:this.getSpeed(),power:this.getLastPower(),hrm:this.getLastHrm(e)}}},{key:"setDistance",value:function(e){this._position=e}},{key:"setSpeed",value:function(e){this._speed=e}},{key:"setDistanceHistory",value:function(e){(0,t.assert2)(0===this._distanceHistory.length),this._distanceHistory=e}},{key:"getDistanceHistory",value:function(){return this._distanceHistory}},{key:"getLastSlopeInWholePercent",value:function(){return this._lastSlopeWholePercent}},{key:"getDistance",value:function(){return this._position}},{key:"getSpeed",value:function(){return this._speed}},{key:"getName",value:function(){return this._name}},{key:"getImage",value:function(){return this._imageBase64}},{key:"getBigImageMd5",value:function(){return this._bigImageMd5}},{key:"getUserType",value:function(){return this._typeFlags}},{key:"getHandicap",value:function(){return this._handicap}},{key:"getLastHandicapChangeTime",value:function(){return this._tmLastHandicapRevision}},{key:"physicsTick",value:function(e,n,r){var o=this,i=e/1e3,a=i-this._lastT
if(this._lastT=i,!(a<0||a>=1)){var s=n.getPowerTransform(this)(this.getLastPower()),c=s/Math.max(this._speed,.5),u=.5*-Math.pow(this._speed,2)*1.225*.25
if(this._position>5){this.drafteeCheck(e)
var l=10,p=null,d=1e30,h=1
if(r.forEach((function(e){var t=e.getDistance()-o.getDistance(),n=Math.max(1,Math.min(2,e.getSpeed()/10))
t>=3&&t<=10*n&&(!p||t<d)&&(d=t,p=e,h=n,l=10*n)})),p){p=p,(0,t.assert2)(d>=1.5&&d<=l),p.notifyDrafteeThisCycle(e,this.getId())
var m=Math.max(1,p.getDrafteeCount(e)),y=(d-1.5)/(l-1.5),v=1*y+(1-y)*(1-.33/m/h),b=(1-v)*u
u*=v
var g=Math.abs(b*this._speed)
this._lastDraftUser=p,this.setLastWattsSaved(a,g,1-y,this.getDistance()+d)}else this.setLastWattsSaved(a,0,0,this.getDistance()),this._lastDraftUser=null}var _=n.getSlopeAtDistance(this._position)
this._lastSlopeWholePercent=100*_
var w=Math.atan(_),S=Math.sin(w)*Math.sin(w),P=Math.pow(Math.cos(w)-1,2),k=-Math.sqrt(S+P)*this._massKg*9.81
_<0&&((0,t.assert2)(k<=0),k=-k)
var O=-.0033*this._massKg*9.81;(0,t.assert2)(O<=0),(0,t.assert2)(u<=0)
var E=(c+u+k+O)/this._massKg
this._speed=Math.max(.5,this._speed+E*a),(0,t.assert2)(this._speed>=0)
var T=this._position,j=n.getLength()
this._position+=Math.min(n.getLength(),this._speed*a),this._position=Math.min(n.getLength(),this._position),this._lastElevation=n.getElevationAtDistance(this._position)
var D=this._distanceHistory&&this._distanceHistory[this._distanceHistory.length-1];(!D||this._position>D.distance&&e>D.tm+1e3)&&this._distanceHistory.push({tm:e,distance:this._position}),T<j&&this._position>=j&&this.setFinishTime(e),this._position>0&&this._position<j?(this._physicsJoulesUsed[f.WholeCourse]=(this._physicsJoulesUsed[f.WholeCourse]||0)+a*s,_>0&&(this._physicsJoulesUsed[f.WhileUphill]=(this._physicsJoulesUsed[f.WhileUphill]||0)+a*s),_<0&&(this._physicsJoulesUsed[f.WhileDownhill]=(this._physicsJoulesUsed[f.WhileDownhill]||0)+a*s),this._position>=n.getLength()-500&&(this._physicsJoulesUsed[f.Last500m]=(this._physicsJoulesUsed[f.Last500m]||0)+a*s),this._position>=n.getLength()/2&&(this._physicsJoulesUsed[f.LastHalf]=(this._physicsJoulesUsed[f.LastHalf]||0)+a*s),this._position<n.getLength()/2&&(this._physicsJoulesUsed[f.FirstHalf]=(this._physicsJoulesUsed[f.FirstHalf]||0)+a*s)):this._position<=0&&(this._physicsJoulesUsed[f.WholeCourse]=0)}}},{key:"notifyDrafteeThisCycle",value:function(e,t){e>this._tmDrafteeCycle&&(this._lastDraftees=this._pendingDraftees,this._pendingDraftees={},this._tmDrafteeCycle=e),this._pendingDraftees[t]=!0}},{key:"drafteeCheck",value:function(e){e>this._tmDrafteeCycle&&(this._lastDraftees=this._pendingDraftees,this._pendingDraftees={},this._tmDrafteeCycle=e)}},{key:"getDrafteeCount",value:function(e){return Object.keys(this._lastDraftees).length}},{key:"getDrafteeIds",value:function(e){return Object.keys(this._lastDraftees).map((function(e){return parseInt(e)}))}},{key:"getSecondsAgoToCross",value:function(e,n){for(var r=0;r<this._distanceHistory.length-1;r++){var o=this._distanceHistory[r],i=this._distanceHistory[r+1]
if(o.distance<n&&i.distance>n){var a=(n-o.distance)/(i.distance-o.distance);(0,t.assert2)(a>=-.001&&a<=1.001)
var s=a*i.tm+(1-a)*o.tm
if(s<e)return(e-s)/1e3}}return null}},{key:"isDraftingLocalUser",value:function(){return!!(this._lastDraftUser&&this._lastDraftUser.getUserType()&l.Local)}},{key:"getLastWattsSaved",value:function(){return this._lastDraftSaving||{watts:0,pctOfMax:0,fromDistance:0}}},{key:"setLastWattsSaved",value:function(e,t,n,r){r>5&&(this._physicsJoulesSaved+=e*t,this._lastDraftSaving={watts:t,pctOfMax:n,fromDistance:r})}},{key:"hasDraftersThisCycle",value:function(e){return this.getDrafteeCount(e)>0}},{key:"getHandicapSecondsSaved",value:function(){var e=this._handicap/300
return this._physicsJoulesSaved*e/this._handicap}},{key:"getHandicapSecondsUsed",value:function(){var e={}
for(var t in this._physicsJoulesUsed)e[t]=this._physicsJoulesUsed[t]/300
return e}},{key:"getDisplay",value:function(e){var n=e&&e.getMap()||null,r=[]
this._typeFlags&l.Local&&r.push("local"),this._typeFlags&l.Ai?r.push("ai"):r.push("human"),this._typeFlags&l.Remote&&r.push("remote")
var o=n?n.getLength()-this._position:this._position,i=(new Date).getTime()
return{name:this._name,lastPower:this.getLastPower().toFixed(0)+"W",distance:(0,t.formatDisplayDistance)(o),speed:(3.6*this._speed).toFixed(1)+"km/h",slope:n&&(100*n.getSlopeAtDistance(this._position)).toFixed(1)+"%"||"",elevation:n&&n.getElevationAtDistance(this._position).toFixed(0)+"m"||"",classString:r.join(" "),lastWattsSaved:this.getLastWattsSaved().watts.toFixed(1)+"W",handicap:this.getHandicap().toFixed(0)+"W",user:this,hrm:this.getLastHrm(i).toFixed(0)+"bpm"}}},{key:"setImage",value:function(e,n){(0,t.assert2)(e.startsWith("data:")),this.getUserType()&l.Ai?this._imageBase64=null:(this._imageBase64=e,this._bigImageMd5=n)}},{key:"absorbNameUpdate",value:function(e,t,n,r){this._name=t,isFinite(r)&&(r>this._handicap&&(this._tmLastHandicapRevision=e),this._handicap=r),this._typeFlags&l.Local||(this._typeFlags=n)}},{key:"absorbPositionUpdate",value:function(e,t){this._speed=t.speed,this._position=t.distance,this._typeFlags&l.Local||(this.notifyPower(e,t.power),this.notifyHrm(e,t.hrm)),this.notePacket(e)}}]),s}(p)
e.User=d})),define("bt-web2/server-client-common/Utils",["exports"],(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.assert2=function(e,t){if(!e){var n=new Error
console.error("Assert failure: ",t,n&&n.stack&&n.stack.toString&&n.stack.toString())}},e.testAssert=function(e,t){if(!e)throw new Error(t)},e.formatSecondsHms=function(e){if(e<60)return e.toFixed(1)+"s"
if(e<3600)return"".concat(Math.floor(e/60),"m ").concat((e%60).toFixed(1),"s")
var t=Math.floor(e/3600)
e-=3600*t
var n=Math.floor(e/60)
return e-=60*n,"".concat(t,"h ").concat(n,"m ").concat(e.toFixed(1),"s")},e.formatDisplayDistance=function(e){return e<500?e.toFixed(0)+"m":e<1e4?(e/1e3).toFixed(2)+"km":e<1e5?(e/1e3).toFixed(1)+"km":(e/1e3).toFixed(0)+"km"}})),define("bt-web2/server-client-common/communication",["exports","bt-web2/server-client-common/RaceState","bt-web2/server-client-common/User","bt-web2/server-client-common/Utils","bt-web2/server-client-common/RideMap","bt-web2/server-client-common/RideMapHandicap"],(function(e,t,n,r,o,i){function a(e){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function s(e){return(s=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function c(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called")
return e}function u(e,t){return(u=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function l(e){return function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t]
return n}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function f(e,t){for(var n=0;n<t.length;n++){var r=t[n]
r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function p(e,t,n){return t&&f(e.prototype,t),n&&f(e,n),e}function d(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function h(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var m,y,v
Object.defineProperty(e,"__esModule",{value:!0}),e.apiGetInternal=function(e,t,n){var r="/"===t[0]||"/"===e[e.length-1]?"":"/",o="?"
for(var i in n)o+=i+"="+encodeURIComponent(n[i])+"&"
return fetch(e+r+t+o,{method:"GET"}).then((function(e){return e.json()}))},e.apiPostInternal=function(e,t,n){var r="/"===t[0]||"/"===e[e.length-1]?"":"/",o=e+r+t
return console.log("posting to ",o),fetch(o,{method:"POST",headers:{"Content-Type":"application/json"},body:n&&JSON.stringify(n)}).then((function(e){return e.json()}))},e.getElevationFromEvenSpacedSamples=_,e.default=e.ServerHttpGameListElement=e.SimpleElevationMap=e.ClientToServerUpdate=e.S2CNameUpdate=e.S2CImageUpdate=e.ServerMapDescription=e.S2CFinishUpdate=e.S2CRaceStateUpdate=e.CurrentRaceState=e.BasicMessageType=e.PORTS=void 0,e.PORTS=m,function(e){e[e.TOURJS_WEBSOCKET_PORT=8080]="TOURJS_WEBSOCKET_PORT",e[e.GENERAL_HTTP_PORT=8081]="GENERAL_HTTP_PORT"}(m||(e.PORTS=m={})),e.BasicMessageType=y,function(e){e[e.ClientToServerUpdate=0]="ClientToServerUpdate",e[e.ClientConnectionRequest=1]="ClientConnectionRequest",e[e.ClientConnectionResponse=2]="ClientConnectionResponse",e[e.ServerError=3]="ServerError",e[e.S2CPositionUpdate=4]="S2CPositionUpdate",e[e.S2CNameUpdate=5]="S2CNameUpdate",e[e.S2CFinishUpdate=6]="S2CFinishUpdate",e[e.S2CImageUpdate=7]="S2CImageUpdate",e[e.S2CClientChat=8]="S2CClientChat",e[e.ClientToServerChat=9]="ClientToServerChat"}(y||(e.BasicMessageType=y={})),e.CurrentRaceState=v,function(e){e[e.PreRace=0]="PreRace",e[e.Racing=1]="Racing",e[e.PostRace=2]="PostRace"}(v||(e.CurrentRaceState=v={}))
e.S2CRaceStateUpdate=function e(t,n){d(this,e),h(this,"state",void 0),h(this,"msUntilNextState",void 0),h(this,"tmOfNextState",void 0)
var r=-1,o=-1
if(n){switch(n.getLastRaceState()){case v.PreRace:o=n.getRaceScheduledStartTime(),r=Math.max(0,o-t)}this.state=n.getLastRaceState(),this.msUntilNextState=r,this.tmOfNextState=o}else this.state=v.PreRace,this.msUntilNextState=0,this.tmOfNextState=2147483647}
var b=function(){function e(t,r){var o=this
d(this,e),h(this,"key",void 0),h(this,"raceLengthKm",void 0),h(this,"tmRaceStart",void 0),h(this,"names",void 0),h(this,"rankings",void 0),h(this,"times",void 0),h(this,"hsSaved",void 0),h(this,"efficiency",void 0),h(this,"userSpending",void 0),h(this,"types",void 0),h(this,"handicaps",void 0)
var i=(new Date).getTime(),a=t.getUsers(i)
a.sort((function(e,t){return e.isFinished()&&t.isFinished()&&e.getRaceTimeSeconds(r)<t.getRaceTimeSeconds(r)?-1:1}))
var s=Math.max.apply(Math,l(a.map((function(e){return e.getDistance()}))))/1e3
this.raceLengthKm=s,this.tmRaceStart=r,this.names=[],this.rankings=[],this.times=[],this.hsSaved=[],this.efficiency=[],this.userSpending=[],this.types=[],this.handicaps=[],this.key=e.getPermanentKey(this),a.forEach((function(e,t){o.names.push(e.getName()),o.rankings.push(e.getId()),o.times.push(e.getRaceTimeSeconds(r)),o.hsSaved.push(e.getHandicapSecondsSaved()),o.efficiency.push(e.getHandicapSecondsUsed()[n.JoulesUsedClass.WholeCourse]/s),o.userSpending.push(e.getHandicapSecondsUsed()),o.types.push(e.getUserType()),o.handicaps.push(e.getHandicap())}))}return p(e,null,[{key:"getPermanentKey",value:function(e){if(e.key)return e.key
var t=new Date(e.tmRaceStart),n=1e3*e.raceLengthKm
return"".concat(n.toFixed(0),"m-").concat(t.getUTCFullYear(),"-").concat(t.getUTCMonth()+1,"-").concat(t.getUTCDate(),"-").concat(t.getUTCHours(),"-").concat(t.getUTCMinutes())}}]),e}()
e.S2CFinishUpdate=b
e.ServerMapDescription=function e(t){d(this,e),h(this,"distances",void 0),h(this,"elevations",void 0)
var n=t.getLength()
this.distances=[],this.elevations=[]
for(var o=0;o<2e3;o++){var i=o/2e3*n,a=t.getElevationAtDistance(i)
isFinite(a)&&isFinite(i)?(this.distances.push(i),this.elevations.push(a)):(0,r.assert2)(!1,"Why are these elevations not finite?")}}
e.S2CImageUpdate=function e(t){d(this,e),h(this,"id",void 0),h(this,"imageBase64",void 0),this.id=t.getId()
var n=t.getImage()
if(!n)throw new Error("You're trying to send an image update for a user without an image?")
this.imageBase64=n}
e.S2CNameUpdate=function e(t,n){var r=this
d(this,e),h(this,"names",void 0),h(this,"ids",void 0),h(this,"userTypes",void 0),h(this,"userHandicaps",void 0)
var o=n.getUsers(t)
this.names=[],this.ids=[],this.userTypes=[],this.userHandicaps=[],o.forEach((function(e){r.names.push(e.getName()),r.ids.push(e.getId()),r.userTypes.push(e.getUserType()),r.userHandicaps.push(e.getHandicap())}))}
var g=function e(t){d(this,e),h(this,"gameId",void 0),h(this,"userId",void 0),h(this,"lastPower",void 0),h(this,"lastHrm",void 0)
var n=t.getLocalUser()
if(!n)throw new Error("Can't build a ClientToServerUpdate without a local player!")
this.gameId=t.getGameId(),this.userId=n.getId(),(0,r.assert2)(this.userId>=0,"We can't really tell the server about our user unless we know his id..."),this.lastPower=n.getLastPower()
var o=n.getLastHrm((new Date).getTime())
o>0&&(this.lastHrm=o)}
function _(e,t,n){var o=e/t,i=n.length-1
if(o<0)return n[0]
if(o>=1)return n[i-1]
var a=Math.floor(o*i),s=a+1;(0,r.assert2)(a>=0&&a<=n.length-2),(0,r.assert2)(s>=0&&s<=n.length-1)
var c=a/i*t,u=s/i*t,l=n[a],f=n[s],p=e-c,d=p/(u-c)
return(0,r.assert2)(d>=-.001&&d<=1.001),(0,r.assert2)(p>=-.001),(0,r.assert2)(u>c),d*f+(1-d)*l}e.ClientToServerUpdate=g
var w=function(e){function t(e,n){var o
return d(this,t),o=function(e,t){return!t||"object"!==a(t)&&"function"!=typeof t?c(e):t}(this,s(t).call(this)),h(c(o),"elevations",void 0),h(c(o),"lengthMeters",void 0),o.elevations=e,o.lengthMeters=n,e.forEach((function(e){(0,r.assert2)(isFinite(e))})),o}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function")
e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&u(e,t)}(t,e),p(t,[{key:"getElevationAtDistance",value:function(e){var t=_(e,this.lengthMeters,this.elevations)
return(0,r.assert2)(isFinite(t)),t}},{key:"getLength",value:function(){return this.lengthMeters}}]),t}(o.RideMapPartial)
e.SimpleElevationMap=w
e.ServerHttpGameListElement=function e(t,r){d(this,e),h(this,"gameId",void 0),h(this,"displayName",void 0),h(this,"status",void 0),h(this,"tmScheduledStart",void 0),h(this,"tmActualStart",void 0),h(this,"whoIn",void 0),h(this,"whoInAi",void 0),h(this,"elevations",void 0),h(this,"lengthMeters",void 0),h(this,"url",void 0),this.gameId=r.raceState.getGameId(),this.displayName=r.getDisplayName(),this.status=r.getLastRaceState(),this.tmScheduledStart=r.getRaceScheduledStartTime(),this.tmActualStart=r.getRaceStartTime(),this.url="/ride/".concat(this.gameId),this.whoIn=r.userProvider.getUsers(t).filter((function(e){return!(e.getUserType()&n.UserTypeFlags.Ai)})).map((function(e){return e.getName()})),this.whoInAi=r.userProvider.getUsers(t).filter((function(e){return e.getUserType()&n.UserTypeFlags.Ai})).map((function(e){return e.getName()}))
var o=r.raceState.getMap(),i=o.getLength()
this.lengthMeters=i,this.elevations=[]
for(var a=0;a<100;a++){var s=a/100,c=o.getElevationAtDistance(s*i)
this.elevations.push(c)}}
var S=function(){function e(t,n,r,o){d(this,e),h(this,"_timeout",0),h(this,"_ws",null),h(this,"_raceState",null),h(this,"_gameId",""),h(this,"_lastServerRaceState",null),h(this,"raceResults",null),h(this,"_lastTimeStamp",0),h(this,"_imageSources",new Map),h(this,"_userProvider",null),h(this,"_desiresDisconnect",!1),h(this,"_onLocalHandicapChange",void 0),h(this,"_onLastServerRaceStateChange",void 0),h(this,"_onNetworkUpdateComplete",void 0),h(this,"_notifyNewClient",void 0),this._onLocalHandicapChange=t,this._onLastServerRaceStateChange=n,this._onNetworkUpdateComplete=r,this._notifyNewClient=o}return p(e,[{key:"_performStartupNegotiate",value:function(e,t,n,r){var o=this,i=e.onmessage
return new Promise((function(i,a){var s
e.onmessage=function(e){try{var t=JSON.parse(e.data)
o._lastServerRaceState=t.raceState,o._onLastServerRaceStateChange()
var n=t.payload
i(n)}catch(r){a(r)}},console.log("image size is ",null===(s=t.getImage())||void 0===s?void 0:s.length)
var c={payload:{riderName:t.getName(),imageBase64:t.getImage(),bigImageMd5:t.getBigImageMd5(),accountId:n,riderHandicap:t.getHandicap(),gameId:r},type:y.ClientConnectionRequest}
e.send(JSON.stringify(c))})).then((function(t){return e.onmessage=i,t}))}},{key:"connect",value:function(e,n,r,o,a,s){var c=this
return this._desiresDisconnect=!1,new Promise((function(t,i){var u=new WebSocket(e)
u.onopen=function(){console.log("websocket opened!"),t(u)},u.onerror=function(e){console.log("websocket error"),i(e),u.close()}
var l=null
u.onclose=function(){console.log("websocket closed")
c._desiresDisconnect||(l=setTimeout((function t(){c._desiresDisconnect||(console.log("attempting reconnect to ",r),c.connect(e,n,r,o,a,s).then((function(e){s(e)}),(function(e){console.log("failed in attempted reconnect ",e),window.location.pathname==="/ride/".concat(r)&&(clearTimeout(l),l=setTimeout(t,1e3))})))}),1e3))}})).then((function(e){if(!a)throw new Error("You don't have a user, how do you expect to connect?")
return c._performStartupNegotiate(e,a,o,r).then((function(o){a.setId(o.yourAssignedId),c._userProvider=n
var s=new i.RideMapHandicap(o.map),u=new t.RaceState(s,n,r)
return c._raceState=u,c._ws=e,c._gameId=r,e.onmessage=function(e){return c._onMsgReceived(e)},c._raceState}))})).then((function(e){return c.scheduleNetworkTick(),e}))}},{key:"_onMsgReceived",value:function(e){var t,n=this,o=(new Date).getTime()
try{t=JSON.parse(e.data)}catch(p){throw new Error("Invalid message received: "+e.data)}if(t.timeStamp<=this._lastTimeStamp)console.log("bouncing a message because it's earlier or same-time as the last one we got")
else if(isFinite(t.timeStamp))if(this._lastTimeStamp=t.timeStamp,this._lastServerRaceState=t.raceState,this._onLastServerRaceStateChange(),this._raceState&&this._userProvider){switch(t.type){case y.S2CClientChat:console.log("chat receiv")
var i=t.payload
console.log("chat: ",i)
var a=this._userProvider.getUser(i.fromId)
a&&(console.log(a.getName()+" said "+i.chat),a.setChat(o,i.chat))
break
case y.S2CNameUpdate:var s=t.payload,c=this._userProvider.getLocalUser()
c&&s.ids.forEach((function(e,t){var r=s.userHandicaps[t]
e===c.getId()&&isFinite(r)&&r>c.getHandicap()&&(console.log("the server has updated our user's handicap to ",r.toFixed(1)),c.setHandicap(r),n._onLocalHandicapChange(r))})),this._raceState.absorbNameUpdate(o,t.payload)
break
case y.S2CPositionUpdate:t.payload.clients.forEach((function(e){if(n._userProvider&&!n._userProvider.getUser(e.id)){var t=n._imageSources.get(e.id)||null
n._notifyNewClient(e,t)}})),this._raceState.absorbPositionUpdate(t.timeStamp,t.payload)
break
case y.S2CImageUpdate:var u=t.payload,l=this._raceState.getUserProvider().getUser(u.id)
this._imageSources.set(u.id,u.imageBase64),l&&(console.log("received an image for ",l.getName()),l.setImage(u.imageBase64,null))
break
case y.ServerError:case y.ClientConnectionResponse:(0,r.assert2)(!1)
break
case y.S2CFinishUpdate:this.raceResults=t.payload}this._onNetworkUpdateComplete()}else{var f
null===(f=this._ws)||void 0===f||f.close(),clearTimeout(this._timeout),this._timeout=null,this._raceState=null}}},{key:"disconnect",value:function(){this._timeout=null,clearTimeout(this._timeout),this._desiresDisconnect=!0,this._ws&&(this._ws.onmessage=function(){},this._ws.close()),this._raceState=null}},{key:"getUserName",value:function(e){if(this._userProvider){var t=this._userProvider.getUser(e)
return t&&t.getName()||"Unknown"}return"Unknown"}},{key:"chat",value:function(e){if(this._ws&&this._userProvider){var t=this._userProvider.getLocalUser()
if(t&&this._gameId){var n={chat:e,gameId:this._gameId,userId:t.getId()},r={type:y.ClientToServerChat,payload:n}
console.log("sending chat from user ",t.getId()),this._ws.send(JSON.stringify(r))}}}},{key:"tick",value:function(){if(this._ws&&this._raceState){var e=new g(this._raceState),t={type:y.ClientToServerUpdate,payload:e}
this._ws.send(JSON.stringify(t)),this.scheduleNetworkTick()}}},{key:"getRaceState",value:function(){if(this._raceState)return this._raceState
throw new Error("We don't have a game state!")}},{key:"scheduleNetworkTick",value:function(){var e=this
this._timeout=setTimeout((function(){e.tick()}),250)}},{key:"preRace",get:function(){return this._lastServerRaceState&&this._lastServerRaceState.state===v.PreRace||!1}},{key:"racing",get:function(){return this._lastServerRaceState&&this._lastServerRaceState.state===v.Racing||!1}},{key:"postRace",get:function(){return this._lastServerRaceState&&this._lastServerRaceState.state===v.PostRace||!1}},{key:"msOfStart",get:function(){return this._lastServerRaceState&&this._lastServerRaceState.tmOfNextState||0}}]),e}()
e.default=S})),define("bt-web2/server-client-common/drawing-constants",["exports","bt-web2/server-client-common/DecorationFactory"],(function(e,t){Object.defineProperty(e,"__esModule",{value:!0}),e.defaultThemeConfig=void 0
var n={name:"Default Theme",decorationSpecs:[{name:"Clouds",minDimensions:{x:12,y:8},maxDimensions:{x:16,y:10},minAltitude:12,maxAltitude:22,imageUrl:["assets/cloud1-ce6f8d761efe78c02429a3ec95ba8a6c.png","assets/cloud2-9f39cc334f764bdfb99cc6d247a61899.png"],layer:t.Layer.NearSky,frequencyPerKm:50},{name:"Grasses",minDimensions:{x:1,y:1},maxDimensions:{x:1.2,y:1.2},minAltitude:-16,maxAltitude:-2,imageUrl:["assets/grass2-1b52c24d9802fd69a1950dd3eca6ebb4.png","assets/grass3-184d9a6e8181109e22b0951256c19262.png","assets/grass4-3c260956017609c66c5c106a6803ae2a.png","assets/grass5-12ef6222c1b82991234f9524066f65a6.png","assets/grass6-a22ee136e9f65b6d9779d3ceecf194d2.png","assets/grass7-2d9ad95a79219bb8927b84c7c360649f.png"],layer:t.Layer.Underground,frequencyPerKm:1e3},{name:"Stores",minDimensions:{x:4,y:4},maxDimensions:{x:4,y:4},minAltitude:2,maxAltitude:2,imageUrl:["assets/store1.webp","assets/store2.webp"],layer:t.Layer.NearRoadside,frequencyPerKm:20},{name:"Trees",minDimensions:{x:4,y:4},maxDimensions:{x:8,y:8},minAltitude:2,maxAltitude:2,imageUrl:["assets/tree1-by-art.webp","assets/tree2-by-art.webp"],layer:t.Layer.NearRoadside,frequencyPerKm:60}]}
e.defaultThemeConfig=n})),define("bt-web2/server-client-common/drawing",["exports","bt-web2/server-client-common/DecorationFactory","bt-web2/server-client-common/setupContextWithTheseCoords","bt-web2/server-client-common/User","bt-web2/server-client-common/Utils"],(function(e,t,n,r,o){function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function s(e){return function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t]
return n}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}Object.defineProperty(e,"__esModule",{value:!0}),e.drawMinimap=function(e){var t=e.ctx,n=e.elevations,r=e.w,i=e.h,a=e.minElevSpan,f=e.localPositionPct,p=e.humanPositions,d=e.aiPositions
if(!t)return
var h=t.createLinearGradient(0,0,r,i)
h.addColorStop(0,"#35D6ed"),h.addColorStop(1,"#c9f6ff"),t.fillStyle=h,t.fillRect(0,0,r,i)
var m=t.createLinearGradient(0,0,r,i)
m.addColorStop(0,"#709b40"),m.addColorStop(1,"#285028")
var y=n[0],v=n[0]
n.forEach((function(e){(!y||e>y)&&(y=e),(!v||e<v)&&(v=e)}))
var b=y-v
if(b<a){var g=a-b
y+=g/2,v-=g/2,b=a}t.scale(1,-1),t.translate(0,-i),t.beginPath(),t.fillStyle=m,s(n).forEach((function(e,o){var a=o/(n.length-1)*r,s=(e-v)/b*i
0===o?t.lineTo(0,s):t.lineTo(a,s)})),t.lineTo(r,0),t.lineTo(0,0),t.lineTo(0,(n[0]-v)/b),t.closePath(),t.fill(),d&&(t.strokeStyle=l,t.beginPath(),d.forEach((function(e){(0,o.assert2)(e>=-.001&&e<=1.01),t.moveTo(e*r,0),t.lineTo(e*r,i)})),t.stroke())
p&&(t.strokeStyle=u,t.lineWidth=2,t.beginPath(),p.forEach((function(e){(0,o.assert2)(e>=0&&e<=1.01),t.moveTo(e*r,0),t.lineTo(e*r,i)})),t.stroke())
f&&((0,o.assert2)(f>=0&&f<=1.01),t.strokeStyle=c,t.lineWidth=3,t.beginPath(),t.moveTo(f*r,0),t.lineTo(f*r,i),t.stroke())},e.doPaintFrameStateUpdates=function(e,t,n,r,o){var i=r.getUserProvider().getUsers(t)
if(!o.defaultAiImage&&!o.loadingAi){o.loadingAi=!0
var a=["assets/cyclist-spritesheet.webp"],s=a[Math.floor(Math.random()*a.length)%a.length],c=document.createElement("img")
c.onload=function(){for(var e=[],t=0;t<8;t++){var n=document.createElement("canvas"),r=document.createElement("img")
n.width=111,n.height=117
var i=n.getContext("2d")
i&&(i.drawImage(c,0,117*t,111,117,0,0,111,117),r.src=n.toDataURL("png"),e.push(r))}o.defaultAiImage=e,o.loadingAi=!1},c.src=e+s}var u=i.find((function(e){var t
return e.getImage()&&!(null===(t=o.userPaint.get(e.getId()))||void 0===t?void 0:t.image)})),l=!1,p=!1
if(i.forEach((function(e){var r=o.userPaint.get(e.getId())||new f(e),i=(20*Math.random()+80)/60
for(r.crankPosition+=i*n;r.crankPosition>=1;)r.crankPosition-=1
var a=e.getLastHrm(t)/60
for(r.heartPosition+=a*n;r.heartPosition>=1;)r.heartPosition-=1
!r.image&&e.getImage()&&(l=!0),r.loadingImage&&e.getImage()&&(p=!0),o.userPaint.set(e.getId(),r)})),!p&&l&&u){var d=u.getImage(),h=o.userPaint.get(u.getId())
if(h&&d){h.loadingImage=!0
var m=document.createElement("img")
m.onload=function(){h.loadingImage=!1,h.image=[m]},m.src=d}}},e.paintCanvasFrame=function(e,i,a,s,c,p){var d=(new Date).getTime(),h=e.getContext("2d")
if(!h)return
var m=e.width,y=e.height,v=i.getLocalUser()
if(!v)throw new Error("Trying to display a map without a local user?")
var b=i.getUserProvider().getUsers(d),g=0
b.forEach((function(e){if(e.getUserType()&r.UserTypeFlags.Ai||g++,p.userPaint.has(e.getId())){var t=e.getDistance(),n=p.userPaint.get(e.getId())||new f(e),o=n.distance
n.distance=.1*o+.9*t,p.userPaint.set(e.getId(),n)}else{var i=new f(e)
p.userPaint.set(e.getId(),i)}}))
var _=i.getMap(),w=[],S=[],P=_.getBounds(),k=(P.maxElev,P.minElev,P.minDist),O=P.maxDist,E=Math.floor(m/3),T=p.userPaint.get(v.getId())||new f(v),j=T.distance||v.getDistance(),D=_.getSlopeAtDistance(j)
D=.1*D+.9*T.slope,T.slope=D
var x=-Math.atan(D),M=(1+2*Math.abs(1*D))*(m/1920)*150
k=j-M/2,O=j+M/2,s.tick(c,k,O)
var U=(O-k)/(m/y),R=_.getElevationAtDistance(v.getDistance())
h.resetTransform(),(0,n.default)(e,h,k,R+U/2,O,R-U/2,x),k-=M/2,O+=M/2,U*=2
for(var A=0;A<=E;A++){var C=k+A/E*(O-k)
S.push(C),w.push(_.getElevationAtDistance(C))}var L=h.createLinearGradient(0,0,m,y)
L.addColorStop(0,"#35D6ed"),L.addColorStop(1,"#c9f6ff"),h.fillStyle=L,h.fillRect(k,R-U/2,O-k,U),s.draw(h,t.Layer.FarScenery),s.draw(h,t.Layer.NearSky),s.draw(h,t.Layer.NearRoadside)
var I=h.createLinearGradient(0,0,m,y)
I.addColorStop(0,"#709b40"),I.addColorStop(1,"#285028"),h.beginPath(),h.fillStyle=I,w.forEach((function(e,t){0===t?h.moveTo(S[t],e):h.lineTo(S[t],e)})),h.lineTo(O,R-U/2),h.lineTo(k,R-U/2),h.fill(),s.draw(h,t.Layer.Underground)
var F=function(e){var t=p.userPaint.get(e.getId())
if(t){var n,i=(null==t?void 0:t.distance)||e.getDistance(),a=_.getElevationAtDistance(i),f=e.getUserType(),m=f&r.UserTypeFlags.Local,y=!(f&r.UserTypeFlags.Ai),b=null==t?void 0:t.image,w="lightpink",S="black",P=2,k=0,O=null
m&&y?(P=3,w="white",S="black",n=e.getName()):y?(P=3,k=-.25,w=u,S="black",n=e.getName(),O=e.getLastChat(d)):(P=3.1,k=-.25,w=l,S="transparent",b=p.defaultAiImage,1===g&&(n=e.getName(),w="blue"))
var E=s.getImage("heart")
h.save()
var T=_.getSlopeAtDistance(e.getDistance()),j=-Math.atan(T)
if(h.translate(i-P/2-k,a+P/2),h.rotate(-j),h.scale(1,-1),t&&b)if(1===b.length)h.drawImage(b[0],-P/2,-P/2,P,P)
else{(0,o.assert2)(t.crankPosition>=0&&t.crankPosition<1)
var D=Math.floor(t.crankPosition*b.length)
h.drawImage(b[D],-P/2,-P/2,P,P)}else h.fillStyle=w,h.fillRect(-P/2,-P/2,P,P),h.strokeStyle=S,h.lineWidth=.1,h.strokeRect(-P/2,-P/2,P,P)
if(t&&n){h.save(),h.font="".concat(P,"px Arial")
var x=0,M=0,U="black",R=e.getLastPower()/e.getHandicap()
if(R>1.3?U="red":R<.5&&(U="green"),R>1.6&&(x=.6*Math.random(),M=.6*Math.random()),h.strokeStyle=U,h.fillStyle=w,h.lineWidth=.3,h.translate(0+x,-P/2+M),h.rotate(-Math.PI/3),E&&e.getLastHrm(d)>0&&v&&(null==v?void 0:v.getLastHrm(d))>0){(0,o.assert2)((null==t?void 0:t.heartPosition)>=0&&(null==t?void 0:t.heartPosition)<=1)
var A=(.25+1.5*Math.sqrt(1-Math.pow(2*t.heartPosition-1,2)))*P
h.drawImage(E,-A/2+P/2,-P/2-A/2,A,A),h.translate(1.25*P,0)}if(O){var C=(d-O.tmWhen)/1e3,L=(Math.log(C)-C+7.7)/6.7*3,I=h.font,F=h.strokeStyle
h.strokeStyle="black",h.font="".concat(L,"px Arial"),h.strokeText(O.chat,0,-L),h.fillText(O.chat,0,-L),h.strokeStyle=F,h.font=I}h.strokeText(n,0,0),h.fillText(n,0,0),h.restore()}if(h.restore(),e.getUserType()&r.UserTypeFlags.Local||e.isDraftingLocalUser()){var H={r:255,g:255,b:255}
e.isDraftingLocalUser()&&(H={r:0,g:0,b:255})
var N=e.getUserType()&r.UserTypeFlags.Local,B=N?.4:2,W=e.getLastWattsSaved(),z=e.getHandicapSecondsSaved(),K=e.getDistance(),G=W.fromDistance-K-1.5,q=W.pctOfMax,V=W.watts*(e.getHandicap()/r.DEFAULT_HANDICAP_POWER),J=N?.8*q:.4*q
function Y(e,n,r){var o=Math.cos(6.28*e+t.draftCosBase),i=o+1,a=.5*(1+.5*o)+.5
return{strokeStyle:"rgba(".concat(a*H.r,",").concat(a*H.g,",").concat(a*H.b,",1.0)"),lineWidth:J*i}}if(t.draftCosBase+=c*e.getSpeed()*2,W.pctOfMax>0){for(var Q=i-2,X=i+G,Z=0;Z<40;Z++){var $=Z/40,ee=(Z-1)/40,te=ee*X+(1-ee)*Q,ne=$*X+(1-$)*Q,re=Y($,e.getSpeed())
h.strokeStyle=re.strokeStyle,h.lineWidth=re.lineWidth,h.beginPath(),h.moveTo(te,_.getElevationAtDistance(te)-B),h.lineTo(ne,_.getElevationAtDistance(ne)-B),h.stroke()}N&&(h.save(),h.fillStyle="white",h.font="4px Arial",h.scale(1,-1),h.fillText(V.toFixed(0)+"W",i+G,-(_.getElevationAtDistance(i+G)-2)),h.restore())}if(N&&W.pctOfMax>0||e.hasDraftersThisCycle(d)||e.isDraftingLocalUser()){h.save(),h.fillStyle="rgba(".concat(H.r,", ").concat(H.g,", ").concat(H.b,",1.0)")
Y(0,e.getSpeed())
h.strokeStyle="rgba(255, 255, 255,1.0)",h.lineWidth=.03
h.font="".concat(2.5,"px Arial")
var oe=z.toFixed(1),ie=h.measureText(oe)
h.scale(1,-1),h.fillText(oe,i-2.1-ie.width,-(_.getElevationAtDistance(i)+.1-1.25-B)),h.strokeText(oe,i-2.1-ie.width,-(_.getElevationAtDistance(i)+.1-1.25-B)),h.restore()}}}},H=b.filter((function(e){return e.getUserType()&r.UserTypeFlags.Ai})),N=b.filter((function(e){return!(e.getUserType()&r.UserTypeFlags.Ai||e.getUserType()&r.UserTypeFlags.Local)})),B=b.filter((function(e){return e.getUserType()&r.UserTypeFlags.Local}))
H.forEach(F),N.forEach(F),B.forEach(F)},e.PaintFrameState=e.ai_color=e.human_color=e.local_color=void 0
var c="white"
e.local_color=c
var u="lightpink"
e.human_color=u
var l="black"
e.ai_color=l
var f=function e(t){i(this,e),a(this,"distance",0),a(this,"image",null),a(this,"loadingImage",!1),a(this,"crankPosition",0),a(this,"heartPosition",0),a(this,"slope",0),a(this,"draftCosBase",0),this.distance=t.getDistance(),this.image=null,this.loadingImage=!1}
e.PaintFrameState=function e(){i(this,e),a(this,"userPaint",new Map),a(this,"defaultAiImage",null),a(this,"loadingAi",!1)}})),define("bt-web2/server-client-common/heart-rate-engine",["exports"],(function(e){function t(e,t){for(var n=0;n<t.length;n++){var r=t[n]
r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}Object.defineProperty(e,"__esModule",{value:!0}),e.HeartRateEngine=void 0
var n=function(){function e(t){var n,r,o;(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,e),o=void 0,(r="lastBpm")in(n=this)?Object.defineProperty(n,r,{value:o,enumerable:!0,configurable:!0,writable:!0}):n[r]=o,this.lastBpm=t}var n,r,o
return n=e,(r=[{key:"tick",value:function(e,t,n,r,o,i){if(e){var a=e.getLastHrm(t),s=e.getLastPower()
this.lastBpm=a
var c=i
if(a>0&&s>0){var u=r-a,l=0
return u>0?(u=Math.min(10,u),l=.025*c*Math.min(10,u)):l=.065*c*u,{newTargetHandicap:o+l*n}}return{newTargetHandicap:o}}return{newTargetHandicap:0}}}])&&t(n.prototype,r),o&&t(n,o),e}()
e.HeartRateEngine=n})),define("bt-web2/server-client-common/setupContextWithTheseCoords",["exports"],(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(e,t,n,r,o,i,a){var s=r
r=i
var c=((i=s)+r)/2,u=i-r,l=o-n,f=Math.max(-.1,Math.min(.1,a)),p=-3*Math.atan(f),d=u*Math.sin(-Math.abs(p)),h=l*Math.cos(-Math.abs(p)),m=l*Math.sin(-Math.abs(p)),y=u*Math.cos(-Math.abs(p)),v=Math.max(l/(d+h),u/(m+y))
f>0&&(v=1)
t.resetTransform(),t.translate(e.width/2,e.height/2),t.rotate(-p),t.scale(v,v),t.translate(-e.width/2,-e.height/2),t.scale(e.width,e.height),t.scale(1/l,1/u),t.scale(1,-1),t.translate(-n,-c-u/2)}})),define("bt-web2/services/connection",["exports","bt-web2/server-client-common/communication","bt-web2/config/environment","bt-web2/components/user-set-up-widget/component"],(function(e,t,n,r){var o,i,a,s,c,u
function l(e){return(l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function f(e,t){for(var n=0;n<t.length;n++){var r=t[n]
r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function p(e){return(p=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function d(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called")
return e}function h(e,t){return(h=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function m(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function y(e,t,n,r,o){var i={}
return Object.keys(r).forEach((function(e){i[e]=r[e]})),i.enumerable=!!i.enumerable,i.configurable=!!i.configurable,("value"in i||i.initializer)&&(i.writable=!0),i=n.slice().reverse().reduce((function(n,r){return r(e,t,n)||n}),i),o&&void 0!==i.initializer&&(i.value=i.initializer?i.initializer.call(o):void 0,i.initializer=void 0),void 0===i.initializer&&(Object.defineProperty(e,t,i),i=null),i}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
var v=(o=Ember.computed("_lastServerRaceState"),i=Ember.computed("_lastServerRaceState"),a=Ember.computed("_lastServerRaceState"),s=Ember.computed("_lastServerRaceState"),c=Ember.computed("_updateVersion"),y((u=function(e){function o(){var e,n;(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,o)
for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a]
return n=function(e,t){return!t||"object"!==l(t)&&"function"!=typeof t?d(e):t}(this,(e=p(o)).call.apply(e,[this].concat(i))),m(d(n),"_connectManager",new t.default((function(e){return n._onHandicapChange(e)}),(function(){return n._onLastServerRaceStateChange()}),(function(){return n._onNetworkUpdateComplete()}),(function(e,t){return n._notifyNewUserNoticed(e,t)}))),m(d(n),"_lastServerRaceState",0),m(d(n),"_updateVersion",0),n}var i,a,s
return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function")
e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&h(e,t)}(o,Ember.Service.extend({devices:Ember.inject.service()})),i=o,(a=[{key:"_onHandicapChange",value:function(e){localStorage.setItem(r.USERSETUP_KEY_HANDICAP,e.toFixed(1))}},{key:"_onLastServerRaceStateChange",value:function(){this.incrementProperty("_lastServerRaceState")}},{key:"_onNetworkUpdateComplete",value:function(){this.incrementProperty("_updateVersion"),this.set("msOfStart",this._connectManager.msOfStart)}},{key:"_notifyNewUserNoticed",value:function(e,t){this.devices.addRemoteUser(e,t)}},{key:"connect",value:function(e,t,r,o,i){var a="production"===n.default.environment?"wss://".concat(e,":8080"):"ws://".concat(e,":8080")
return this._connectManager.connect(a,this.devices,t,r,o,i)}},{key:"disconnect",value:function(e){var t=(new Date).getTime()
e&&this.devices.dumpPwx(e,t)
var n=this.devices.getLocalUser()
n&&n.setId(-1),this._connectManager.disconnect()}},{key:"getUser",value:function(e){return this.devices.getUser(e)||null}},{key:"getUserName",value:function(e){var t=this.devices.getUser(e)
return t&&t.getName()||"Unknown"}},{key:"chat",value:function(e){return this._connectManager.chat(e)}},{key:"getRaceState",value:function(){return this._connectManager.getRaceState()}},{key:"preRace",get:function(){return this._connectManager.preRace}},{key:"racing",get:function(){return this._connectManager.racing}},{key:"postRace",get:function(){return this._connectManager.postRace}},{key:"msOfStart",get:function(){return this._connectManager.msOfStart}},{key:"raceResults",get:function(){return this._connectManager.raceResults}}])&&f(i.prototype,a),s&&f(i,s),o}()).prototype,"preRace",[o],Object.getOwnPropertyDescriptor(u.prototype,"preRace"),u.prototype),y(u.prototype,"racing",[i],Object.getOwnPropertyDescriptor(u.prototype,"racing"),u.prototype),y(u.prototype,"postRace",[a],Object.getOwnPropertyDescriptor(u.prototype,"postRace"),u.prototype),y(u.prototype,"msOfStart",[s],Object.getOwnPropertyDescriptor(u.prototype,"msOfStart"),u.prototype),y(u.prototype,"raceResults",[c],Object.getOwnPropertyDescriptor(u.prototype,"raceResults"),u.prototype),u)
e.default=v})),define("bt-web2/services/devices",["exports","bt-web2/pojs/WebBluetoothDevice","bt-web2/server-client-common/User","bt-web2/server-client-common/FileSaving","bt-web2/server-client-common/Utils","bt-web2/set-up-ride/route"],(function(e,t,n,r,o,i){function a(e){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function s(e){return(s=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function c(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called")
return e}function u(e,t){return(u=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function l(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function f(e,t){for(var n=0;n<t.length;n++){var r=t[n]
r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function p(e,t,n){return t&&f(e.prototype,t),n&&f(e,n),e}function d(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}Object.defineProperty(e,"__esModule",{value:!0}),e.dumpRaceResultToPWX=y,e.default=e.DeviceFlags=e.PowerTimer=void 0
var h,m=function(){function e(t){l(this,e),d(this,"tmStart",void 0),d(this,"tmLast",void 0),d(this,"sumPower",void 0),d(this,"countPower",void 0),this.tmStart=t,this.tmLast=t,this.sumPower=0,this.countPower=0}return p(e,[{key:"notifyPower",value:function(e,t){var n=Math.min(2,(e-this.tmLast)/1e3)
n<=0||(this.sumPower+=t*n,this.countPower+=n,this.tmLast=e)}},{key:"getAverage",value:function(e){var t=this.countPower>0?this.countPower:(e-this.tmStart)/1e3
return{powerAvg:this.countPower>0?this.sumPower/t:0,joules:this.sumPower,totalTimeSeconds:t}}}]),e}()
function y(e){var t=(0,r.samplesToPWX)("Workout",e),n=e.samples[e.samples.length-1].distance-e.samples[0].distance,o=new Blob([t],{type:"application/octet-stream"}),i=window.URL.createObjectURL(o),a=document.createElement("a")
a.href=i,a.download="TourJS-".concat(e.activityName,"-").concat(n.toFixed(0),"m-").concat(new Date(e.samples[0].tm).toDateString(),".pwx"),a.target="_blank",document.body.appendChild(a),a.click(),document.body.removeChild(a)}e.PowerTimer=m,e.DeviceFlags=h,function(e){e[e.PowerOnly=1]="PowerOnly",e[e.Trainer=2]="Trainer",e[e.Cadence=4]="Cadence",e[e.Hrm=8]="Hrm",e[e.AllButHrm=7]="AllButHrm",e[e.All=15]="All"}(h||(e.DeviceFlags=h={}))
var v=function(e){function f(){var e,t
l(this,f)
for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o]
return t=function(e,t){return!t||"object"!==a(t)&&"function"!=typeof t?c(e):t}(this,(e=s(f)).call.apply(e,[this].concat(r))),d(c(t),"devices",[]),d(c(t),"users",[]),d(c(t),"deviceDescription","No Device Connected"),d(c(t),"workoutSaver",null),d(c(t),"_displayControlPoint",null),d(c(t),"_displayWriteQueue",Promise.resolve()),d(c(t),"ridersVersion",0),d(c(t),"goodUpdates",0),d(c(t),"badUpdates",0),d(c(t),"ftmsLevel",100),d(c(t),"_powerCounters",new Map),d(c(t),"_fnPowerFilter",(function(e){return e})),d(c(t),"_tmLastDisplayUpdate",0),d(c(t),"_displayUpdates",0),d(c(t),"tmLastInternalTick",0),d(c(t),"nextTickHandle",0),t}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function")
e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&u(e,t)}(f,Ember.Service.extend({})),p(f,[{key:"setDisplayDevice",value:function(e){this._displayControlPoint=e,this._internalTick((new Date).getTime())}},{key:"setPowerFilter",value:function(e){this._fnPowerFilter=e}},{key:"addDevice",value:function(e){this.set("deviceDescription","A ".concat(e.getDeviceTypeDescription()," named ").concat(e.name())),this.devices.push(e),console.log("added a device to device man: ",this.devices)}},{key:"ftmsAdjust",value:function(e){this.incrementProperty("ftmsLevel",e)}},{key:"clearUsers",value:function(){this.devices.forEach((function(e){e.disconnect()})),console.log("cleared out devices ",this.devices),this.devices=[],this.users=[],this.incrementProperty("ridersVersion")}},{key:"addRemoteUser",value:function(e,t){var r=(new Date).getTime(),o=new n.User("Unknown User "+e.id,n.DEFAULT_RIDER_MASS,n.DEFAULT_HANDICAP_POWER,n.UserTypeFlags.Remote)
t&&o.setImage(t,null),o.setId(e.id),o.absorbPositionUpdate(r,e),this.users.push(o),this.incrementProperty("ridersVersion")}},{key:"addUser",value:function(e){console.log("images adding user with image length ",e.imageBase64&&e.imageBase64.length)
var t=new n.User(e.name,n.DEFAULT_RIDER_MASS,e.handicap,n.UserTypeFlags.Local),o=this.getLocalUser()
o&&(this.users=this.users.filter((function(e){return e.getId()!==o.getId()}))),this.workoutSaver=new r.WorkoutFileSaver(t,(new Date).getTime()),e.imageBase64&&t.setImage(e.imageBase64,e.bigImageMd5),this.users.push(t),this.incrementProperty("ridersVersion")}},{key:"_updatePowerCounters",value:function(e,t){this._powerCounters.forEach((function(n){n.notifyPower(e,t)}))}},{key:"getPowerCounterAverage",value:function(e,t){var n=this._powerCounters.get(t)
return n?n.getAverage(e):{powerAvg:0,joules:0,totalTimeSeconds:0}}},{key:"startPowerTimer",value:function(e){console.log("devices service: setting power timer "+e),this._powerCounters.set(e,new m((new Date).getTime()))}},{key:"stopPowerTimer",value:function(e){this._powerCounters.delete(e)}},{key:"setLocalUserDevice",value:function(e,n){var r=this
this.set("kickrConnected",!!t.BluetoothKickrDevice.getKickrDevice())
var o=this.getLocalUser()
if(!o)throw new Error("You can't set a device for a local user that doesn't exist")
n&h.Cadence&&e.setCadenceRecipient(o),n&h.Hrm&&e.setHrmRecipient(o),(n&h.PowerOnly||n&h.Trainer)&&e.setPowerRecipient((function(e,t){t=r._fnPowerFilter(t),o.notifyPower(e,t),r._updatePowerCounters(e,t)})),n&&h.Hrm&&e.setHrmRecipient(o),n&h.Trainer&&e.setSlopeSource(o),this._internalTick((new Date).getTime()),this.devices=this.devices.filter((function(t){var r=t.getDeviceFlags()&~n
return t.getDeviceId()!==e.getDeviceId()&&(0!==r?(t.setDeviceFlags(r),!0):(console.log("disconnecting "+t.name()+" because new device is a physically separate device"),t.disconnect(),!1))})),e.setDeviceFlags(n),this.devices.push(e),this.incrementProperty("ridersVersion")}},{key:"getHrmDevice",value:function(){return this.devices.find((function(e){return e.getDeviceFlags()&h.Hrm}))||null}},{key:"getPowerDevice",value:function(){return this.devices.find((function(e){return e.getDeviceFlags()&(h.Trainer|h.PowerOnly)}))||null}},{key:"getLocalUser",value:function(){return this.users.find((function(e){return e.getUserType()&n.UserTypeFlags.Local}))||null}},{key:"isLocalUserDeviceValid",value:function(){var e=(new Date).getTime(),t=this.getLocalUser()
return!(!t||!t.isPowerValid(e))}},{key:"dumpPwx",value:function(e,t){var n=this.getLocalUser()
if(this.workoutSaver&&n){for(var r=this.workoutSaver.getWorkout(),o=r.length-1;o>0&&r[o].power<=0;)o--
var a=new Date(r[0].tm).toLocaleString(),s=new Date(r[o].tm).toLocaleString(),c=r[r.length-1].distance-r[0].distance,u=n.getImage(),l={rideName:"".concat(n.getName()," doing ").concat(e," for ").concat(c.toFixed(0),"m from ").concat(a," to ").concat(s),riderName:n.getName(),tmStart:r[0].tm,tmEnd:r[o].tm,activityName:e,handicap:n.getHandicap(),samples:r,deviceName:this.get("deviceDescription"),bigImageMd5:n.getBigImageMd5()||""}
y(l),u&&(0,i.apiPost)("submit-ride-result",l)}}},{key:"getUsers",value:function(e){return this.users.filter((function(t){return t.getUserType()&n.UserTypeFlags.Local||t.getUserType()&n.UserTypeFlags.Ai||t.getMsSinceLastPacket(e)<5e3||t.isFinished()}))}},{key:"setErgMode",value:function(e){var t=this
this.devices=this.devices.filter((function(e){return e.userWantsToKeep()}))
var n=(new Date).getTime()
this.devices.forEach((function(r){console.log("setting erg mode for ",r),r.updateErg(n,e).then((function(e){e&&t.incrementProperty("goodUpdates")}),(function(e){t.incrementProperty("badUpdates")}))}))}},{key:"setResistanceMode",value:function(e){var t=this;(0,o.assert2)(e>=0&&e<=1,"resistance fractions should be between 0 and 1"),this.devices=this.devices.filter((function(e){return e.userWantsToKeep()}))
var n=(new Date).getTime()
this.devices.forEach((function(r){console.log("setting resistance mode for ",r),r.updateResistance(n,e).then((function(e){e&&t.incrementProperty("goodUpdates")}),(function(e){t.incrementProperty("badUpdates")}))}))}},{key:"updateSlopes",value:function(e){var t=this
this.devices=this.devices.filter((function(e){return e.userWantsToKeep()})),this.devices.forEach((function(n){n.updateSlope(e,t.ftmsLevel/100).then((function(e){e&&t.incrementProperty("goodUpdates")}),(function(e){t.incrementProperty("badUpdates")}))}))}},{key:"getUser",value:function(e){return this.users.find((function(t){return t.getId()===e}))||null}},{key:"_updateDisplay",value:function(){var e=this
if(this._displayControlPoint){var t=(new Date).getTime()
if(t-this._tmLastDisplayUpdate>1e3){var n=this._displayControlPoint,r=this.getLocalUser()
r&&(this._displayWriteQueue=this._displayWriteQueue.then((function(){var t,o,i,a,s,c,u,l,f,p,d,h
return regeneratorRuntime.async((function(m){for(;;)switch(m.prev=m.next){case 0:return e._displayUpdates++,t=new DataView(new ArrayBuffer(20)),o=r.getLastPower(),t.setUint8(0,17),t.setUint8(1,0),t.setUint8(2,0),t.setUint8(3,0),t.setUint8(4,0),t.setFloat32(5,o,!0),m.next=11,regeneratorRuntime.awrap(n.writeValue(t))
case 11:return i=new DataView(new ArrayBuffer(20)),a=r.getDistance(),i.setUint8(0,17),i.setUint8(1,1),i.setUint8(2,5),i.setUint8(3,0),i.setUint8(4,0),i.setFloat32(5,a,!0),m.next=21,regeneratorRuntime.awrap(n.writeValue(i))
case 21:return s=new DataView(new ArrayBuffer(20)),c=r.getSpeed(),s.setUint8(0,17),s.setUint8(1,2),s.setUint8(2,6),s.setUint8(3,0),s.setUint8(4,0),s.setFloat32(5,c,!0),m.next=31,regeneratorRuntime.awrap(n.writeValue(s))
case 31:for(u=new DataView(new ArrayBuffer(20)),l=r.getLastSlopeInWholePercent(),u.setUint8(0,17),f=e._displayUpdates%10==0?1:0,3,p=3|f<<4,d=f?"Slope":"".concat(l.toFixed(1),"%"),u.setUint8(1,p),u.setUint8(2,4),u.setUint8(3,0),u.setUint8(4,0),h=0;h<d.length;h++)u.setUint8(5+h,d.charCodeAt(h))
return u.setUint8(5+d.length,0),m.next=46,regeneratorRuntime.awrap(n.writeValue(u))
case 46:case"end":return m.stop()}}))})).catch((function(){console.log("display send failed.  that's fine")}))),this._tmLastDisplayUpdate=t}}}},{key:"_internalTick",value:function(e){var t=this
this._displayControlPoint&&this._updateDisplay(),this.tmLastInternalTick=e,this.nextTickHandle||(this.nextTickHandle=setTimeout((function(){t.nextTickHandle=0,t._internalTick((new Date).getTime())}),100))}},{key:"tick",value:function(e,t){t&&this.updateSlopes(e),this.workoutSaver&&this.workoutSaver.tick(e)}}]),f}()
e.default=v})),define("bt-web2/services/intl",["exports","ember-intl/services/intl"],(function(e,t){Object.defineProperty(e,"__esModule",{value:!0}),Object.defineProperty(e,"default",{enumerable:!0,get:function(){return t.default}})})),define("bt-web2/services/platform-manager",["exports","bt-web2/server-client-common/RideMap","bt-web2/server-client-common/Utils"],(function(e,t,n){function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){for(var n=0;n<t.length;n++){var r=t[n]
r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function a(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e}function s(e,t){return!t||"object"!==r(t)&&"function"!=typeof t?u(e):t}function c(e){return(c=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function u(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called")
return e}function l(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function")
e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&f(e,t)}function f(e,t){return(f=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function p(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function d(e){return console.log("they're looking for ",e),new Promise((function(t){var n=document.cookie.split(";")
console.log("split = ",n),n.forEach((function(n){var r=n.split("="),o=r[0].trim(),i=r[1].trim()
console.log("key, vlaue = ",o,i),o===e&&i&&i.length>0&&t(i)})),t()}))}function h(e,t,n){var r=["".concat(e,"=").concat(t)]
n>0&&r.push("Max-Age=".concat(n))
var o=r.join(";")
console.log("applying ",o," to cookie"),document.cookie=r.join(";")}Object.defineProperty(e,"__esModule",{value:!0}),e.default=e.ElevDistanceMap=void 0
var m=function(e){function t(e,r){var i
return o(this,t),p(u(i=s(this,c(t).call(this))),"_distance",void 0),p(u(i),"_elevation",void 0),i._distance=r,i._elevation=e,(0,n.assert2)(i._distance&&i._elevation),i}return l(t,e),a(t,[{key:"getElevationAtDistance",value:function(e){if(e<=0)return this._elevation[0]
if(e>=this._distance[this._distance.length-1])return this._elevation[this._elevation.length-1]
for(var t=0;t<this._distance.length-1;t++){var r=this._distance[t],o=this._distance[t+1]
if(e>=r&&e<=o){var i=(e-r)/(o-r),a=this._elevation[t]
return i*this._elevation[t+1]+(1-i)*a}}return(0,n.assert2)(!1,"We shouln't get here - we should always find a distance"),0}},{key:"getLength",value:function(){return this._distance[this._distance.length-1]}}]),t}(t.RideMapPartial)
e.ElevDistanceMap=m
var y=function(e){function t(){return o(this,t),s(this,c(t).apply(this,arguments))}return l(t,Ember.Service.extend({})),a(t,[{key:"_doSignIn",value:function(e){return new Promise((function(t,n){var r=window.open(e,"_blank")
if(r)var o=setInterval((function(){if(r.closed)return d("strava-auth-code").then((function(e){console.log("getCookie got ",e),console.log("document cookie is ",document.cookie),h("strava-auth-code","",3600),e?t(e):n("Window closed, but no auth code gotten"),clearInterval(o)}))}),750)})).then((function(e){console.log("gotta exchange ",e," for access token")
var t={client_id:3055,client_secret:"a14312f43d3000a65391c6c718d5a8b8a3f13434",code:e,grant_type:"authorization_code"}
return fetch("https://www.strava.com/oauth/token",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}).then((function(e){return e.json()})).then((function(e){return h("strava-access-token",e.access_token,e.expires_in),e.access_token}))}))}},{key:"getStravaMapList",value:function(){return this.getStravaAccessToken().then((function(e){return fetch("https://www.strava.com/api/v3/segments/starred?access_token=".concat(e))})).then((function(e){return e.json()})).then((function(e){return e}))}},{key:"getStravaMapDetails",value:function(e){return this.getStravaAccessToken().then((function(t){return fetch("https://www.strava.com/api/v3/segments/".concat(e.id,"/streams?keys=altitude,distance&key_by_type=true&access_token=").concat(t))})).then((function(e){return e.json()})).then((function(e){return new m(e.altitude.data,e.distance.data)}))}},{key:"getStravaAccessToken",value:function(){var e=this
return new Promise((function(t,n){d("strava-access-token").then((function(r){if(console.log("current auth code ",r),!r){var o=window.location.hostname.includes("localhost")?"https://www.tourjs.ca/strava-auth?stayOpen=1":"https://www.tourjs.ca/strava-auth",i="https://www.strava.com/oauth/authorize?client_id=".concat("3055","&redirect_uri=").concat(encodeURIComponent(o),"&response_type=code&scope=read")
return console.log("going to ",i),e._doSignIn(i).then((function(e){console.log("auth complete: ",e),t(e)})).catch((function(e){n(e)}))}t(r)}))}))}}]),t}()
e.default=y})),define("bt-web2/set-up-ride/controller",["exports","bt-web2/set-up-ride/route"],(function(e,t){function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function r(e,t){for(var n=0;n<t.length;n++){var r=t[n]
r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function o(e,t){return!t||"object"!==n(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called")
return e}(e):t}function i(e){return(i=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function a(e,t){return(a=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
var s=function(e){function n(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,n),o(this,i(n).apply(this,arguments))}var s,c,u
return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function")
e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&a(e,t)}(n,e),s=n,(c=[{key:"_refreshAllRaces",value:function(){var e=this;(0,t.refreshRaceList)().then((function(t){e.set("model",t)}))}},{key:"beginFrames",value:function(){var e=this;(function t(){e.incrementProperty("frame"),console.log("frame!"),e.isDestroyed||setTimeout(t,15e3)})()}}])&&r(s.prototype,c),u&&r(s,u),n}(Ember.Controller.extend({settingUpRide:!1,actions:{go:function(){this.transitionToRoute("ride")},joinRace:function(e){this.transitionToRoute("ride",e)},toggleRideWidget:function(){this.toggleProperty("settingUpRide")},onRaceCreated:function(){this._refreshAllRaces(),alert("Your ride has been created!"),this.set("settingUpRide",!1)},refreshAllRaces:function(){this._refreshAllRaces()}},frame:0}))
e.default=s})),define("bt-web2/set-up-ride/route",["exports","bt-web2/config/environment","bt-web2/server-client-common/communication"],(function(e,t,n){function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function o(e,t){for(var n=0;n<t.length;n++){var r=t[n]
r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function i(e,t){return!t||"object"!==r(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called")
return e}(e):t}function a(e){return(a=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function s(e,t){return(s=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function c(e,r){var o=t.default.apiRoot
return(0,n.apiGetInternal)(o,e,r)}function u(){return c("race-list").then((function(e){return e.races=e.races.sort((function(e,t){return e.tmScheduledStart<t.tmScheduledStart?-1:1})),e}))}Object.defineProperty(e,"__esModule",{value:!0}),e.apiPost=function(e,r){var o=t.default.apiRoot
return(0,n.apiPostInternal)(o,e,r)},e.apiGet=c,e.refreshRaceList=u,e.default=void 0
var l=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),i(this,a(t).apply(this,arguments))}var n,r,c
return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function")
e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&s(e,t)}(t,Ember.Route.extend({})),n=t,(r=[{key:"model",value:function(){return u()}},{key:"setupController",value:function(e,t){e.set("model",t),e.beginFrames()}}])&&o(n.prototype,r),c&&o(n,c),t}()
e.default=l})),define("bt-web2/set-up-ride/template",["exports"],(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
var t=Ember.HTMLBars.template({id:"E1N/BtEa",block:'{"symbols":["race"],"statements":[[1,[22,"tourjs-header"],false],[0,"\\n"],[7,"div",true],[10,"class","set-up-ride__content"],[8],[0,"\\n  "],[7,"div",true],[10,"class","set-up-ride__create-your-own"],[8],[0,"\\n"],[4,"unless",[[24,["settingUpRide"]]],null,{"statements":[[0,"      "],[7,"button",false],[12,"class","set-up-ride__create-your-own--button"],[3,"action",[[23,0,[]],"toggleRideWidget"]],[8],[0,"\\n        Preschedule Ride\\n      "],[9],[0,"\\n"]],"parameters":[]},{"statements":[[0,"      "],[1,[28,"create-race-widget",null,[["onRaceCreated"],[[28,"action",[[23,0,[]],"onRaceCreated"],null]]]],false],[0,"\\n"]],"parameters":[]}],[0,"  "],[9],[0,"\\n  "],[7,"div",true],[10,"class","set-up-ride__title"],[8],[0,"\\n    Current Joinable Rides "],[7,"a",false],[12,"href","#"],[3,"action",[[23,0,[]],"refreshAllRaces"]],[8],[0,"Refresh"],[9],[0,"\\n  "],[9],[0,"\\n\\n"],[4,"each",[[24,["model","races"]]],null,{"statements":[[0,"    "],[1,[28,"pending-race",null,[["frame","race","joinRace"],[[24,["frame"]],[23,1,[]],[28,"action",[[23,0,[]],"joinRace"],null]]]],false],[0,"\\n"]],"parameters":[1]},null],[9],[0,"\\n\\n"],[7,"div",true],[10,"class","bluetooth-warning-socket"],[8],[9]],"hasEval":false}',meta:{moduleName:"bt-web2/set-up-ride/template.hbs"}})
e.default=t})),define("bt-web2/set-up-user/controller",["exports"],(function(e){function t(e){return(t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function n(e,n){return!n||"object"!==t(n)&&"function"!=typeof n?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called")
return e}(e):n}function r(e){return(r=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function o(e,t){return(o=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
var i=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),n(this,r(t).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function")
e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&o(e,t)}(t,e),t}(Ember.Controller.extend({devices:Ember.inject.service(),actions:{onAddedUser:function(e){console.log("set-up-user done adding user with md5 ",e.bigImageMd5),this.devices.addUser(e),this.transitionToRoute("index")}}}))
e.default=i})),define("bt-web2/set-up-user/route",["exports"],(function(e){function t(e){return(t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function n(e,t){for(var n=0;n<t.length;n++){var r=t[n]
r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function r(e,n){return!n||"object"!==t(n)&&"function"!=typeof n?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called")
return e}(e):n}function o(e){return(o=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function i(e,t){return(i=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
var a=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),r(this,o(t).apply(this,arguments))}var a,s,c
return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function")
e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&i(e,t)}(t,Ember.Route.extend({devices:Ember.inject.service()})),a=t,(s=[{key:"beforeModel",value:function(){return this.devices.clearUsers()}}])&&n(a.prototype,s),c&&n(a,c),t}()
e.default=a}))
define("bt-web2/set-up-user/template",["exports"],(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
var t=Ember.HTMLBars.template({id:"Vf0qoTNF",block:'{"symbols":[],"statements":[[1,[22,"tourjs-header"],false],[0,"\\n"],[1,[28,"user-set-up-widget",null,[["onDone"],[[28,"action",[[23,0,[]],"onAddedUser"],null]]]],false]],"hasEval":false}',meta:{moduleName:"bt-web2/set-up-user/template.hbs"}})
e.default=t})),define("bt-web2/strava-auth/route",["exports"],(function(e){function t(e){return(t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function n(e,t){for(var n=0;n<t.length;n++){var r=t[n]
r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function r(e,n){return!n||"object"!==t(n)&&"function"!=typeof n?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called")
return e}(e):n}function o(e){return(o=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function i(e,t){return(i=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
var a=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),r(this,o(t).apply(this,arguments))}var a,s,c
return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function")
e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&i(e,t)}(t,Ember.Route.extend({})),a=t,(s=[{key:"beforeModel",value:function(){var e=window.location.search.replace("?","").split("&"),t=window.location.search.includes("stayOpen")
e.forEach((function(e){var n=e.split("="),r=decodeURIComponent(n[0]),o=decodeURIComponent(n[1])
if(console.log(r," = ",o),"code"===r&&(document.cookie="strava-auth-code=".concat(o),window.opener)){var i=JSON.stringify({stravaAuthCode:o}),a=t?"http://localhost:4200":"https://www.tourjs.ca"
console.log("posting auth code "+o+" to opener",a),window.opener.postMessage(i,a)}})),t||window.close()}}])&&n(a.prototype,s),c&&n(a,c),t}()
e.default=a})),define("bt-web2/strava-auth/template",["exports"],(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
var t=Ember.HTMLBars.template({id:"f2FlwE4C",block:'{"symbols":[],"statements":[[1,[22,"outlet"],false]],"hasEval":false}',meta:{moduleName:"bt-web2/strava-auth/template.hbs"}})
e.default=t})),define("bt-web2/sw",[],(function(){console.log("Test service worker!")})),define("bt-web2/test-hacks/controller",["exports","bt-web2/server-client-common/RideMap","bt-web2/server-client-common/RaceState","bt-web2/server-client-common/User","bt-web2/server-client-common/communication","bt-web2/server-client-common/RideMapHandicap"],(function(e,t,n,r,o,i){function a(e){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function s(e,t){return!t||"object"!==a(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called")
return e}(e):t}function c(e){return(c=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function u(e,t){return(u=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function l(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function f(e,t){for(var n=0;n<t.length;n++){var r=t[n]
r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function p(e,t,n){return t&&f(e.prototype,t),n&&f(e,n),e}function d(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}Object.defineProperty(e,"__esModule",{value:!0}),e.default=e.FakeUserProvider=void 0
var h=function(){function e(t){l(this,e),d(this,"users",void 0),d(this,"_local",void 0),this._local=t,this.users=[t||new r.User("Local User",r.DEFAULT_RIDER_MASS,100,r.UserTypeFlags.Local),new r.User("Human Remote",r.DEFAULT_RIDER_MASS,280,r.UserTypeFlags.Remote)]
for(var n=0;n<1;n++){var o=new r.User("AI Remote ".concat(n),r.DEFAULT_RIDER_MASS,75,r.UserTypeFlags.Ai|r.UserTypeFlags.Remote)
this.users.push(o)}this.users.forEach((function(e,t){e.setId(t),e.setImage("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAAAY0lEQVR42u3QAREAAAQEsJdcdHI4W4RVMp3HSoAAAQIECBAgQIAAAQIECBAgQIAAAQIECBAgQIAAAQIECBAgQIAAAQIECBAgQIAAAQIECBAgQIAAAQIECBAgQIAAAQIECLhvAcDdX8EOJRgWAAAAAElFTkSuQmCC","")}))}return p(e,[{key:"getUsers",value:function(e){return this.users.slice()}},{key:"getUser",value:function(e){return this.users.find((function(t){return t.getId()===e}))||null}},{key:"getLocalUser",value:function(){return this._local||null}}]),e}()
e.FakeUserProvider=h
var m=function(e){function r(){return l(this,r),s(this,c(r).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function")
e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&u(e,t)}(r,Ember.Controller.extend({raceState:null,userProvider:null,devices:Ember.inject.service("devices"),frame:0})),p(r,[{key:"controllerInit",value:function(){var e=this,r=new t.PureCosineMap(5e3),a=new i.RideMapHandicap(new o.ServerMapDescription(r)),s=new h(this.devices.getLocalUser())
this.set("raceState",new n.RaceState(a,s,"Test Game"))
setTimeout((function t(){if(!e.isDestroyed){var n=(new Date).getTime()
s.getUsers(n).forEach((function(t,r){e.devices.devices.length>0||(t.notifyHrm(n,Math.random()+170+5*r),t.notifyPower(n,50*Math.random()+100+2*r))})),setTimeout(t,200),e.devices.tick(n,!0)}}))}}]),r}()
e.default=m})),define("bt-web2/test-hacks/route",["exports"],(function(e){function t(e){return(t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function n(e,t){for(var n=0;n<t.length;n++){var r=t[n]
r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function r(e,n){return!n||"object"!==t(n)&&"function"!=typeof n?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called")
return e}(e):n}function o(e){return(o=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function i(e,t){return(i=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
var a=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),r(this,o(t).apply(this,arguments))}var a,s,c
return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function")
e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&i(e,t)}(t,Ember.Route.extend({})),a=t,(s=[{key:"setupController",value:function(e,t){e.set("model",t),e.controllerInit()}}])&&n(a.prototype,s),c&&n(a,c),t}()
e.default=a})),define("bt-web2/test-hacks/template",["exports"],(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
var t=Ember.HTMLBars.template({id:"XUYGigcs",block:'{"symbols":[],"statements":[[1,[28,"display-race",null,[["raceState","overlay"],[[24,["raceState"]],"leader-board"]]],false]],"hasEval":false}',meta:{moduleName:"bt-web2/test-hacks/template.hbs"}})
e.default=t})),define("bt-web2/transforms/rendered",["exports","ember-wordpress/transforms/rendered"],(function(e,t){Object.defineProperty(e,"__esModule",{value:!0}),Object.defineProperty(e,"default",{enumerable:!0,get:function(){return t.default}})})),define("bt-web2/utils/intl/missing-message",["exports","ember-intl/utils/missing-message"],(function(e,t){Object.defineProperty(e,"__esModule",{value:!0}),Object.defineProperty(e,"default",{enumerable:!0,get:function(){return t.default}})})),define("bt-web2/config/environment",[],(function(){try{var e="bt-web2/config/environment",t=document.querySelector('meta[name="'+e+'"]').getAttribute("content"),n={default:JSON.parse(decodeURIComponent(t))}
return Object.defineProperty(n,"__esModule",{value:!0}),n}catch(r){throw new Error('Could not read config from meta tag with name "'+e+'".')}})),runningTests||require("bt-web2/app").default.create({name:"bt-web2",version:"0.0.0+80fbb719"})
